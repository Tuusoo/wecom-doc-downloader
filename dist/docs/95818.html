<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>上下游关联客户信息-已添加客户 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        上下游关联客户信息-已添加客户
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2024/03/11</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="0489f785199bd4a5515bd4a02bc0c0d8-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#%E5%9C%BA%E6%99%AF" class="level-2">场景</a></li><li class="toc-li"><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" class="level-2">准备工作</a></li><li class="toc-li"><a href="#%E6%80%9D%E8%B7%AF" class="level-2">思路</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#external-userid%E7%9A%84%E8%AF%B4%E6%98%8E" class="level-3">external_userid的说明</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E9%80%9A%E8%BF%87unionid%E5%92%8Copenid%E6%9F%A5%E8%AF%A2external-userid" class="level-3">通过unionid和openid查询external_userid</a></li></dir><h2 id="%E5%9C%BA%E6%99%AF" data-sign="89808841ca0abc798453f4cd7dfe33fb" data-lines="1"><a class="anchor" href="#%E5%9C%BA%E6%99%AF"></a>场景</h2><p data-sign="c77c0913b47dc9c3ff04d7ef8b409933" data-type="p" data-lines="2">品牌在公众号、小程序上的微信粉丝，可以跟经销商用企微添加的微信客户打通数据<br>实现效果：共享客户信息，完善客户画像，促进成交</p><h2 id="%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" data-sign="793d867f44ad3ad84e020096c2d08d1d" data-lines="2"><a class="anchor" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"></a>准备工作</h2><ol data-sign="896ea9e601124a386a983a95a508148blist4" data-lines="4" class="cherry-list__default" start="1"><li>品牌有自己主体（或isv主体）的公众号、小程序</li><li>品牌创建上下游，经销商新建企业并加入上下游</li><li>品牌共享应用给经销商</li><li>经销商管理员授权应用获取「企业客户」权限</li></ol><h2 id="%E6%80%9D%E8%B7%AF" data-sign="a6d452421892aa068ba6063fb92ae0e6" data-lines="2"><a class="anchor" href="#%E6%80%9D%E8%B7%AF"></a>思路</h2><p data-sign="400ed16fcf471d0a0c5eff98d2b87029" data-type="p" data-lines="2"><strong>针对经销商已用企微添加的微信客户（当前接口）</strong><br>品牌通过以下接口把公众号、小程序粉丝的 unionid （从微信开放平台获取）转换成 external_userid</p><p data-sign="a58b2f40a9e2ac31bc9f94824ee06583" data-type="p" data-lines="1"><strong>针对经销商还未用企微添加的微信客户（<a href="https://developer.work.weixin.qq.com/document/path/97357" rel="nofollow">接口链接</a>）</strong></p><ol data-sign="c0a8e452463e9864b08bedb536e32df9list3" data-lines="3" class="cherry-list__default" start="1"><li>品牌提前把公众号、小程序粉丝的 unionid （从微信开放平台获取）转换成 pending_id</li><li>经销商用企微添加微信客户时，用 external_userid 查询 pending_id</li><li>unionid 和 external_userid 数据打通</li></ol><hr data-sign="hr2" data-lines="2"><h3 id="external-userid%E7%9A%84%E8%AF%B4%E6%98%8E" data-sign="10c33398677b1f4c6d95e8d94626c601" data-lines="2"><a class="anchor" href="#external-userid%E7%9A%84%E8%AF%B4%E6%98%8E"></a>external_userid的说明</h3><p data-sign="7196d1ab71dd747cc8eb7653a969e501" data-type="p" data-lines="4">external_userid是企业微信用于表示企业的外部联系人而设立的id，且满足以下条件<br>假设同一个微信用户属于多个下游企业的外部联系人<br>1.同一上游企业获取到不同企业的外部联系人的external_userid不一致。<br>2.不同一上游企业获取同一个企业的同一个外部联系人的external_userid也不一致。</p><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h3 id="%E9%80%9A%E8%BF%87unionid%E5%92%8Copenid%E6%9F%A5%E8%AF%A2external-userid" data-sign="9056e0a49cddbd7f81c2ae5c950ddff3" data-lines="1"><a class="anchor" href="#%E9%80%9A%E8%BF%87unionid%E5%92%8Copenid%E6%9F%A5%E8%AF%A2external-userid"></a>通过unionid和openid查询external_userid</h3><p data-sign="dd963d6099dc21536d2c86db6f019e1b" data-type="p" data-lines="3"><strong>请求方式：</strong>POST（<strong>HTTPS</strong>）<br><strong>请求地址</strong>：https://qyapi.weixin.qq.com/cgi-bin/corpgroup/unionid_to_external_userid?access_token=ACCESS_TOKEN</p><p data-sign="25dc236983d258c66e39f907f7c7cc33" data-type="p" data-lines="1"><strong>请求参数：</strong></p><div data-sign="d9a1bdcdefc233ed6ad1b30235993cdc" data-type="codeBlock" data-lines="8">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">  <span class="token string">"unionid"</span><span class="token operator">:</span><span class="token string">"xxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">  <span class="token string">"openid"</span><span class="token operator">:</span><span class="token string">"xxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">  <span class="token string">"corpid"</span><span class="token operator">:</span><span class="token string">"xxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">  <span class="token string">"mass_call_ticket"</span><span class="token operator">:</span><span class="token string">"xxxxx"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="0dfd3174e12e6989c47843d563b0dee9" data-lines="7">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">必须</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">access_token</td><td align="left">是</td><td align="left">上游应用的access_token</td></tr><tr><td align="left">unionid</td><td align="left">是</td><td align="left">微信客户的unionid</td></tr><tr><td align="left">openid</td><td align="left">是</td><td align="left">微信客户的openid</td></tr><tr><td align="left">corpid</td><td align="left">否</td><td align="left">需要换取的企业corpid，不填则拉取所有企业</td></tr><tr><td align="left">mass_call_ticket</td><td align="left">否</td><td align="left"><a href="#41709/%E8%8E%B7%E5%8F%96%E6%8E%A5%E5%8F%A3%E9%AB%98%E9%A2%91%E8%B0%83%E7%94%A8%E5%87%AD%E6%8D%AE" rel="nofollow">大批量调用凭据</a>, 适用于数据初始化场景, 有获取及使用限制</td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="be69a8d80807fc12104a6f71258f88a9" data-type="p" data-lines="1"><strong>权限说明：</strong></p><blockquote data-sign="ace40acf9163acd995e061e3e29f06bf_6" data-lines="6">调用该接口的应用必须是上下游共享的应用<br>上游企业须已认证<br>unionid（unionid的主体为绑定了该小程序的微信开放平台账号主体）和openid（即小程序账号主体）的主体需与当前企业的主体一致<br>openid与unionid必须是在同一个小程序获取到的<br>应用需要具有客户联系权限<br>自建应用/代开发应用可调用，第三方应用请查看<a href="#35863/%E5%9B%9B%E3%80%81%E4%BC%81%E4%B8%9A%E5%AE%A2%E6%88%B7%E5%BE%AE%E4%BF%A1unionid%E7%9A%84%E5%8D%87%E7%BA%A7%E6%96%B9%E6%A1%88" rel="nofollow">企业客户微信unionid的升级方案</a><br>调用频率最大为10万次/小时，48万次/天，750万次/月; 传入<a href="#41709" rel="nofollow">有效mass_call_ticket</a>，可不受此限制, 但是依然受到<a href="#10785" rel="nofollow">基础频率限制</a>。</blockquote><p data-sign="8c8bd07f58486862a201112e85376126" data-type="p" data-lines="2"><strong>返回结果：</strong></p><div data-sign="233a1d4942511892b1332904186cc656" data-type="codeBlock" data-lines="17">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">｛</span>
<span class="code-line"> <span class="token string">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line"> <span class="token string">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line"> <span class="token string">"external_userid_info"</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="code-line"> 		<span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"corpid"</span><span class="token operator">:</span><span class="token string">"AAAAA"</span><span class="token punctuation">,</span> </span>
<span class="code-line">			<span class="token string">"external_userid"</span><span class="token operator">:</span><span class="token string">"BBBB"</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span> </span>
<span class="code-line">		<span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"corpid"</span><span class="token operator">:</span><span class="token string">"CCCCC"</span><span class="token punctuation">,</span> </span>
<span class="code-line">			<span class="token string">"external_userid"</span><span class="token operator">:</span><span class="token string">"DDDDD"</span></span>
<span class="code-line">		<span class="token punctuation">}</span></span>
<span class="code-line">	<span class="token punctuation">]</span></span>
<span class="code-line">｝</span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="1"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="885eb548fb69890b503b8936c469adfc" data-lines="7">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">errcode</td><td align="left">返回码</td></tr><tr><td align="left">errmsg</td><td align="left">对返回码的文本描述内容</td></tr><tr><td align="left">external_userid_info</td><td align="left">该unionid对应的外部联系人信息</td></tr><tr><td align="left">external_userid_info.corpid</td><td align="left">所属企业id</td></tr><tr><td align="left">external_userid_info.external_userid</td><td align="left">外部联系人id</td></tr></tbody></table></div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>