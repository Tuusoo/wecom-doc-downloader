<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>构造网页授权链接 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        构造网页授权链接
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2024/07/30</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><p data-sign="034b9e310c3b4389934a684c601638af" data-type="p" data-lines="1">如果企业需要在打开的网页里面携带用户的身份信息，第一步需要构造如下的链接来获取code参数：</p><div data-sign="fb730b5a36c882a53c084eab5c19ab64" data-type="codeBlock" data-lines="3">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>open<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com<span class="token operator">/</span>connect<span class="token operator">/</span>oauth2<span class="token operator">/</span>authorize<span class="token operator">?</span>appid<span class="token operator">=</span><span class="token constant">CORPID</span><span class="token operator">&amp;</span>redirect_uri<span class="token operator">=</span><span class="token constant">REDIRECT_URI</span><span class="token operator">&amp;</span>response_type<span class="token operator">=</span>code<span class="token operator">&amp;</span>scope<span class="token operator">=</span>snsapi_base<span class="token operator">&amp;</span>state<span class="token operator">=</span><span class="token constant">STATE</span><span class="token operator">&amp;</span>agentid<span class="token operator">=</span><span class="token constant">AGENTID</span>#wechat_redirect</span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="849b88fbb66311d66eaf6d2c4918efb9" data-lines="9">
        <table class="cherry-table"><thead><tr><th>参数</th><th>必须</th><th>说明</th></tr></thead><tbody><tr><td>appid</td><td>是</td><td>企业的CorpID</td></tr><tr><td>redirect_uri</td><td>是</td><td>授权后重定向的回调链接地址，<strong>请使用urlencode对链接进行处理</strong></td></tr><tr><td>response_type</td><td>是</td><td>返回类型，此时固定为：code</td></tr><tr><td>scope</td><td>是</td><td>应用授权作用域。<br>snsapi_base：<a href="#15019/%E9%9D%99%E9%BB%98%E6%8E%88%E6%9D%83%E4%B8%8E%E6%89%8B%E5%8A%A8%E6%8E%88%E6%9D%83" rel="nofollow">静默授权</a>，可获取成员的基础信息（UserId）；<br>snsapi_privateinfo：<a href="#15019/%E9%9D%99%E9%BB%98%E6%8E%88%E6%9D%83%E4%B8%8E%E6%89%8B%E5%8A%A8%E6%8E%88%E6%9D%83" rel="nofollow">手动授权</a>，可获取成员的详细信息，包含头像、二维码等敏感信息（此时要求成员必须在应用可见范围内）。</td></tr><tr><td>state</td><td>否</td><td>重定向后会带上state参数，企业可以填写a-zA-Z0-9的参数值，长度不可超过128个字节</td></tr><tr><td>agentid</td><td>是</td><td>应用agentid，<strong>建议填上该参数</strong>（对于第三方应用和代开发自建应用，在填写该参数的情况下或者在工作台、聊天工具栏、应用会话内发起oauth2请求的场景中，会触发接口许可的自动激活）。snsapi_privateinfo时必填否则报错；</td></tr><tr><td>#wechat_redirect</td><td>是</td><td>终端使用此参数判断是否需要带上身份信息</td></tr></tbody></table></div><p data-sign="b258ad9d19069b5406b17c65d0b54028" data-type="p" data-lines="2">员工点击后，页面将跳转至 redirect_uri?code=CODE&amp;state=STATE，企业可根据code参数获得员工的userid。code长度最大为512字节。</p><p data-sign="297864cba95380cb8df98246287f4fd2" data-type="p" data-lines="2"><strong>示例：</strong></p><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="5c82f203589289a20be6220269e9b143" data-type="p" data-lines="2">假定当前企业CorpID：<code>wxCorpId</code><br>访问链接：<code>http://api.3dept.com/cgi-bin/query?action=get</code></p><p data-sign="3187ea9430b2fa8f00fca22ed0e4b221" data-type="p" data-lines="1">根据URL规范，将上述参数分别进行UrlEncode，得到拼接的OAuth2链接为：</p><div data-sign="a358fbe77de311c702103f98d1bb12d1" data-type="codeBlock" data-lines="3">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>open<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com<span class="token operator">/</span>connect<span class="token operator">/</span>oauth2<span class="token operator">/</span>authorize<span class="token operator">?</span>appid<span class="token operator">=</span>wxCorpId<span class="token operator">&amp;</span>redirect_uri<span class="token operator">=</span>http<span class="token operator">%</span><span class="token number">3</span>a<span class="token operator">%</span><span class="token number">2</span>f<span class="token operator">%</span><span class="token number">2</span>fapi<span class="token punctuation">.</span><span class="token number">3</span>dept<span class="token punctuation">.</span>com<span class="token operator">%</span><span class="token number">2</span>fcgi<span class="token operator">-</span>bin<span class="token operator">%</span><span class="token number">2</span>fquery<span class="token operator">%</span><span class="token number">3</span>faction<span class="token operator">%</span><span class="token number">3</span>dget<span class="token operator">&amp;</span>response_type<span class="token operator">=</span>code<span class="token operator">&amp;</span>scope<span class="token operator">=</span>snsapi_base<span class="token operator">&amp;</span>state<span class="token operator">=</span>#wechat_redirect</span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><blockquote data-sign="76d7f87e5a3dae189b4bc2fb2edde564_1" data-lines="1">注意，构造OAuth2链接中参数的redirect_uri是经过UrlEncode的</blockquote><p data-sign="12ca569fabeb3f1f6deeea1edd551c36" data-type="p" data-lines="1">员工点击后，页面将跳转至 </p><div data-sign="14d04806eba0cac353e1d22f74b2932e" data-type="codeBlock" data-lines="3">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span><span class="token number">3</span>dept<span class="token punctuation">.</span>com<span class="token operator">/</span>cgi<span class="token operator">-</span>bin<span class="token operator">/</span>query<span class="token operator">?</span>action<span class="token operator">=</span>get<span class="token operator">&amp;</span>code<span class="token operator">=</span>AAAAAAgG333qs9EdaPbCAP1VaOrjuNkiAZHTWgaWsZQ<span class="token operator">&amp;</span>state<span class="token operator">=</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="6dfae68599b871cef738e3b9b978447e" data-type="p" data-lines="2">企业可根据code参数调用<a href="#15047" rel="nofollow">获取员工的信息</a></p><h3 id="scope%E7%9A%84%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5" data-sign="5dea0c4036bbbbe33424879c260e0953" data-lines="2"><a class="anchor" href="#scope%E7%9A%84%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5"></a>scope的特殊情况</h3><ul data-sign="80d7c1b9a9caa531fac40d7a76338315list1" data-lines="1" class="cherry-list__default"><li>当oauth2中appid=corpid时，scope为snsapi_privateinfo时，必须填agentid参数，<strong>否则系统会视为snsapi_base，不会返回敏感信息</strong>。同时，要求成员必须在应用可见范围内，否则页面会报错提示成员不在可见范围内。</li></ul></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>