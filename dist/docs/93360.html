<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>概述 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        概述
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2022/01/11</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="2eb2f95bc9ee4ed6aef310d2f6526798-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E6%98%AF%E4%BB%80%E4%B9%88" class="level-2">企业互联是什么</a></li><li class="toc-li"><a href="#%E6%80%8E%E4%B9%88%E4%BA%92%E8%81%94" class="level-2">怎么互联</a></li><li class="toc-li"><a href="#%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3" class="level-2">企业互联使用接口</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E8%8E%B7%E5%8F%96%E5%BA%94%E7%94%A8%E5%85%B1%E4%BA%AB%E4%BF%A1%E6%81%AF" class="level-3">获取应用共享信息</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E8%80%85%E4%BF%A1%E6%81%AF" class="level-3">获取当前使用者信息</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E4%BD%BF%E7%94%A8api%E6%8E%A5%E5%8F%A3" class="level-3">使用API接口</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E4%BD%BF%E7%94%A8jsapi%E6%8E%A5%E5%8F%A3" class="level-3">使用JSAPI接口</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3" class="level-3">使用小程序接口</a></li><li class="toc-li"><a href="#%E5%A4%84%E7%90%86%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E7%9A%84%E5%9B%9E%E8%B0%83%E4%BA%8B%E4%BB%B6" class="level-2">处理企业互联的回调事件</a></li></dir><hr data-sign="hr2" data-lines="2"><h2 id="%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E6%98%AF%E4%BB%80%E4%B9%88" data-sign="bda1dfac46609479c9d2fb1c4326a8c4" data-lines="2"><a class="anchor" href="#%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E6%98%AF%E4%BB%80%E4%B9%88"></a>企业互联是什么</h2><p data-sign="a77924f0b0524fba4a0a58eba4cded1d" data-type="p" data-lines="2">企业互联是企业微信提供的，针对多个企业主体间跨组织沟通、协同的解决方案。<br>使用此功能，可以连接多个企业的通讯录、实现跨企业高效沟通，还能随时共享应用。</p><h2 id="%E6%80%8E%E4%B9%88%E4%BA%92%E8%81%94" data-sign="14768dd60505e2e9bb177cf3857bcd49" data-lines="2"><a class="anchor" href="#%E6%80%8E%E4%B9%88%E4%BA%92%E8%81%94"></a>怎么互联</h2><p data-sign="c80c3904cb707759b5915df66fab81ed" data-type="p" data-lines="2">1、有互联权限的企业在 Web 管理后台，点击右上角“企业互联”进入互联管理后台<br><img src="images/93360/ed419159.png" alt=""></p><p data-sign="9df55dffd16c7f864ffb7c0878c126d2" data-type="p" data-lines="3">2、在欢迎页点击“开始使用”按钮，系统自动创建一个互联<br><img src="images/93360/d4f4bc5b.png" alt=""></p><p data-sign="6386e9dd949118ed59842548783e63ce" data-type="p" data-lines="3">3、进入首页，点击“常用入口”-“邀请加入”，在弹窗中邀请企业加入互联<br><img src="images/93360/5a218545.png" alt=""></p><h2 id="%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3" data-sign="83c7608ef922297632df4d5b5c44308b" data-lines="2"><a class="anchor" href="#%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3"></a>企业互联使用接口</h2><p data-sign="7182cbee654346121b1faad12f860855" data-type="p" data-lines="3">上级企业将应用分享给下级企业后，需要使用特定的接口获取下级应用的身份和权限才能控制下级应用，因此需要做一定的适配。<br>对于第三方来说，当上级企业将第三方应用分享给下级企业后，企业微信会为每个下级企业分别安装授权该第三方应用，并<a href="#14951" rel="nofollow">回调授权通知</a>给第三方，所以相当于是多了一种授权安装的渠道，不同的是，该情况下企业微信还会<a href="#25681" rel="nofollow">回调共享应用事件</a>给第三方应用，之后第三方应用可<a href="#25951" rel="nofollow">获取应用共享信息</a>，以及<a href="#25575" rel="nofollow">获取下级企业付费版本信息</a>。<br>下面简要说明需要注意的地方。</p><h3 id="%E8%8E%B7%E5%8F%96%E5%BA%94%E7%94%A8%E5%85%B1%E4%BA%AB%E4%BF%A1%E6%81%AF" data-sign="5d8272eac096f1a8c13dd2a09dd26d50" data-lines="2"><a class="anchor" href="#%E8%8E%B7%E5%8F%96%E5%BA%94%E7%94%A8%E5%85%B1%E4%BA%AB%E4%BF%A1%E6%81%AF"></a>获取应用共享信息</h3><p data-sign="29f5260c2112f0e407066226e7041ea4" data-type="p" data-lines="1">上级企业的管理员在管理端分享应用给下级企业后，会收到<a href="#12974/%E5%85%B1%E4%BA%AB%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6%E5%9B%9E%E8%B0%83" rel="nofollow">共享应用事件回调</a>，此时上级企业需要通过接口<a href="#24909" rel="nofollow">获取应用共享信息</a>获取分享后的下级企业的corpid和应用id列表并保存起来，后面调接口的时候需要用到。</p><h3 id="%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E8%80%85%E4%BF%A1%E6%81%AF" data-sign="8233396151af62d6ccd050215bd79602" data-lines="2"><a class="anchor" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E8%80%85%E4%BF%A1%E6%81%AF"></a>获取当前使用者信息</h3><p data-sign="01ed70b7331cba7cb920d91bc9173cef" data-type="p" data-lines="2">因为应用可以分享给多个下级企业，所以上级企业调用接口前，需要得知当前使用者到底属于哪个企业。<br>见<a href="#15232" rel="nofollow">身份验证</a>相关接口。与普通应用使用方法的不同点在于：</p><ul data-sign="de3c7fabaf6677414020b059793c1f8dlist2" data-lines="2" class="cherry-list__default"><li><a href="#15048" rel="nofollow">构造网页授权链接</a>时，参数<code>appid</code>填<strong>上级企业</strong>的corpid （第三方应用无变化，参见<a href="#15121" rel="nofollow">构造第三方应用oauth2链接</a>）</li><li><a href="#15047" rel="nofollow">获取访问用户身份</a>，对于企业互联，返回的UserId格式如：CorpId/userid，分解即可得到下级企业的corpid（第三方应用无变化，参见<a href="#15122" rel="nofollow">第三方获取访问用户身份</a>）</li></ul><h3 id="%E4%BD%BF%E7%94%A8api%E6%8E%A5%E5%8F%A3" data-sign="684a4d5305b1538cb36c0bde84083252" data-lines="2"><a class="anchor" href="#%E4%BD%BF%E7%94%A8api%E6%8E%A5%E5%8F%A3"></a>使用API接口</h3><ul data-sign="5c96bdd64eb79ca878fb1154fe631478list6" data-lines="6" class="cherry-list__default"><li>第三方应用。不同点在于：<a href="#14942" rel="nofollow">获取企业永久授权码</a>接口不返回安装的管理员信息。</li><li>自建应用。不同点在于：需要换取下级企业的access_token来调接口，实现与下级应用交互<br><img src="images/93360/1c35e01e.png" alt=""><br>① <a href="#15074" rel="nofollow">获取上级企业access_token</a><br>② <a href="#24919" rel="nofollow">获取下级企业access_token</a><br>③ 使用第②步骤得到的<strong>下级企业</strong>的access_token调用各种API接口。例如通过调用<a href="#10087" rel="nofollow">获取应用</a>接口获取下级应用的可见范围，通过调用<a href="#10019" rel="nofollow">读取成员</a>接口获取下级用户详情</li></ul><h3 id="%E4%BD%BF%E7%94%A8jsapi%E6%8E%A5%E5%8F%A3" data-sign="5a9502a0913ef843b798d7c3863b0751" data-lines="2"><a class="anchor" href="#%E4%BD%BF%E7%94%A8jsapi%E6%8E%A5%E5%8F%A3"></a>使用JSAPI接口</h3><ul data-sign="5e80dfab37cc8a72346b07dd535b2b91list8" data-lines="8" class="cherry-list__default"><li>第三方应用。无变化</li><li>自建应用。与<a href="#14931" rel="nofollow">普通企业使用JSAPI</a>不同点在于：需要使用下级企业 jsapi_ticket 来进行jsapi签名，并用下级企业的身份调用agentConfig<br><img src="images/93360/12b12a8f.png" alt=""><br>① <a href="#15074" rel="nofollow">获取上级企业access_token</a><br>② <a href="#24919" rel="nofollow">获取下级企业的access_token</a><br>③ <a href="#14924" rel="nofollow">获取jsapi_ticket并签名</a>。<strong>特别注意</strong>，需要使用第②步骤得到的<strong>下级企业</strong>的access_token获取jsapi_ticket<br>④ <a href="#14931" rel="nofollow">agentConfig</a>。<strong>特别注意</strong>，此时<code>appId</code>和<code>agentId</code>参数，需要填<strong>下级企业</strong>的corpid和应用id。<br></li></ul><h3 id="%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3" data-sign="8cb760329508a337c0122e13dac110f9" data-lines="1"><a class="anchor" href="#%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3"></a>使用小程序接口</h3><ul data-sign="76d499be9221f90d338f7e2c2e001d4flist8" data-lines="8" class="cherry-list__default"><li>第三方应用。无变化，通过<a href="#14944" rel="nofollow">永久授权码获取企业access_token</a>。</li><li>自建应用。与普通企业<a href="#16055" rel="nofollow">小程序登录流程</a>的不同点在于：需要使用<a href="#25574" rel="nofollow">获取下级企业的小程序session</a>来转为下级企业的登录session<br><img src="images/93360/7e62acc1.png" alt=""><br>① <a href="#15074" rel="nofollow">获取上级企业access_token</a><br>② <a href="#16056" rel="nofollow">获取上级sessionkey</a><br>③ <a href="#24919" rel="nofollow">获取下级企业的互联access_token</a><br>④ <a href="#25574" rel="nofollow">换取下级企业的sessionkey</a><br></li></ul><h2 id="%E5%A4%84%E7%90%86%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E7%9A%84%E5%9B%9E%E8%B0%83%E4%BA%8B%E4%BB%B6" data-sign="a13938952c22dc8fd731db23b2716890" data-lines="1"><a class="anchor" href="#%E5%A4%84%E7%90%86%E4%BC%81%E4%B8%9A%E4%BA%92%E8%81%94%E7%9A%84%E5%9B%9E%E8%B0%83%E4%BA%8B%E4%BB%B6"></a>处理企业互联的回调事件</h2><p data-sign="c78f69dd43ff7906139323fddbc5862b" data-type="p" data-lines="1">对于企业互联的应用，因为应用统一由上级企业管理，所以相关事件和消息均回调给<strong>上级企业</strong>。需注意以下几点：</p><ul data-sign="a0f5acc01b7466d9a72bdd6431e279dflist12" data-lines="12" class="cherry-list__default"><li>新增共享应用事件回调。当应用分享或解除分享后，会触发该事件给上级企业或第三方服务商。收到该事件后，需要调用<a href="#24909" rel="nofollow">获取应用共享信息</a>更新应用的分享列表并存储<br><a href="#25681" rel="nofollow">第三方应用共享应用事件回调</a>。当上级企业管理员在管理端分享(或解除分享)应用给下级企业后（若需要敏感权限需下级企业确认），会推送该事件给服务商。<br><a href="#12974/%E5%85%B1%E4%BA%AB%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6%E5%9B%9E%E8%B0%83" rel="nofollow">自建应用共享应用事件回调</a>。当上级企业管理员在管理端分享(或解除分享)应用给下级企业后（若需要敏感权限需下级企业确认），会推送该事件给上级企业。<br></li><li><a href="#12974" rel="nofollow">应用事件</a>。第三方应用无变化；对于自建应用，所有下级企业的用户产生的应用事件，均回调给上级企业的回调URL，而事件里的企业信息是下级企业的信息。<br>例如<a href="#12974/%E6%88%90%E5%91%98%E5%85%B3%E6%B3%A8%E5%8F%8A%E5%8F%96%E6%B6%88%E5%85%B3%E6%B3%A8%E4%BA%8B%E4%BB%B6" rel="nofollow">成员关注及取消关注事件</a>：<br><div data-sign="abc2226fff77aa7a14554716fcb2e83e" data-type="codeBlock" data-lines="9">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">	<span class="token operator">&lt;</span>xml<span class="token operator">&gt;</span></span>
<span class="code-line">		<span class="token operator">&lt;</span>ToUserName<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>toUser<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ToUserName<span class="token operator">&gt;</span></span>
<span class="code-line">		<span class="token operator">&lt;</span>FromUserName<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>UserID<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>FromUserName<span class="token operator">&gt;</span></span>
<span class="code-line">		<span class="token operator">&lt;</span>CreateTime<span class="token operator">&gt;</span><span class="token number">1348831860</span><span class="token operator">&lt;</span><span class="token operator">/</span>CreateTime<span class="token operator">&gt;</span></span>
<span class="code-line">		<span class="token operator">&lt;</span>MsgType<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>MsgType<span class="token operator">&gt;</span></span>
<span class="code-line">		<span class="token operator">&lt;</span>Event<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>subscribe<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Event<span class="token operator">&gt;</span></span>
<span class="code-line">		<span class="token operator">&lt;</span>AgentID<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>AgentID<span class="token operator">&gt;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><br>事件中<code>ToUserName</code>是<strong>下级</strong>企业corpid，<code>FromUserName</code>是<strong>下级</strong>企业的明文userid<br></li><li><a href="#12973" rel="nofollow">回调消息</a>。第三方应用无变化；对于自建应用，所有下级企业的回调消息均推送给上级企业的回调URL，而消息里面的企业信息是下级企业的信息。<br></li><li><a href="#18271" rel="nofollow">版本变更事件</a>。对于付费购买的第三方应用，上级企业付费等行为产生应用版本变更后，所有下级企业均会产生版本变更事件给服务商</li></ul></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>