<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>获取命中关键词规则的会话记录 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        获取命中关键词规则的会话记录
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2025/09/09</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><p data-sign="e87921c8f258195d957a739c71f3017e" data-type="p" data-lines="1">通过该接口，可以获取一段时间内命中关键词规则或关键行为的会话记录。</p><p data-sign="fd1c44250d466f3563712de3fc0f1925" data-type="p" data-lines="1"><strong>权限说明</strong></p><blockquote data-sign="02be6e69b50a75cbb876dd6414d8410e_1" data-lines="1">1. 只可获取5天内的企业客户会话记录数据<br>2. 一次拉取调用上限1000条会话记录，可以通过分页拉取的方式来依次拉取</blockquote><div class="cherry-table-container" data-sign="4b2d6996e6b5f373169096c48c582d02" data-lines="5">
        <table class="cherry-table"><thead><tr><th>应用类型</th><th>权限要求</th></tr></thead><tbody><tr><td>自建应用</td><td>需具备「<span style="color:#ff0000">数据与智能专区权限</span>」</td></tr><tr><td>代开发应用</td><td>需具备「<span style="color:#ff0000">数据与智能专区权限</span>」</td></tr><tr><td>第三方应用</td><td>需具备「<span style="color:#ff0000">数据与智能专区权限</span>」</td></tr></tbody></table></div><p data-sign="9b46db12cc8830161cccaa14f68299ed" data-type="p" data-lines="3"><strong>请求方法</strong><br>通过SDK调用，具体方式参考<a href="#54006" rel="nofollow">专区程序使用指引</a>。</p><p data-sign="4bbc601fd3028e9b2a9a968e378491df" data-type="p" data-lines="3"><strong>请求接口名：</strong> <br>get_hit_msg_list</p><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="382edfac6a8b56ec46332834f416136e" data-type="p" data-lines="1"><strong>请求包体：</strong></p><div data-sign="5270f2536502dc4b73c1bcfde7668e1f" data-type="codeBlock" data-lines="9">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token string">"cursor"</span><span class="token operator">:</span><span class="token string">"RMTJID"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"token"</span><span class="token operator">:</span><span class="token string">"NGEJKGOEGJKOEGNEOAGOEGOKEGHOEEEEE"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"need_detail"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"limit"</span><span class="token operator">:</span><span class="token number">200</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="a6f166751c48777a6cf993befb0a19f1" data-type="p" data-lines="2"><strong>参数说明：</strong> </p><div class="cherry-table-container" data-sign="000b71b79dc38254d10cd158b330f8f9" data-lines="7">
        <table class="cherry-table"><thead><tr><th>参数</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>cursor</td><td>否</td><td>上一次调用时返回的next_cursor，第一次拉取可以不填。若不填，从5天内最早的消息开始返回。不多于64字节</td></tr><tr><td>token</td><td>否</td><td>回调事件返回的 <code>token</code> 字段，10分钟内有效；建议都从回调事件中取出token填上，否则接口会有严格的频率限制。不多于128字节</td></tr><tr><td>need_detail</td><td>否</td><td>是否需要消息详情，默认为否</td></tr><tr><td>limit</td><td>否</td><td>每次调用返回的记录数，默认为200，最大不超过1000</td></tr><tr><td>begin_time</td><td>否</td><td>仅用于需要重新拉取数据而不清楚具体cursor的场景，正常情况不应该使用该字段。会从begin_time附近的数据开始返回。</td></tr></tbody></table></div><p data-sign="8c8bd07f58486862a201112e85376126" data-type="p" data-lines="1"><strong>返回结果：</strong></p><div data-sign="0b35c6dd213a39b97138d316c4db56f2" data-type="codeBlock" data-lines="38">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token string">"errcode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"errmsg"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"has_more"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"next_cursor"</span><span class="token operator">:</span> <span class="token string">"JGNLGEHJGIE"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"msg_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token string">"msgid"</span><span class="token operator">:</span> <span class="token string">"xxxmsgid"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token string">"msg_detail"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"sender"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">				<span class="token string">"type"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">				<span class="token string">"id"</span><span class="token operator">:</span> <span class="token string">"woxxxxxmmgjiegjie"</span></span>
<span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"receiver_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="code-line">					<span class="token string">"type"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">					<span class="token string">"id"</span><span class="token operator">:</span> <span class="token string">"woAAAAAAAAAAA"</span></span>
<span class="code-line">				<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">				<span class="token punctuation">{</span></span>
<span class="code-line">					<span class="token string">"type"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">					<span class="token string">"id"</span><span class="token operator">:</span> <span class="token string">"wmXXXXXXXXXXXXX"</span></span>
<span class="code-line">				<span class="token punctuation">}</span></span>
<span class="code-line">			<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"chatid"</span><span class="token operator">:</span> <span class="token string">"wrXXXXXXXXXX"</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"send_time"</span><span class="token operator">:</span> <span class="token number">166666666</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"msgtype"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"service_encrypt_info"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">				<span class="token string">"encrypted_secret_key"</span><span class="token operator">:</span> <span class="token string">"KEYAAAAAAABBBBBB"</span><span class="token punctuation">,</span></span>
<span class="code-line">				<span class="token string">"public_key_ver"</span><span class="token operator">:</span> <span class="token number">1</span></span>
<span class="code-line">			<span class="token punctuation">}</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token string">"hit_rule_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"rule_id"</span><span class="token operator">:</span> <span class="token string">"vvvvvvvvvvvvvvvvvxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"has_hit_keyword"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"semantics_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="1"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="1b2e19bafc0bc54f0e2280378ddbb282" data-lines="13">
        <table class="cherry-table"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>errcode</td><td>错误码</td></tr><tr><td>errmsg</td><td>错误码说明</td></tr><tr><td>has_more</td><td>是否还有更多数据。0-否；1-是。</td></tr><tr><td>next_cursor</td><td>下次调用带上该值，则从当前的位置继续往后拉，以实现增量拉取。强烈建议对该字段入库保存，每次请求读取带上，请求结束后更新。避免因意外丢，导致必须从头开始拉取，引起消息延迟。</td></tr><tr><td>msg_list</td><td>客户会话列表</td></tr><tr><td>msgid</td><td>每条消息对应的msgid</td></tr><tr><td>msg_detail</td><td>消息详情，详见<a href="#MsgDetail" rel="nofollow">MsgDetail</a>。<code>仅need_detail=1时返回</code></td></tr><tr><td>hit_rule_list</td><td>命中的关键词规则列表</td></tr><tr><td>hit_rule_list.rule_id</td><td>命中的规则id</td></tr><tr><td>hit_rule_list.has_hit_keyword</td><td>是否命中该规则的关键词列表</td></tr><tr><td>hit_rule_list.semantics_list</td><td>该规则中命中的关键行为列表，1：红包；2：手机号码；3：邮箱地址；4：微信名片；5：带二维码图片；6：撤回消息；7：银行卡号；8：身份证号；9-发送文件（不包括微盘文件）；10-发送链接（发送链接消息或者发送的文本消息中包含链接）；11-发送小程序；12-发送客户欢迎语</td></tr></tbody></table></div><p data-sign="4dc2ccccf00a6fcc8bfe90f517a31a4f" data-type="p" data-lines="1"><strong>MsgDetail</strong></p><div class="cherry-table-container" data-sign="b1b4b9df8748ea4c3a07b5f8f0bb1060" data-lines="11">
        <table class="cherry-table"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>sender.type</td><td>消息发送者身份类型。1：员工；2：外部联系人。</td></tr><tr><td>sender.id</td><td>消息发送者的id，当消息发送者为员工时，该字段为员工的userid；当消息发送者的身份为外部联系人时，该字段为外部联系人的id。</td></tr><tr><td>chatid</td><td>群ID，当消息是群消息的时候会返回该字段。</td></tr><tr><td>receiver_list.type</td><td>消息接受者的身份类型。1：员工；2：外部联系人; 3：机器人。</td></tr><tr><td>receiver_list.id</td><td>当接收者身份类型为员工时，该字段为员工open_userid；当接收者身份类型为外部联系人时，该字段为外部联系人id；当接收者身份类型为机器人式为机器人ID。</td></tr><tr><td>send_time</td><td>消息发送时间对应的unix时间戳。</td></tr><tr><td>msgtype</td><td>消息类型。枚举值定义见下方<a href="#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B" rel="nofollow">消息类型</a>。</td></tr><tr><td>service_encrypt_info.encrypted_secret_key</td><td>加密后的密钥，使用<a href="#51799" rel="nofollow">设置公钥</a>设置的公钥进行加密，需要服务商用私钥解密后才可传入<a href="#50920" rel="nofollow">会话展示组件</a>。</td></tr><tr><td>service_encrypt_info.public_key_ver</td><td>公钥版本号。</td></tr></tbody></table></div><p data-sign="95b84522e7c7cb9fbdcd68803a30cfe6" data-type="p" data-lines="1"><strong>消息类型</strong></p><div class="cherry-table-container" data-sign="cffc0d67734247c73addc12ec3e12999" data-lines="12">
        <table class="cherry-table"><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>文本</td></tr><tr><td>2</td><td>图片</td></tr><tr><td>4</td><td>链接</td></tr><tr><td>5</td><td>小程序</td></tr><tr><td>6</td><td>语音消息</td></tr><tr><td>8</td><td>文件</td></tr><tr><td>9</td><td>名片</td></tr><tr><td>13</td><td>红包</td></tr><tr><td>20</td><td>图文混合消息</td></tr><tr><td>21</td><td>音频存档</td></tr></tbody></table></div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>