<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>回调配置 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        回调配置
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2024/12/13</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="66481464611ef5e18a0e5680396802dd-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#1-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1" class="level-2">1. 什么时候需要回调服务</a></li><li class="toc-li"><a href="#2-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%93%AA%E4%BA%9B%E9%85%8D%E7%BD%AE" class="level-2">2. 回调服务需要哪些配置</a></li><li class="toc-li"><a href="#3-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E5%93%AA%E4%BA%9B%E5%8A%9F%E8%83%BD" class="level-2">3. 回调服务需要实现哪些功能</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#31-%E6%94%AF%E6%8C%81http-get%E8%AF%B7%E6%B1%82%E9%AA%8C%E8%AF%81url%E6%9C%89%E6%95%88%E6%80%A7" class="level-3">3.1 支持Http Get请求验证URL有效性</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#32-%E6%94%AF%E6%8C%81http-post%E8%AF%B7%E6%B1%82%E6%8E%A5%E6%94%B6%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE" class="level-3">3.2 支持Http Post请求接收业务数据</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#33-%E8%8E%B7%E5%8F%96%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84ip%E6%AE%B5" class="level-3">3.3 获取企业微信服务器的ip段</a></li><li class="toc-li"><a href="#4-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1demo" class="level-2">4. 回调服务demo</a></li></dir><h2 id="1-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1" data-sign="fe57c5d8ecc8065faa99d9d84dd95220" data-lines="2"><a class="anchor" href="#1-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1"></a>1. 什么时候需要回调服务</h2><p data-sign="0de86e6e9ec5ab73e49fcd37c577d261" data-type="p" data-lines="1">在集成企业微信与内部系统时，我们往往需要搭建一个回调服务。回调服务，可以实现：</p><ul data-sign="1c2323174ef4ee221c72d5aece3dd882list2" data-lines="2" class="cherry-list__default"><li><strong>自定义丰富的服务行为</strong>。比如，用户向应用发消息时，识别消息关键词，回复不同的消息内容；用户点击应用菜单时，转化为指令，执行自动化任务。</li><li><strong>可以及时获取到状态变化</strong>。比如，通讯录发生变化时，不需要定时去拉取通讯录对比，而是实时地获取到变化的通讯录节点，进行同步。</li></ul><h2 id="2-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%93%AA%E4%BA%9B%E9%85%8D%E7%BD%AE" data-sign="fb3679b291001d51d681e05063703886" data-lines="2"><a class="anchor" href="#2-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%93%AA%E4%BA%9B%E9%85%8D%E7%BD%AE"></a>2. 回调服务需要哪些配置</h2><div data-sign="e9a8336e1549c4e455774d608e8d59ac" data-type="div" data-lines="4">配置回调服务，需要有三个配置项，分别是：<strong>URL</strong>, <strong>Token</strong>, <strong>EncodingAESKey</strong>。<br>首先，<strong>URL为回调服务地址</strong>，由开发者搭建（需要满足接口要求，参考<a href="#14961/3-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E5%93%AA%E4%BA%9B%E5%8A%9F%E8%83%BD" rel="nofollow">第3部分说明</a>），用于接收通知消息或者事件。<br><center><img src="images/90930/b70978a9.png" alt=""></center></div><p data-sign="7d358aa4f4ac4bd5dea59c612520b226" data-type="p" data-lines="2">其次，<strong>Token用于计算签名</strong>，由英文或数字组成且长度不超过32位的自定义字符串。开发者提供的URL是公开可访问的，这就意味着拿到这个URL，就可以往该链接推送消息。那么URL服务需要解决两个问题：</p><ul data-sign="e8500c6feadd6456c1946bced9936cb5list2" data-lines="2" class="cherry-list__default"><li>如何分辨出是否为企业微信来源</li><li>如何分辨出推送消息的内容是否被篡改</li></ul><p data-sign="43208c58e8854525c72050518a7d7848" data-type="p" data-lines="1">通过数字签名就可以解决上述的问题。具体为：约定Token作为密钥，仅开发者和企业微信知道，在传输中不可见，用于参与签名计算。企业微信在推送消息时，将消息内容与Token计算出签名。开发者接收到推送消息时，也按相同算法计算出签名。如果为同一签名，则可信任来源为企业微信，并且内容是完整的。</p><ul data-sign="8ef45fd448ea32a38632419114d8f51blist3" data-lines="3" class="cherry-list__default"><li>如果非企业微信来源，由于攻击者没有正确的Token，无法算出正确的签名；</li><li>如果消息内容被篡改，由于开发者会将接收的消息内容与Token重算一次签名，该值与参数的签名不一致，则会拒绝该请求。<br><center><img src="images/90930/0985a8b0.png" alt=""></center></li></ul><div data-sign="13df312260e2fe3fa0163084be146989" data-type="div" data-lines="2">最后，<strong>EncodingAESKey用于消息内容加密</strong>，由英文或数字组成且长度为43位的自定义字符串。由于消息是在公开的因特网上传输，消息内容是可被截获的，如果内容未加密，则截获者可以直接阅读消息内容。若消息内容包含一些敏感信息，就非常危险了。EncodingAESKey就是在这个背景基础上提出，将发送的内容进行加密，并组装成一定格式后再发送。<br><center><img src="images/90930/577d7104.png" alt=""></center></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h2 id="3-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E5%93%AA%E4%BA%9B%E5%8A%9F%E8%83%BD" data-sign="3b04b6d17ad1c9b3b825a0607e5af8ac" data-lines="1"><a class="anchor" href="#3-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E5%93%AA%E4%BA%9B%E5%8A%9F%E8%83%BD"></a>3. 回调服务需要实现哪些功能</h2><p data-sign="3e6c0b7763e3c78106ecbc197d59b19b" data-type="p" data-lines="1">配置回调服务时，<strong>需要能同时支持HttpGet以及HttpPost两种能力</strong>，</p><ul data-sign="2acb1bd36340d6cfced629088a8df7d0list4" data-lines="4" class="cherry-list__default"><li>企业微信会先判断URL服务是否具备解析企业微信推送消息的能力。<br>具体方式是，企业微信往URL服务上发一条Get请求带签名及密文参数到URL服务上，如果URL服务检查签名通过，并能正确返回密文参数对应的明文字符串，则验证通过。此时在企业微信的配置就开始生效。</li><li>后续的业务请求（比如应用菜单的点击事件，用户消息等），都会类似的方式（签名+密文）向服务URL推送消息。URL服务验证签名通过后，需要将POST数据解密，就可以得到对应的业务消息明文。<br><center><img src="images/90930/aa141401.png" alt=""></center></li></ul><h3 id="31-%E6%94%AF%E6%8C%81http-get%E8%AF%B7%E6%B1%82%E9%AA%8C%E8%AF%81url%E6%9C%89%E6%95%88%E6%80%A7" data-sign="07ac53bc958af5312248c9eae97b6010" data-lines="2"><a class="anchor" href="#31-%E6%94%AF%E6%8C%81http-get%E8%AF%B7%E6%B1%82%E9%AA%8C%E8%AF%81url%E6%9C%89%E6%95%88%E6%80%A7"></a>3.1 支持Http Get请求验证URL有效性</h3><p data-sign="89e08c72d107a843e9a1f9346266bf14" data-type="p" data-lines="2">假设企业的接收消息的URL设置为https://api.3dept.com。<br>企业管理员在保存回调配置信息时，企业微信会发送一条验证消息到填写的URL，请求内容如下：</p><p data-sign="89c04a2bc4f1a8beb54273382861c5d2" data-type="p" data-lines="4"><strong>请求方式：</strong><font color="red">GET</font><br><strong>请求地址</strong>：https://api.3dept.com/?msg_signature=ASDFQWEXZCVAQFASDFASDFSS&amp;timestamp=13500001234&amp;nonce=123412323&amp;echostr=ENCRYPT_STR<br><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="ca08742bb329692dfb615c2ddb54d85c" data-lines="6">
        <table class="cherry-table"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>msg_signature</td><td>String</td><td>企业微信加密签名，msg_signature计算结合了企业填写的token、请求中的timestamp、nonce、加密的消息体。签名计算方法参考 <a href="#12976/%E6%B6%88%E6%81%AF%E4%BD%93%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C" rel="nofollow">消息体签名检验</a></td></tr><tr><td>timestamp</td><td>Integer</td><td>时间戳。与nonce结合使用，用于防止请求重放攻击。</td></tr><tr><td>nonce</td><td>String</td><td>随机数。与timestamp结合使用，用于防止请求重放攻击。</td></tr><tr><td>echostr</td><td>String</td><td>加密的字符串。需要<a href="#12976/%E5%AF%86%E6%96%87%E8%A7%A3%E5%AF%86%E5%BE%97%E5%88%B0msg%E7%9A%84%E8%BF%87%E7%A8%8B" rel="nofollow">解密得到消息内容明文</a>，解密后有random、msg_len、msg、receiveid四个字段，其中msg即为消息内容明文</td></tr></tbody></table></div><p data-sign="5deb1b0e3975c6f9b0025e2aa7f5e933" data-type="p" data-lines="1">回调服务需要作出正确的响应才能通过URL验证，具体操作如下：</p><ol data-sign="4158fdef0d1ebdd1ad3d9ca1f8e8dcfblist4" data-lines="4" class="cherry-list__default" start="1"><li>对收到的请求，解析上述的各个参数值（参数值需要做Urldecode处理）</li><li>根据已有的token，结合第1步获取的参数timestamp, nonce, echostr重新计算签名，然后与参数msg_signature检查是否一致，确认调用者的合法性。计算方法参考：<a href="#12976/%E6%B6%88%E6%81%AF%E4%BD%93%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C" rel="nofollow">消息体签名检验</a></li><li><a href="#12976/%E5%AF%86%E6%96%87%E8%A7%A3%E5%AF%86%E5%BE%97%E5%88%B0msg%E7%9A%84%E8%BF%87%E7%A8%8B" rel="nofollow">解密echostr</a>参数得到消息内容（即msg字段）</li><li>在<font color="red">1秒内</font>响应GET请求，响应内容为上一步得到的明文消息内容（<font color="red">不能加引号，不能带bom头，不能带换行符</font>）</li></ol><blockquote data-sign="57a57693e775df296a322ad515da8f20_2" data-lines="2">步骤2~3可以直接使用<a href="#12976/%E9%AA%8C%E8%AF%81URL%E5%87%BD%E6%95%B0" rel="nofollow">验证URL函数</a>一步到位。<br>你可以访问 <a href="https://open.work.weixin.qq.com/wwopen/devtool/interface/combine" rel="nofollow">接口调试工具</a> （接口类型：建立连接，接口列表：测试回调模式）进行调试</blockquote><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h3 id="32-%E6%94%AF%E6%8C%81http-post%E8%AF%B7%E6%B1%82%E6%8E%A5%E6%94%B6%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE" data-sign="b5f6022250f6ca00fcd43c56af9899d2" data-lines="1"><a class="anchor" href="#32-%E6%94%AF%E6%8C%81http-post%E8%AF%B7%E6%B1%82%E6%8E%A5%E6%94%B6%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE"></a>3.2 支持Http Post请求接收业务数据</h3><p data-sign="42fe9dffa28eb01203b1cbd119d60424" data-type="p" data-lines="4">假设企业的接收消息的URL设置为https://api.3dept.com。<br>当用户触发回调行为时，企业微信会发送回调消息到填写的URL，请求内容如下：<br><strong>请求方式：</strong><font color="red">POST</font><br><strong>请求地址 ：</strong>https://api.3dept.com/?msg_signature=ASDFQWEXZCVAQFASDFASDFSS&amp;timestamp=13500001234&amp;nonce=123412323</p><p data-sign="098a535986dbdcd7ad39881538b2a4d2" data-type="p" data-lines="1"><strong>接收数据格式 ：</strong></p><div data-sign="12e15bfed7b2ba49b41e7a95c55f80d5" data-type="codeBlock" data-lines="7">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token operator">&lt;</span>xml<span class="token operator">&gt;</span> </span>
<span class="code-line">   <span class="token operator">&lt;</span>ToUserName<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>toUser<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ToUserName<span class="token operator">&gt;</span></span>
<span class="code-line">   <span class="token operator">&lt;</span>AgentID<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>toAgentID<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>AgentID<span class="token operator">&gt;</span></span>
<span class="code-line">   <span class="token operator">&lt;</span>Encrypt<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>msg_encrypt<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Encrypt<span class="token operator">&gt;</span></span>
<span class="code-line"><span class="token operator">&lt;</span><span class="token operator">/</span>xml<span class="token operator">&gt;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="0add71640d538cba3fe565e0d7978a17" data-lines="8">
        <table class="cherry-table"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>msg_signature</td><td>String</td><td>企业微信加密签名，msg_signature结合了企业填写的token、请求中的timestamp、nonce参数、加密的消息体</td></tr><tr><td>timestamp</td><td>Integer</td><td>时间戳。与nonce结合使用，用于防止请求重放攻击。</td></tr><tr><td>nonce</td><td>String</td><td>随机数。与timestamp结合使用，用于防止请求重放攻击。</td></tr><tr><td>ToUserName</td><td>String</td><td>企业微信的CorpID，当为第三方应用回调事件时，CorpID的内容为suiteid</td></tr><tr><td>AgentID</td><td>String</td><td>接收的应用id，可在应用的设置页面获取。仅应用相关的回调会带该字段。</td></tr><tr><td>Encrypt</td><td>String</td><td>消息结构体加密后的字符串</td></tr></tbody></table></div><p data-sign="ff5f85ea2644ded6daf045efe67e11ac" data-type="p" data-lines="1">企业收到消息后，需要作如下处理：</p><ol data-sign="6ea4be0de54976ac9944e863839fd18clist5" data-lines="5" data-start="1" class="cherry-list__default" start="1"><li>对msg_signature进行<a href="#12976/%E6%B6%88%E6%81%AF%E4%BD%93%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C" rel="nofollow">校验</a></li><li><a href="#12976/%E5%AF%86%E6%96%87%E8%A7%A3%E5%AF%86%E5%BE%97%E5%88%B0msg%E7%9A%84%E8%BF%87%E7%A8%8B" rel="nofollow">解密</a>Encrypt，得到明文的消息结构体（消息结构体后面章节会详说）</li><li>如果需要被动回复消息，构造被动响应包</li><li>正确响应本次请求<br>· 企业微信服务器在五秒内收不到响应会断掉连接，并且重新发起请求，总共重试三次。（仅针对网络连接失败或者网络请求超时情况重试，建议开发者接受回调后立即应答，业务异步处理。目前无法保证100%回调成功，若开发者服务失败过多或者超时过多，企业微信可能会根据回调情况丢弃一些回调事件。建议开发者不要强依赖回调，需要额外机制对齐相关业务数据）</li></ol><p data-sign="br3" data-type="br" data-lines="3">&nbsp;</p><blockquote data-sign="0de059a69b373bae0490ad7ec2d297d6_2" data-lines="2">步骤1~2可以直接使用<a href="#12976/%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0" rel="nofollow">解密函数</a>一步到位。<br>步骤3其实包含加密被动回复消息、生成新签名、构造被动响应包三个步骤，可以直接使用<a href="#12976/%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0" rel="nofollow">加密函数</a>一步到位。<br>步骤4中，不同的业务回调要求返回不同内容。比如回复空串，或者特定字符串（如success），以及上一步构造的加密被动回复消息。具体要求在各个回调业务文档会有说明。</blockquote><p data-sign="828e936f70516303b9e80238b10ccde6" data-type="p" data-lines="1"><strong>被动响应包的数据格式：</strong></p><div data-sign="3ef06984095fc1b1a9c1f5c968c40065" data-type="codeBlock" data-lines="8">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token operator">&lt;</span>xml<span class="token operator">&gt;</span></span>
<span class="code-line">   <span class="token operator">&lt;</span>Encrypt<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>msg_encrypt<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Encrypt<span class="token operator">&gt;</span></span>
<span class="code-line">   <span class="token operator">&lt;</span>MsgSignature<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>msg_signature<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>MsgSignature<span class="token operator">&gt;</span></span>
<span class="code-line">   <span class="token operator">&lt;</span>TimeStamp<span class="token operator">&gt;</span>timestamp<span class="token operator">&lt;</span><span class="token operator">/</span>TimeStamp<span class="token operator">&gt;</span></span>
<span class="code-line">   <span class="token operator">&lt;</span>Nonce<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>nonce<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Nonce<span class="token operator">&gt;</span></span>
<span class="code-line"><span class="token operator">&lt;</span><span class="token operator">/</span>xml<span class="token operator">&gt;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="54d2f7abd4f226094d9bdd35b3129b56" data-type="p" data-lines="1"><strong>参数说明</strong></p><div class="cherry-table-container" data-sign="2441f64acc52eff17d3966583338972e" data-lines="6">
        <table class="cherry-table"><thead><tr><th>参数</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>Encrypt</td><td>是</td><td>经过加密的消息结构体</td></tr><tr><td>MsgSignature</td><td>是</td><td>消息签名</td></tr><tr><td>TimeStamp</td><td>是</td><td>时间戳</td></tr><tr><td>Nonce</td><td>是</td><td>随机数，由企业自行生成</td></tr></tbody></table></div><h3 id="33-%E8%8E%B7%E5%8F%96%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84ip%E6%AE%B5" data-sign="bcf139f391849a48f8f8ce046f6d36eb" data-lines="2"><a class="anchor" href="#33-%E8%8E%B7%E5%8F%96%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84ip%E6%AE%B5"></a>3.3 获取企业微信服务器的ip段</h3><p data-sign="186845089ab41c70efdbbf3078a8b5e6" data-type="p" data-lines="1">企业微信在回调企业指定的URL时，是通过特定的IP发送出去的。如果企业需要做防火墙配置，那么可以通过这个接口获取到所有相关的IP段。IP段有变更可能，当IP段变更时，新旧IP段会同时保留一段时间。建议企业每天定时拉取IP段，更新防火墙设置，避免因IP段变更导致网络不通。</p><p data-sign="27ae5f94edcd55a6c6d769bfa899ca58" data-type="p" data-lines="3"><strong>请求方式：</strong>GET（<strong>HTTPS</strong>）<br><strong>请求地址：</strong> https://qyapi.weixin.qq.com/cgi-bin/getcallbackip?access_token=ACCESS_TOKEN （<a href="#15074" rel="nofollow">获取ACCESS_TOKEN</a>）</p><p data-sign="58f6889c9f40a867c02e8c81a00f7063" data-type="p" data-lines="2"><strong>请求参数说明：</strong></p><div class="cherry-table-container" data-sign="da3120bdff83a859743e52d1af8dc997" data-lines="3">
        <table class="cherry-table"><thead><tr><th>参数</th><th>必须</th><th>说明</th></tr></thead><tbody><tr><td>access_token</td><td>是</td><td>调用接口凭证</td></tr></tbody></table></div><p data-sign="be69a8d80807fc12104a6f71258f88a9" data-type="p" data-lines="2"><strong>权限说明：</strong></p><p data-sign="14d04cc2024b12c7a41a4e64bd54ac66" data-type="p" data-lines="2">无限定。</p><p data-sign="0b2883c6647afc4d9ed15f6f0ef6fe94" data-type="p" data-lines="2"><strong>返回结果：</strong> </p><div data-sign="574c91f6aebb069fe68f05b8468f43f9" data-type="codeBlock" data-lines="11">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token string">"ip_list"</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="code-line">        <span class="token string">"1.2.3.4"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token string">"2.3.3.3"</span></span>
<span class="code-line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="e535c9d3e0e7b0f429c05a8e6015cb2c" data-type="p" data-lines="2"><strong>返回参数说明：</strong> </p><div class="cherry-table-container" data-sign="0f4fd1c6c7932cd62ef2d0e3aa3f59d0" data-lines="5">
        <table class="cherry-table"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>ip_list</td><td>StringArray</td><td>企业微信服务器IP段</td></tr><tr><td>errcode</td><td>int</td><td>错误码，0表示成功，非0表示调用失败</td></tr><tr><td>errmsg</td><td>string</td><td>错误信息，调用失败会有相关的错误信息返回</td></tr></tbody></table></div><p data-sign="3d1c30d82926ed136fcf392f3411a4d6" data-type="p" data-lines="1">根据errcode值非0，判断调用失败。以下是access_token过期的返回示例：</p><div data-sign="8f8311997b73cebc230914145c33045d" data-type="codeBlock" data-lines="7">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token string">"ip_list"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"errcode"</span><span class="token operator">:</span><span class="token number">42001</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"errmsg"</span><span class="token operator">:</span><span class="token string">"access_token expired, hint: [1576065934_28_e0fae07666aa64636023c1fa7e8f49a4], from ip: 9.30.0.138, more info at https://open.work.weixin.qq.com/devtool/query?e=42001"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h2 id="4-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1demo" data-sign="8e72d9d7b3c660b5e8612bed8d28fe18" data-lines="2"><a class="anchor" href="#4-%E5%9B%9E%E8%B0%83%E6%9C%8D%E5%8A%A1demo"></a>4. 回调服务demo</h2><p data-sign="ad4938a47da9f7654b6502c03103da67" data-type="p" data-lines="1">开发者可参考 <a href="https://developer.work.weixin.qq.com/devtool/introduce?id=36388" rel="nofollow">加解密库下载与返回码</a> 实现</p></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>