<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>上下游关联客户信息-未添加客户 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        上下游关联客户信息-未添加客户
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2023/03/30</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="d4971be24cb0dacf3f484425a850b4f5-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#%E5%9C%BA%E6%99%AF" class="level-2">场景</a></li><li class="toc-li"><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" class="level-2">准备工作</a></li><li class="toc-li"><a href="#%E6%80%9D%E8%B7%AF" class="level-2">思路</a></li><li class="toc-li"><a href="#unionid%E6%9F%A5%E8%AF%A2pending-id" class="level-2">unionid查询pending_id</a></li><li class="toc-li"><a href="#external-userid%E6%9F%A5%E8%AF%A2pending-id" class="level-2">external_userid查询pending_id</a></li></dir><h2 id="%E5%9C%BA%E6%99%AF" data-sign="89808841ca0abc798453f4cd7dfe33fb" data-lines="1"><a class="anchor" href="#%E5%9C%BA%E6%99%AF"></a>场景</h2><p data-sign="c77c0913b47dc9c3ff04d7ef8b409933" data-type="p" data-lines="2">品牌在公众号、小程序上的微信粉丝，可以跟经销商用企微添加的微信客户打通数据<br>实现效果：共享客户信息，完善客户画像，促进成交</p><h2 id="%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" data-sign="793d867f44ad3ad84e020096c2d08d1d" data-lines="2"><a class="anchor" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"></a>准备工作</h2><ol data-sign="896ea9e601124a386a983a95a508148blist4" data-lines="4" class="cherry-list__default" start="1"><li>品牌有自己主体（或isv主体）的公众号、小程序</li><li>品牌创建上下游，经销商新建企业并加入上下游</li><li>品牌共享应用给经销商</li><li>经销商管理员授权应用获取「企业客户」权限</li></ol><h2 id="%E6%80%9D%E8%B7%AF" data-sign="a6d452421892aa068ba6063fb92ae0e6" data-lines="2"><a class="anchor" href="#%E6%80%9D%E8%B7%AF"></a>思路</h2><p data-sign="21c103902b901d7474ddd3af3fb73947" data-type="p" data-lines="2"><strong>针对经销商已用企微添加的微信客户（<a href="https://developer.work.weixin.qq.com/document/path/95818" rel="nofollow">接口链接</a>）</strong><br>品牌通过以下接口把公众号、小程序粉丝的 unionid （从微信开放平台获取）转换成 external_userid</p><p data-sign="9869a1b66032ae004d5da39ca71eed30" data-type="p" data-lines="1"><strong>针对经销商还未用企微添加的微信客户（当前接口）</strong></p><ol data-sign="c0a8e452463e9864b08bedb536e32df9list3" data-lines="3" class="cherry-list__default" start="1"><li>品牌提前把公众号、小程序粉丝的 unionid （从微信开放平台获取）转换成 pending_id</li><li>经销商用企微添加微信客户时，用 external_userid 查询 pending_id</li><li>unionid 和 external_userid 数据打通</li></ol><hr data-sign="hr2" data-lines="2"><p data-sign="bef5eaee6718db316911c4e68022301f" data-type="p" data-lines="1"><strong>pending_id的说明</strong></p><ul data-sign="6a92523c6cd5ff5e0185b9c89b950fa3list3" data-lines="3" class="cherry-list__default"><li>pending_id主要用于关联微信unionid与外部联系人external_userid，可理解为临时外部联系人ID；</li><li>上游企业可通过此接口将微信unionid转为pending_id，当微信用户成为下游企业客户后，可使用上下游external_userid转pending_id接口将下游external_userid转换为pending_id，建立unionid =&gt; pending_id =&gt; external_userid的映射关系；</li><li>pending_id有效期90天，共享应用内唯一。</li></ul><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h2 id="unionid%E6%9F%A5%E8%AF%A2pending-id" data-sign="5af36f1d8679870904ed3bef664a2387" data-lines="1"><a class="anchor" href="#unionid%E6%9F%A5%E8%AF%A2pending-id"></a>unionid查询pending_id</h2><p data-sign="4b902962db5329983385fff0f818a5a4" data-type="p" data-lines="2">该接口有调用频率限制，按上游企业维度，限制为：10万次/小时、48万次/天、750万次/月。</p><p data-sign="474d72d0c3a66d07ce895d4d7efb73b1" data-type="p" data-lines="3"><strong>请求方式：</strong>POST（<strong>HTTPS</strong>）<br><strong>请求地址</strong>：https://qyapi.weixin.qq.com/cgi-bin/corpgroup/unionid_to_pending_id?access_token=ACCESS_TOKEN</p><p data-sign="25dc236983d258c66e39f907f7c7cc33" data-type="p" data-lines="1"><strong>请求参数：</strong></p><div data-sign="0fe57fd42055346f05d113b5f0787b68" data-type="codeBlock" data-lines="6">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token string">"unionid"</span><span class="token operator">:</span><span class="token string">"UNIONID"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"openid"</span><span class="token operator">:</span><span class="token string">"OPENID"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="745427bc0e240ea957b3b26eac579397" data-lines="5">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">必须</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">access_token</td><td align="left">是</td><td align="left">上游企业自建应用或代开发应用的access_token</td></tr><tr><td align="left">unionid</td><td align="left">是</td><td align="left">微信客户的unionid</td></tr><tr><td align="left">openid</td><td align="left">是</td><td align="left">微信客户的openid</td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="be69a8d80807fc12104a6f71258f88a9" data-type="p" data-lines="1"><strong>权限说明：</strong></p><blockquote data-sign="6249bf9bfdb6edf1f67a97831c082712_5" data-lines="5">1. 调用该接口的应用必须是上下游共享的自建应用或代开发应用<br>2. 应用需要具有客户联系权限<br>3. 当前授权企业必须已认证或已验证；若为代开发应用，服务商必须已认证<br>4. unionid（即微信开放平台账号主体）与openid（即小程序或服务号账号主体）需要认证，且主体名称需与上游企业的主体名称一致（<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/product/Open_Platform_Account_Management.html#%E5%9B%9B%E3%80%81%E8%AE%A4%E8%AF%81%E4%BB%A3%E6%B3%A8%E5%86%8C%E7%9A%84%E5%B8%90%E5%8F%B7" rel="nofollow">查看由服务商代注册的开放平台账号认证流程</a>）<br>5. openid与unionid必须是在同一个小程序获取到的<br>6. pending_id有效期90天</blockquote><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="8c8bd07f58486862a201112e85376126" data-type="p" data-lines="1"><strong>返回结果：</strong></p><div data-sign="19fe502a158dae17a110fe9c86a2d723" data-type="codeBlock" data-lines="8">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token string">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"pending_id"</span><span class="token operator">:</span><span class="token string">"PENDINGID"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="1"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="40b54b845e1dc4a9d98e8cd17c80b107" data-lines="5">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">errcode</td><td align="left">返回码</td></tr><tr><td align="left">errmsg</td><td align="left">对返回码的文本描述内容</td></tr><tr><td align="left">pending_id</td><td align="left">unionid和openid对应的pending_id</td></tr></tbody></table></div><h2 id="external-userid%E6%9F%A5%E8%AF%A2pending-id" data-sign="c133b47e6b3ca040b5c74dbd5f04a47b" data-lines="2"><a class="anchor" href="#external-userid%E6%9F%A5%E8%AF%A2pending-id"></a>external_userid查询pending_id</h2><p data-sign="8fb6c0af75ad82cd2ca5b1741df3129a" data-type="p" data-lines="3"><strong>请求方式：</strong>POST（<strong>HTTPS</strong>）<br><strong>请求地址</strong>：https://qyapi.weixin.qq.com/cgi-bin/corpgroup/batch/external_userid_to_pending_id?access_token=ACCESS_TOKEN</p><p data-sign="25dc236983d258c66e39f907f7c7cc33" data-type="p" data-lines="1"><strong>请求参数：</strong></p><div data-sign="f7ce8e21d51c6a65c80b60856de01119" data-type="codeBlock" data-lines="6">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">  <span class="token string">"chat_id"</span><span class="token operator">:</span><span class="token string">"xxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">  <span class="token string">"external_userid"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"oAAAAAAA"</span><span class="token punctuation">,</span> <span class="token string">"oBBBBB"</span><span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="71cc7ef469e1a22b0e809c91967aaeff" data-lines="5">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">必须</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">access_token</td><td align="left">是</td><td align="left">上下游企业共享的自建应用或代开发应用的access_token</td></tr><tr><td align="left">external_userid</td><td align="left">是</td><td align="left">上游或下游企业外部联系人id，最多同时查询100个</td></tr><tr><td align="left">chat_id</td><td align="left">否</td><td align="left">群id，如果有传入该参数，则只检查群主是否在可见范围，同时会忽略在该群以外的external_userid。如果不传入该参数，则只检查客户跟进人是否在可见范围内。</td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="be69a8d80807fc12104a6f71258f88a9" data-type="p" data-lines="1"><strong>权限说明：</strong></p><blockquote data-sign="4bacae85b468381f813ae1940f578bd9_4" data-lines="4">调用该接口的应用必须是上下游共享的自建应用或代开发应用<br>应用需要具有客户联系权限<br>该客户的跟进人或其所在客户群群主必须在应用的可见范围之内<br>上游应用须调用过<a href="#unionid%E8%BD%AC%E6%8D%A2pending_id" rel="nofollow">unionid转pending_id接口</a><br>上游和下游企业须认证或验证；若为代开发应用，服务商必须已认证</blockquote><p data-sign="8c8bd07f58486862a201112e85376126" data-type="p" data-lines="2"><strong>返回结果：</strong></p><div data-sign="213ddc04d89fd2b4d0c570bb338d8308" data-type="codeBlock" data-lines="17">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token string">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"result"</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="code-line">		 <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"external_userid"</span><span class="token operator">:</span><span class="token string">"oAAAAAAA"</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"pending_id"</span><span class="token operator">:</span><span class="token string">"pAAAAA"</span></span>
<span class="code-line">		 <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		 <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"external_userid"</span><span class="token operator">:</span><span class="token string">"oBBBBB"</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token string">"pending_id"</span><span class="token operator">:</span><span class="token string">"pBBBBB"</span></span>
<span class="code-line">		 <span class="token punctuation">}</span></span>
<span class="code-line">	 <span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="1"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="0d6c74d17c9c58bd678f6c01793ed5fc" data-lines="7">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">errcode</td><td align="left">返回码</td></tr><tr><td align="left">errmsg</td><td align="left">对返回码的文本描述内容</td></tr><tr><td align="left">result</td><td align="left">转换结果</td></tr><tr><td align="left">result.external_userid</td><td align="left">转换的external_userid</td></tr><tr><td align="left">result.pending_id</td><td align="left">该微信账号还未成为企业客户时，返回的临时外部联系人ID</td></tr></tbody></table></div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>