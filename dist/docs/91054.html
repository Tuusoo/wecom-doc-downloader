<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>概述 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        概述
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2022/09/13</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="a719d576763f2f8a3c465aba2c667fc5-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" class="level-2">使用场景</a></li><li class="toc-li"><a href="#%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6%E9%99%90%E5%88%B6" class="level-2">上传的媒体文件限制</a></li><li class="toc-li"><a href="#http%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%96%B9%E6%B3%95%E7%AE%80%E6%9E%90" class="level-2">HTTP上传文件方法简析</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#1-%E6%9E%84%E9%80%A0http%E8%AF%B7%E6%B1%82%E5%8C%85" class="level-3">1. 构造HTTP请求包</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#2-%E8%AE%BE%E7%BD%AEhttp%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF" class="level-3">2. 设置HTTP头部信息</a></li></dir><h2 id="%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" data-sign="e0bed5d8d91fe9d439e74e2492411546" data-lines="2"><a class="anchor" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"></a>使用场景</h2><p data-sign="e418c7ada6e93b3ed0c81af3f1557b58" data-type="p" data-lines="2">在使用企业微信API接口中，往往开发者需要使用自定义的资源，比如发送本地图片消息，设置通讯录自定义头像等。<br>为了实现同一资源文件，一次上传可以多次使用，这里提供了素材管理接口：以media_id来标识资源文件，实现文件的上传与下载。</p><div data-sign="b9864971a9f8535f7e41fdf0c3b2bc43" data-type="div" data-lines="5">以发送消息为示例：<br><center><img src="images/91054/d1387f52.png" alt=""></center><br>以JSSDK选图片上传为示例：<br><center><img src="images/91054/fed06630.png" alt=""></center></div><h2 id="%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6%E9%99%90%E5%88%B6" data-sign="f368e63393a44015aca2975034910b3a" data-lines="2"><a class="anchor" href="#%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6%E9%99%90%E5%88%B6"></a>上传的媒体文件限制</h2><p data-sign="64d9f9581485f14123f9aa7ec7434aac" data-type="p" data-lines="1">所有文件size必须大于5个字节</p><ul data-sign="a127092a9c760d84e827dd571d75baf0list4" data-lines="4" class="cherry-list__square"><li>图片（image）：10MB，支持JPG,PNG格式</li><li>语音（voice） ：2MB，播放长度不超过60s，<strong>仅支持</strong>AMR格式</li><li>视频（video） ：10MB，支持MP4格式</li><li>普通文件（file）：20MB</li></ul><h2 id="http%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%96%B9%E6%B3%95%E7%AE%80%E6%9E%90" data-sign="d7bb998b5bc6f5b7e302d244d17eaf67" data-lines="2"><a class="anchor" href="#http%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%96%B9%E6%B3%95%E7%AE%80%E6%9E%90"></a>HTTP上传文件方法简析</h2><p data-sign="7d7ed7fa8b3d384ea24abc2da1c2c731" data-type="p" data-lines="1">HTTP是文本协议，若需要传递二进制文件需要依赖于multipart/form-data格式</p><h3 id="1-%E6%9E%84%E9%80%A0http%E8%AF%B7%E6%B1%82%E5%8C%85" data-sign="bc6837a7d9186279e8c762a056e39b38" data-lines="2"><a class="anchor" href="#1-%E6%9E%84%E9%80%A0http%E8%AF%B7%E6%B1%82%E5%8C%85"></a>1. 构造HTTP请求包</h3><p data-sign="b74de53065d2fe503a64af57ff5cc55f" data-type="p" data-lines="1">单个文件的multipart/form-data格式，如下：</p><div data-sign="e8951104a6eaa8954be1457dbcb6c299" data-type="codeBlock" data-lines="8">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token operator">--</span>分隔符<span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line">Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">"表单名"</span><span class="token punctuation">;</span> filename<span class="token operator">=</span><span class="token string">"文件名"</span><span class="token punctuation">;</span> filelength<span class="token operator">=</span>文件内容大小<span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line">Content<span class="token operator">-</span>Type<span class="token operator">:</span> 类型<span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line">文件的二进制内容<span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line"><span class="token operator">--</span>分隔符<span class="token operator">--</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="05ce0d4be34cb5a0d200da2ba6062445" data-type="p" data-lines="2">Content-Type根据不同文件类型可以设置对应不同的值，如下表格：</p><div class="cherry-table-container" data-sign="895c010c34e2971a189a950429527733" data-lines="8">
        <table class="cherry-table"><thead><tr><th>文件类型</th><th>Content-Type</th></tr></thead><tbody><tr><td>普通文件</td><td>application/octet-stream</td></tr><tr><td>jpg图片</td><td>image/jpg</td></tr><tr><td>png图片</td><td>image/png</td></tr><tr><td>bmp图片</td><td>image/bmp</td></tr><tr><td>amr音频</td><td>voice/amr</td></tr><tr><td>mp4视频</td><td>video/mp4</td></tr></tbody></table></div><p data-sign="e30b4b078a72fda3a4b8f1ab37913be7" data-type="p" data-lines="2">若我们设置：分隔符为acebdf13572468，文件名为wework.txt，文件内容为mytext，由于上传临时素材要求name固定为media，那么构造的请求内容为：</p><div data-sign="e7533c19c329c0142871121df1e76c16" data-type="codeBlock" data-lines="9">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token operator">--</span>acebdf13572468</span>
<span class="code-line">Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">"media"</span><span class="token punctuation">;</span>filename<span class="token operator">=</span><span class="token string">"wework.txt"</span><span class="token punctuation">;</span> filelength<span class="token operator">=</span><span class="token number">6</span></span>
<span class="code-line">Content<span class="token operator">-</span>Type<span class="token operator">:</span> application<span class="token operator">/</span>octet<span class="token operator">-</span>stream</span>
<span class="code-line"></span>
<span class="code-line">mytext</span>
<span class="code-line"><span class="token operator">--</span>acebdf13572468<span class="token operator">--</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h3 id="2-%E8%AE%BE%E7%BD%AEhttp%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF" data-sign="024ead40c6a3fddd353249c176353a97" data-lines="2"><a class="anchor" href="#2-%E8%AE%BE%E7%BD%AEhttp%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF"></a>2. 设置HTTP头部信息</h3><div data-sign="b0e82519d39aac3e9249867a74602834" data-type="codeBlock" data-lines="7">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token constant">POST</span> <span class="token constant">URL</span> <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span><span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line">Content<span class="token operator">-</span>Type<span class="token operator">:</span> multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">;</span> boundary<span class="token operator">=</span>分隔符<span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line">Content<span class="token operator">-</span>Length<span class="token operator">:</span> 请求体内容大小<span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">[</span>换行<span class="token punctuation">]</span></span>
<span class="code-line">第<span class="token number">1</span>步构造的请求体内容</span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="91cfe6d8a37b422f94e9643371e2ae0e" data-type="p" data-lines="1">假定我们将第1步组装的文件内容上传到企业微信临时素材，分隔符取第1步设定值acebdf13572468，那么就得到如下：</p><div data-sign="d20ba81a0152f03aec16c09c92ea9ca0" data-type="codeBlock" data-lines="12">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token constant">POST</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>qyapi<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>qq<span class="token punctuation">.</span>com<span class="token operator">/</span>cgi<span class="token operator">-</span>bin<span class="token operator">/</span>media<span class="token operator">/</span>upload<span class="token operator">?</span>access_token<span class="token operator">=</span>accesstoken001<span class="token operator">&amp;</span>type<span class="token operator">=</span>file <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span></span>
<span class="code-line">Content<span class="token operator">-</span>Type<span class="token operator">:</span> multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">;</span> boundary<span class="token operator">=</span>acebdf13572468</span>
<span class="code-line">Content<span class="token operator">-</span>Length<span class="token operator">:</span> <span class="token number">168</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="token operator">--</span>acebdf13572468</span>
<span class="code-line">Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">"media"</span><span class="token punctuation">;</span>filename<span class="token operator">=</span><span class="token string">"wework.txt"</span><span class="token punctuation">;</span> filelength<span class="token operator">=</span><span class="token number">6</span></span>
<span class="code-line">Content<span class="token operator">-</span>Type<span class="token operator">:</span> application<span class="token operator">/</span>octet<span class="token operator">-</span>stream</span>
<span class="code-line"></span>
<span class="code-line">mytext</span>
<span class="code-line"><span class="token operator">--</span>acebdf13572468<span class="token operator">--</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>