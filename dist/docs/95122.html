<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>发送欢迎语等事件响应消息 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        发送欢迎语等事件响应消息
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2023/11/30</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="0d686a4cf1bb4583b26075eca479c846-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#%E6%A6%82%E8%BF%B0" class="level-2">概述</a></li><li class="toc-li"><a href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89" class="level-2">接口定义</a></li><li class="toc-li"><a href="#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B" class="level-2">消息类型</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E6%96%87%E6%9C%AC%E6%B6%88%E6%81%AF" class="level-3">文本消息</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E8%8F%9C%E5%8D%95%E6%B6%88%E6%81%AF" class="level-3">菜单消息</a></li></dir><h2 id="%E6%A6%82%E8%BF%B0" data-sign="9a8437ccee43ad66c084b8dfd3d259d3" data-lines="2"><a class="anchor" href="#%E6%A6%82%E8%BF%B0"></a>概述</h2><p data-sign="33716c6d2205dede7854718aa4be3cd3" data-type="p" data-lines="3">当特定的<a href="#31078/%E4%BA%8B%E4%BB%B6%E6%B6%88%E6%81%AF" rel="nofollow">事件回调消息</a>包含code字段，或通过接口变更到特定的<a href="#31080/%E5%88%86%E9%85%8D%E5%AE%A2%E6%9C%8D%E4%BC%9A%E8%AF%9D" rel="nofollow">会话状态</a>，会返回code字段。<br>开发者可以此code为凭证，<strong>调用该接口给用户发送相应事件场景下的消息</strong>，<strong>如客服欢迎语、客服提示语和会话结束语等。</strong><br>除"用户进入会话事件"以外，<strong>响应消息仅支持会话处于获取该code的会话状态时发送</strong>，如将会话转入待接入池时获得的code仅能在会话状态为”待接入池排队中“时发送。</p><p data-sign="79c2dafde37d08d49da76b3dab8beb8a" data-type="p" data-lines="2">目前支持的事件场景和相关约束如下：</p><div class="cherry-table-container" data-sign="192a4172831752c5d500e8e0ad1eaab4" data-lines="6">
        <table class="cherry-table"><thead><tr><th>事件场景</th><th>允许下发条数</th><th>code有效期</th><th>支持的消息类型</th><th>获取code途径</th></tr></thead><tbody><tr><td>用户进入会话，用于发送客服欢迎语</td><td>1条</td><td>20秒</td><td>文本、菜单</td><td>事件回调</td></tr><tr><td>进入接待池，用于发送排队提示语等</td><td>1条</td><td>48小时</td><td>文本</td><td>转接会话接口</td></tr><tr><td>从接待池接入会话，用于发送非工作时间的提示语或超时未回复的提示语等</td><td>1条</td><td>48小时</td><td>文本</td><td>事件回调、转接会话接口</td></tr><tr><td>结束会话，用于发送结束会话提示语或满意度评价等</td><td>1条</td><td>20秒</td><td>文本、菜单</td><td>事件回调、转接会话接口</td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h2 id="%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89" data-sign="b0c4fa5af57e92d8d68dedac05f1ccfe" data-lines="1"><a class="anchor" href="#%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"></a>接口定义</h2><p data-sign="666181b85b5e14756feb823959dc31cd" data-type="p" data-lines="1"><strong>请求方式</strong>: <strong>POST(HTTPS)</strong></p><p data-sign="a08a145285d201a9ce3b6de134de453e" data-type="p" data-lines="2"><strong>请求地址</strong>:  https://qyapi.weixin.qq.com/cgi-bin/kf/send_msg_on_event?access_token=ACCESS_TOKEN</p><p data-sign="8b8b131af4d7916d08149d0729990346" data-type="p" data-lines="2"><strong>请求示例</strong></p><div data-sign="d05961229292ad655439055d6faa5d57" data-type="codeBlock" data-lines="8">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"CODE"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"msgid"</span><span class="token operator">:</span> <span class="token string">"MSG_ID"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"msgtype"</span><span class="token operator">:</span> <span class="token string">"MSG_TYPE"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="6d49ec72703bfaf86dc88cd60e743e6d" data-lines="6">
        <table class="cherry-table"><thead><tr><th>参数</th><th>是否必须</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>access_token</td><td>是</td><td>string</td><td>调用接口凭证</td></tr><tr><td>code</td><td>是</td><td>string</td><td>事件响应消息对应的code。<strong>通过事件回调下发，仅可使用一次。</strong></td></tr><tr><td>msgid</td><td>否</td><td>string</td><td>消息ID。如果请求参数指定了msgid，则原样返回，否则系统自动生成并返回。<br>不多于32字节<br>字符串取值范围(正则表达式)：[0-9a-zA-Z_-]*</td></tr><tr><td>msgtype</td><td>是</td><td>string</td><td>消息类型。对不同的msgtype，有相应的结构描述，详见<a href="#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B" rel="nofollow">消息类型</a></td></tr></tbody></table></div><blockquote data-sign="6e42707bfd52a12898df8f8bc3a7aa7c_2" data-lines="2">「进入会话事件」响应消息：<br>如果满足通过API下发欢迎语条件（条件为：<strong>用户在过去48小时里未收过欢迎语，且未向客服发过消息</strong>），则<a href="#31078/%E7%94%A8%E6%88%B7%E8%BF%9B%E5%85%A5%E4%BC%9A%E8%AF%9D%E4%BA%8B%E4%BB%B6" rel="nofollow">用户进入会话事件</a>会额外返回一个<code>welcome_code</code>，开发者以此为凭据调用接口（填到该接口<code>code</code>参数），即可向客户发送客服欢迎语。</blockquote><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="3e8ede653238c7aeddbd80981443beee" data-type="p" data-lines="2"><strong>权限说明</strong>:<br>调用的应用需要满足如下的权限</p><div class="cherry-table-container" data-sign="7f1822643198bbe857a7299fe633f89c" data-lines="5">
        <table class="cherry-table"><thead><tr><th>应用类型</th><th>权限要求</th></tr></thead><tbody><tr><td>自建应用</td><td>配置到「 <a href="#31106/%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFAPI" rel="nofollow">微信客服- 可调用接口的应用</a>」中</td></tr><tr><td>第三方应用</td><td>具有<span style="color: rgb(255, 0, 0); --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">“微信客服-&gt;管理账号、分配会话和收发消息”</span>权限</td></tr><tr><td>代开发自建应用</td><td>具有<span style="color: rgb(255, 0, 0); --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">“微信客服-&gt;管理账号、分配会话和收发消息”</span>权限</td></tr></tbody></table></div><p data-sign="4500ae644890b2a3e6568b5481167358" data-type="p" data-lines="1"><em>注：</em> 从2023年12月1日0点起，不再支持通过系统应用secret调用接口，存量企业暂不受影响 <a href="https://developer.work.weixin.qq.com/document/51165" rel="nofollow">查看详情</a></p><ul data-sign="ddb7fd3e78a3fe37494333df84c8913clist2" data-lines="2" class="cherry-list__default"><li><span style="color: rgb(255, 0, 0); --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">只能通过API管理企业指定的客服账号。</span>企业可在管理后台“微信客服-通过API管理微信客服账号”处设置对应的客服账号通过API来管理。</li><li><span style="color: rgb(255, 0, 0); --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">操作的客服账号对应的接待人员应在应用的可见范围内</span></li></ul><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="25ff3159d1dae3e8ef08523b3dd72cc2" data-type="p" data-lines="1"><strong>返回结果</strong>:</p><div data-sign="1d938888db74f4b5b264ae90dc7d66d0" data-type="codeBlock" data-lines="8">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"errcode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"errmsg"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"msgid"</span><span class="token operator">:</span> <span class="token string">"MSG_ID"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="aa23204fbe4fd4230ddbc285930d9e58" data-type="p" data-lines="2"><strong>参数说明</strong>:</p><div class="cherry-table-container" data-sign="d0f2fc6a3cef5847ad18910285619ed7" data-lines="5">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">类型</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">errcode</td><td align="left">int32</td><td align="left">返回码</td></tr><tr><td align="left">errmsg</td><td align="left">string</td><td align="left">错误码描述</td></tr><tr><td align="left">msgid</td><td align="left">string</td><td align="left">消息ID</td></tr></tbody></table></div><h2 id="%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B" data-sign="770eda0a918142e2f2cb206a05d6743a" data-lines="2"><a class="anchor" href="#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B"></a>消息类型</h2><h3 id="%E6%96%87%E6%9C%AC%E6%B6%88%E6%81%AF" data-sign="00bd5ad70e6a422c73658a35dc95c3a7" data-lines="2"><a class="anchor" href="#%E6%96%87%E6%9C%AC%E6%B6%88%E6%81%AF"></a>文本消息</h3><p data-sign="fa377d970a64d86d33472be9b167002f" data-type="p" data-lines="1"> <strong>请求示例：</strong></p><div data-sign="f2d360d89603cb082e50370689050872" data-type="codeBlock" data-lines="11">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">   <span class="token string">"code"</span><span class="token operator">:</span> <span class="token string">"CODE"</span><span class="token punctuation">,</span></span>
<span class="code-line">   <span class="token string">"msgid"</span><span class="token operator">:</span> <span class="token string">"MSG_ID"</span><span class="token punctuation">,</span></span>
<span class="code-line">   <span class="token string">"msgtype"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="code-line">   <span class="token string">"text"</span> <span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">       <span class="token string">"content"</span> <span class="token operator">:</span> <span class="token string">"欢迎咨询"</span></span>
<span class="code-line">   <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="b1534950fd3f9ddcfbc4f9f732fe11e1" data-lines="5">
        <table class="cherry-table"><thead><tr><th>参数</th><th>是否必须</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>msgtype</td><td>是</td><td>string</td><td>消息类型，此时固定为：text</td></tr><tr><td>text</td><td>是</td><td>obj</td><td>文本消息</td></tr><tr><td>text.content</td><td>是</td><td>string</td><td>消息内容，最长不超过2048个字节</td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h3 id="%E8%8F%9C%E5%8D%95%E6%B6%88%E6%81%AF" data-sign="ad37a88ccbf5f339afee0ec818cb49bc" data-lines="1"><a class="anchor" href="#%E8%8F%9C%E5%8D%95%E6%B6%88%E6%81%AF"></a>菜单消息</h3><p data-sign="0eaf88df03cd3784619d00af1ca68a35" data-type="p" data-lines="1"><strong>请求示例：</strong></p><div data-sign="baeb7ab3681fe7f88e5df30010156418" data-type="codeBlock" data-lines="49">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"CODE"</span></span>
<span class="code-line">    <span class="token property">"msgid"</span><span class="token operator">:</span> <span class="token string">"MSGID"</span><span class="token punctuation">,</span> </span>
<span class="code-line">    <span class="token property">"msgtype"</span><span class="token operator">:</span> <span class="token string">"msgmenu"</span><span class="token punctuation">,</span> </span>
<span class="code-line">    <span class="token property">"msgmenu"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"head_content"</span><span class="token operator">:</span> <span class="token string">"您对本次服务是否满意呢? "</span><span class="token punctuation">,</span> </span>
<span class="code-line">        <span class="token property">"list"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="code-line">            <span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"click"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                <span class="token property">"click"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"101"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"满意"</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span> </span>
<span class="code-line">            <span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"click"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                <span class="token property">"click"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"102"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"不满意"</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span> </span>
<span class="code-line">            <span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"view"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                <span class="token property">"view"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://work.weixin.qq.com"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"点击跳转到自助查询页面"</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span> </span>
<span class="code-line">            <span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"miniprogram"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                <span class="token property">"miniprogram"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"appid"</span><span class="token operator">:</span> <span class="token string">"wx123123123123123"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                    <span class="token property">"pagepath"</span><span class="token operator">:</span> <span class="token string">"pages/index?userid=zhangsan&amp;amp;orderid=123123123"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"点击打开小程序查询更多"</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span> </span>
<span class="code-line">                <span class="token property">"text"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"纯文本，支持\n换行"</span><span class="token punctuation">,</span></span>
<span class="code-line">                    <span class="token property">"no_newline"</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">}</span></span>
<span class="code-line">        <span class="token punctuation">]</span><span class="token punctuation">,</span> </span>
<span class="code-line">        <span class="token property">"tail_content"</span><span class="token operator">:</span> <span class="token string">"欢迎再次光临"</span></span>
<span class="code-line">    <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="1"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="7a17d065ae75dbcac1caf525245a8a8f" data-lines="21">
        <table class="cherry-table"><thead><tr><th align="left">参数</th><th align="left">必须</th><th align="left">类型</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">msgtype</td><td align="left">是</td><td align="left">string</td><td align="left">消息类型，此时固定为：msgmenu</td></tr><tr><td align="left">msgmenu</td><td align="left">是</td><td align="left">obj</td><td align="left">菜单消息</td></tr><tr><td align="left">msgmenu.head_content</td><td align="left">否</td><td align="left">string</td><td align="left">起始文本<br>不多于1024字节</td></tr><tr><td align="left">msgmenu.list</td><td align="left">否</td><td align="left">obj[]</td><td align="left">菜单项配置，不超过10个</td></tr><tr><td align="left">msgmenu.list.type</td><td align="left">是</td><td align="left">string</td><td align="left">菜单类型。<br><code>click</code>-回复菜单 <code>view</code>-超链接菜单 <code>miniprogram</code>-小程序菜单 <code>text</code>-文本</td></tr><tr><td align="left">msgmenu.list.click</td><td align="left">否</td><td align="left">obj</td><td align="left">type为<code>click</code>的菜单项</td></tr><tr><td align="left">msgmenu.list.click.id</td><td align="left">否</td><td align="left">string</td><td align="left">菜单ID。<br>不少于1字节<br>不多于128字节</td></tr><tr><td align="left">msgmenu.list.click.content</td><td align="left">是</td><td align="left">string</td><td align="left">菜单显示内容<br>不少于1字节<br>不多于128字节</td></tr><tr><td align="left">msgmenu.list.view</td><td align="left">否</td><td align="left">obj</td><td align="left">type为<code>view</code>的菜单项</td></tr><tr><td align="left">msgmenu.list.view.url</td><td align="left">是</td><td align="left">string</td><td align="left">点击后跳转的链接。<br>不少于1字节<br>不多于2048字节</td></tr><tr><td align="left">msgmenu.list.view.content</td><td align="left">是</td><td align="left">string</td><td align="left">菜单显示内容。<br>不少于1字节<br>不多于1024字节</td></tr><tr><td align="left">msgmenu.list.miniprogram</td><td align="left">否</td><td align="left">obj</td><td align="left">type为<code>miniprogram</code>的菜单项</td></tr><tr><td align="left">msgmenu.list.miniprogram.appid</td><td align="left">是</td><td align="left">string</td><td align="left">小程序appid。<br>不少于1字节<br>不多于32字节</td></tr><tr><td align="left">msgmenu.list.miniprogram.pagepath</td><td align="left">是</td><td align="left">string</td><td align="left">点击后进入的小程序页面。<br>不少于1字节<br>不多于1024字节</td></tr><tr><td align="left">msgmenu.list.miniprogram.content</td><td align="left">是</td><td align="left">string</td><td align="left">菜单显示内容。<br>不多于1024字节</td></tr><tr><td align="left">msgmenu.list.text</td><td align="left">否</td><td align="left">obj</td><td align="left">type为<code>text</code>的菜单项</td></tr><tr><td align="left">msgmenu.list.text.content</td><td align="left">是</td><td align="left">string</td><td align="left">文本内容，支持<code>\n</code>（\和n两个字符）换行。<br>不少于1字节<br>不多于256字节</td></tr><tr><td align="left">msgmenu.list.text.no_newline</td><td align="left">否</td><td align="left">bool</td><td align="left">内容后面是否不换行，0-换行 1-不换行，默认为0</td></tr><tr><td align="left">msgmenu.tail_content</td><td align="left">否</td><td align="left">string</td><td align="left">结束文本<br>不多于1024字节</td></tr></tbody></table></div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>