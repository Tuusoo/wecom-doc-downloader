<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>会话消息搜索 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        会话消息搜索
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2025/02/10</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><p data-sign="ebd3d3633e341c55577fa0bc87baf87f" data-type="p" data-lines="2">可调用该接口对企业会话的内容进行搜索<br><strong>权限说明</strong></p><div class="cherry-table-container" data-sign="4b2d6996e6b5f373169096c48c582d02" data-lines="5">
        <table class="cherry-table"><thead><tr><th>应用类型</th><th>权限要求</th></tr></thead><tbody><tr><td>自建应用</td><td>需具备「<span style="color:#ff0000">数据与智能专区权限</span>」</td></tr><tr><td>代开发应用</td><td>需具备「<span style="color:#ff0000">数据与智能专区权限</span>」</td></tr><tr><td>第三方应用</td><td>需具备「<span style="color:#ff0000">数据与智能专区权限</span>」</td></tr></tbody></table></div><p data-sign="5cb121604f825eb5542f7b8a9b434599" data-type="p" data-lines="2"><strong>支持搜索的消息</strong><br>仅支持对部分消息内容进行搜索，包括：</p><div class="cherry-table-container" data-sign="cdd14bad9796dcaff40ca7b9e6966350" data-lines="9">
        <table class="cherry-table"><thead><tr><th>消息类型</th><th>可搜字段说明</th><th>msg_type</th></tr></thead><tbody><tr><td>文本消息</td><td>消息内容</td><td>1</td></tr><tr><td>链接消息</td><td>消息标题</td><td>4</td></tr><tr><td>小程序消息</td><td>消息标题</td><td>5</td></tr><tr><td>文件消息</td><td>文件名称</td><td>8</td></tr><tr><td>在线文档消息</td><td>文档名称</td><td>18</td></tr><tr><td>图文混合消息</td><td>文本内容</td><td>20</td></tr><tr><td>微盘文件消息</td><td>文件名称</td><td>23</td></tr></tbody></table></div><p data-sign="9b46db12cc8830161cccaa14f68299ed" data-type="p" data-lines="3"><strong>请求方法</strong><br>通过SDK调用，具体方式参考<a href="#54006" rel="nofollow">专区程序使用指引</a>。</p><p data-sign="84d8339904ed892c0a74e0bb0394cc84" data-type="p" data-lines="3"><strong>接口名：</strong><br>search_msg</p><p data-sign="382edfac6a8b56ec46332834f416136e" data-type="p" data-lines="2"><strong>请求包体：</strong></p><div data-sign="c97b4b45f0ecb84b8be5f1e301e948bb" data-type="codeBlock" data-lines="30">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token string">"query_word"</span><span class="token operator">:</span> <span class="token string">"欢迎"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"chat_info"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token string">"chat_type"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token string">"id_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span></span>
<span class="code-line">				<span class="token string">"open_userid"</span><span class="token operator">:</span> <span class="token string">"OPEN_USERID"</span></span>
<span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="code-line">				<span class="token string">"external_userid"</span><span class="token operator">:</span> <span class="token string">"EXTERNALID1"</span></span>
<span class="code-line">			<span class="token punctuation">}</span></span>
<span class="code-line">		<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token string">"chat_id"</span><span class="token operator">:</span> <span class="token string">"CHAT_ID"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token string">"msg_type_list"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token string">"sender"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"open_userid"</span><span class="token operator">:</span> <span class="token string">"OPEN_USERID"</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token string">"sender_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="code-line">			<span class="token punctuation">{</span></span>
<span class="code-line">				<span class="token string">"open_userid"</span><span class="token operator">:</span><span class="token string">"OPEN_USERID"</span></span>
<span class="code-line">			<span class="token punctuation">}</span></span>
<span class="code-line">		<span class="token punctuation">]</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"start_time"</span><span class="token operator">:</span> <span class="token number">1668355200</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"end_time"</span><span class="token operator">:</span> <span class="token number">1668528000</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"skip_stop_words"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"limit"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"cursor"</span><span class="token operator">:</span> <span class="token string">"CURSOR"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="a6f166751c48777a6cf993befb0a19f1" data-type="p" data-lines="2"><strong>参数说明：</strong> </p><div class="cherry-table-container" data-sign="9f7b7ed7702d21447848c5b474fabfa3" data-lines="15">
        <table class="cherry-table"><thead><tr><th>参数</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>query_word</td><td>是</td><td>搜索的关键词，要求大于等于2个UTF8字符。</td></tr><tr><td>chat_info</td><td>否</td><td>指定要搜索的客户会话范围</td></tr><tr><td>chat_info.chat_type</td><td>否</td><td>指定会话类型，若填写则从指定的会话类型中搜索。<br> 1：单聊；2：群聊</td></tr><tr><td>chat_info.id_list</td><td>否</td><td>chat_type为<strong>单聊</strong>时有效，会话双方的id，该列表长度必须为2，详见<strong>IdInfo</strong></td></tr><tr><td>chat_info.chat_id</td><td>否</td><td>chat_type为<strong>群聊</strong>时有效，若填写则从指定的群聊会话id中搜索</td></tr><tr><td>chat_info.msg_type_list</td><td>否</td><td>指定搜索的消息类型，仅支持可搜索的消息类型。如果不填则默认搜索所有可搜的消息类型</td></tr><tr><td>chat_info.sender</td><td>否</td><td>指定消息的发送者，详见<strong>IdInfo</strong> <br> 目前仅支持企业内员工</td></tr><tr><td>chat_info.sender_list</td><td>否</td><td>指定消息的发送者列表，会搜索发送者为其中之一的消息，详见<strong>IdInfo</strong> <br> 目前仅支持企业内员工<br>最多传入100个IdInfo<br><strong>指定了此字段时，sender字段的内容将被忽略</strong></td></tr><tr><td>start_time</td><td>否</td><td>指定搜索会话范围的起始时间，Unix时间戳</td></tr><tr><td>end_time</td><td>否</td><td>指定搜索会话范围的结束时间，Unix时间戳。若指定了end_time，也必须指定start_time，start_time必须小于end_time，且时间范围不超过31天整；若都不指定则默认时间范围为当前时刻往前31天内。</td></tr><tr><td>skip_stop_words</td><td>否</td><td>指定是否在搜索时从<strong>搜索关键词</strong>中去掉<strong>部分常见停用词</strong>，例如“的”、“了”等，以优化搜索结果。<br>默认为false。<br>当搜索关键词的分词结果均为停用词时此字段将失效，仍然按照常规逻辑搜索；<br>注意，指定这个字段为<code>true</code>有可能导致搜索出不完全符合关键词的结果。</td></tr><tr><td>limit</td><td>否</td><td>用于分页查询，每次请求返回的数据上限。最大为100，不填默认为50</td></tr><tr><td>cursor</td><td>否</td><td>用于分页查询的游标，字符串类型，由上一次调用返回，首次调用可不填</td></tr></tbody></table></div><p data-sign="f6a8297962e4c40229b927b84978b813" data-type="p" data-lines="1"><strong>IdInfo说明：</strong> </p><div class="cherry-table-container" data-sign="bb89313f524088f55f43903cc91be5fc" data-lines="4">
        <table class="cherry-table"><thead><tr><th>参数</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>open_userid</td><td>否</td><td>成员ID。会话者的身份类型为企业成员时填，优先识别该字段</td></tr><tr><td>external_userid</td><td>否</td><td>客户ID。会话者的身份类型为为客户时填</td></tr></tbody></table></div><p data-sign="8c8bd07f58486862a201112e85376126" data-type="p" data-lines="1"><strong>返回结果：</strong></p><div data-sign="01a1ee11060c907c9d1dcb54961b2fed" data-type="codeBlock" data-lines="16">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token string">"errcode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"errmsg"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"has_more"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"next_cursor"</span><span class="token operator">:</span> <span class="token string">"CURSOR"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token string">"msg_list"</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="code-line">		<span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"msgid"</span><span class="token operator">:</span> <span class="token string">"xxxmsgid"</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token string">"msgid"</span><span class="token operator">:</span> <span class="token string">"yyymsgid"</span></span>
<span class="code-line">		<span class="token punctuation">}</span></span>
<span class="code-line">	<span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="1"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="e7eae942cc315b67f4c3b2c644018cdd" data-lines="8">
        <table class="cherry-table"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>errcode</td><td>错误码</td></tr><tr><td>errmsg</td><td>错误码说明</td></tr><tr><td>has_more</td><td>是否还有更多数据未获取，不填默认为0<br>0: 否<br>1: 是</td></tr><tr><td>next_cursor</td><td>下一次请求的cursor值</td></tr><tr><td>msg_list</td><td>搜索结果的消息列表，按消息发送时间降序排序</td></tr><tr><td>msgid</td><td>每条消息对应的msgid</td></tr></tbody></table></div><blockquote data-sign="c9b3cf14aa70523b5b6ecc3e7e27e633_1" data-lines="1">注：需要根据has_more是否为1来判断是否拉取结束，不能依赖返回的记录数。返回的记录数可能小于limit</blockquote></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>