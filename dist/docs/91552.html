<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>常见问题解答 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        常见问题解答
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2022/11/09</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><h2 id="sdk%E9%94%99%E8%AF%AF%E7%A0%81%E8%AF%B4%E6%98%8E" data-sign="47e2a615c9e4eae9539b2d9fa020df13" data-lines="1"><a class="anchor" href="#sdk%E9%94%99%E8%AF%AF%E7%A0%81%E8%AF%B4%E6%98%8E"></a>SDK错误码说明</h2><p data-sign="61f9e4949e52c5c9ffdc54bfd3e0e6f9" data-type="p" data-lines="1"><strong>错误码：</strong></p><div class="cherry-table-container" data-sign="d6179b56b04abf2215b4f847cbb85ae7" data-lines="14">
        <table class="cherry-table"><thead><tr><th align="left">返回值</th><th align="left">说明</th><th align="left">建议</th></tr></thead><tbody><tr><td align="left">10000</td><td align="left">请求参数错误</td><td align="left">检查Init接口corpid、secret参数；检查GetChatData接口limit参数是否未填或大于1000；检查GetMediaData接口sdkfileid是否为空，indexbuf是否正常</td></tr><tr><td align="left">10001</td><td align="left">网络请求错误</td><td align="left">检查是否网络有异常、波动；检查使用代理的情况下代理参数是否设置正确的用户名与密码</td></tr><tr><td align="left">10002</td><td align="left">数据解析失败</td><td align="left">建议重试请求。若仍失败，可以反馈给企业微信进行查询，请提供sdk接口参数与调用时间点等信息</td></tr><tr><td align="left">10003</td><td align="left">系统调用失败</td><td align="left">GetMediaData调用失败，建议重试请求。若仍失败，可以反馈给企业微信进行查询，请提供sdk接口参数与调用时间点等信息</td></tr><tr><td align="left">10004</td><td align="left">已废弃</td><td align="left">目前不会返回此错误码</td></tr><tr><td align="left">10005</td><td align="left">fileid错误</td><td align="left">检查在GetMediaData接口传入的sdkfileid是否正确</td></tr><tr><td align="left">10006</td><td align="left">解密失败</td><td align="left">请检查是否先进行base64decode再进行rsa私钥解密，再进行DecryptMsg调用</td></tr><tr><td align="left">10007</td><td align="left">已废弃</td><td align="left">目前不会返回此错误码</td></tr><tr><td align="left">10008</td><td align="left">DecryptMsg错误</td><td align="left">建议重试请求。若仍失败，可以反馈给企业微信进行查询，请提供sdk接口参数与调用时间点等信息</td></tr><tr><td align="left">10009</td><td align="left">ip非法</td><td align="left">请检查sdk访问外网的ip是否与管理端设置的可信ip匹配，若不匹配会返回此错误码</td></tr><tr><td align="left">10010</td><td align="left">请求的数据过期</td><td align="left">用户欲拉取的数据已过期，仅支持近5天内的数据拉取</td></tr><tr><td align="left">10011</td><td align="left">ssl证书错误</td><td align="left">使用openssl版本sdk，校验ssl证书失败</td></tr></tbody></table></div><p data-sign="br3" data-type="br" data-lines="3">&nbsp;</p><h2 id="qampa" data-sign="94340b966ba29de895d24f7ba939814c" data-lines="1"><a class="anchor" href="#qampa"></a>Q&amp;A</h2><p data-sign="br3" data-type="br" data-lines="3">&nbsp;</p><p data-sign="0cf1fa703c35a4411b5e7e0a5bbbab29" data-type="p" data-lines="2"><strong>Q:是否每次调用都需要new sdk，init sdk?</strong><br>A:不需要，首次new sdk后，可以在多次的拉取会话记录/拉取媒体数据，使用同一个sdk进行处理.</p><p data-sign="0730733ff10942f15d3f9b6f85ab3dc8" data-type="p" data-lines="3"><strong>Q:corpid/secret 在哪里获取?</strong><br>A: corpid信息在企业微信管理端--我的企业--企业信息查看，secret在企业微信管理端--管理工具--会话内容存档查看</p><p data-sign="8c34f72f0f02350ab844a84aa5205069" data-type="p" data-lines="3"><strong>Q：如何拉取指定seq的消息？</strong><br>A：通过seq跟limit来确认拉取消息的范围，每次拉取的是seq+1开始的limit条消息</p><p data-sign="275ac94da5a4a8d2c07c7ddcb42ea1b5" data-type="p" data-lines="3"><strong>Q：拉取消息的时间范围与条数范围？</strong><br>A：企业微信只提供5天内的消息拉取，即：从发起拉取的时候往前推5天的消息。如果传入的seq不属于5天内，则从5天内的第一个消息的seq开始拉取。每次最多提供1000条消息的拉取</p><p data-sign="e79e5ed258fbc0aeba3176e4670ed9c1" data-type="p" data-lines="3"><strong>Q：服务部署在内网，如何拉取？</strong><br>A：通过参数来设置代理进行拉取。支持http代理与sock5代理</p><p data-sign="242e1c5db94b40242cfe4a2457092225" data-type="p" data-lines="3"><strong>Q：管理端填入的ip地址是否可以不填？</strong><br>A：必须填写，企业微信会对ip地址的访问进行限制。对于使用方而言，需要设置其公网ip，企业微信后台收到的请求，会校验调用方的ip与管理端填写的ip是否匹配。</p><p data-sign="4eb2b6add8343aa0b756be9e57d86a76" data-type="p" data-lines="3"><strong>Q：管理端填入的消息加密公钥格式？</strong><br>A：管理端填入RSA2048产生的公钥，后续使用pkcs1进行加密。每次上传公钥都会生成一个公钥版本号，在后续的拉取消息接口中，每条消息都会指明使用的加密公钥版本号。</p><p data-sign="b3825971b30f09b43c1631fd77013079" data-type="p" data-lines="3"><strong>Q：拉取的消息如何解密？</strong><br>A：企业微信对待存储的消息使用企业最新上传的公钥进行加密，企业自行使用对应版本的私钥进行解密。对json消息体内的encrypt_random_key，base64处理后首先使用对应版本的私钥进行解密得到字符串内容，将字符串内容与消息体内的encrypt_chat_msg，使用sdk的接口DecryptData，得到真正的明文消息。</p><p data-sign="ec22ba8c6cf9c8ed6bb851b59fbf77a2" data-type="p" data-lines="3"><strong>Q：如何生成秘钥对？</strong><br>A：建议使用openssl 来生成rsa pkcs1 2048格式的公私钥。例如可使用：openssl genrsa -out private.pem 2048 来生成私钥，并使用openssl rsa -in private.pem -pubout -out public.pem从私钥来产生公钥。</p><p data-sign="15580465fd7e7ef5ee09b965ccdc4a6d" data-type="p" data-lines="3"><strong>Q：so放置在什么地方？</strong><br>A：建议将so放置在系统路径：LD_LIBRARY_PATH指定的路径内，或者将so所在的目录加入到LD_LIBRARY_PATH的路径范围内。</p><p data-sign="301c0a2c648b6884d7228efc6d245c7b" data-type="p" data-lines="3"><strong>Q：消息体内的from tolist roomid是什么含义？</strong><br>A：如果是单聊：from表示消息发送方、tolist内只有一个消息接收方，roomid为空；如果是群聊：from表示消息发送方，tolist为群内其他成员id，roomid非空；无论消息的发送方还是接收方，如果是本企业成员，则为userid，否则为exteranalopenid</p><p data-sign="e009fda87089bafe8e535086d2315d86" data-type="p" data-lines="3"><strong>Q：消息何时进行存储？</strong><br>A：如果是金融版企业成员，则所有会话均会存储，包括发送给本企业或者外部企业/微信的会话消息；如果是非本企业的外部用户与本企业成员会话，则只有外部用户同意了当前会话的存储，才会进行存储(不同意存储也可以进行会话)。外部用户的同意，以会话为粒度(单聊或群聊)。</p><p data-sign="48616a99c53e1aa9161059571c7d3c0e" data-type="p" data-lines="3"><strong>Q：如果群聊内有多个金融版企业，消息如何存储？</strong><br>A：如果外部用户同时与多个金融版企业成员所在的群聊进行会话，那么外部用户会收到不同金融版企业的存储邀请，外部用户同意了哪个金融版企业，会话消息才存储到哪个金融版企业。</p><p data-sign="7408f59eca206dc60fc4b2939bf5805c" data-type="p" data-lines="3"><strong>Q：如何处理sdk接口调用失败？</strong><br>A：如果出现拉取会话记录、媒体数据失败的情况，建议进行相同参数下一定次数的请求重试。</p><p data-sign="f177183f2f06147f615dc940e3d7e404" data-type="p" data-lines="3"><strong>Q：媒体消息的格式分别是什么？</strong><br>A：图片是jpg格式、语音是amr格式、视频是mp4格式、文件格式类型包括在消息体内，表情分为动图与静态图，在消息体内定义。</p><p data-sign="e3758614bd09ea1df9c87df2ddad76b3" data-type="p" data-lines="3"><strong>Q：提供什么版本的sdk？</strong><br>A：目前提供c版本的so以及java版本的so。Java版本使用jni的方式来进行调用。</p><p data-sign="dfecfe1d4a12a4fcc631540c7317c099" data-type="p" data-lines="3"><strong>Q：为什么发出某些表情得到的是文本消息？</strong><br>A：对于系统内置的表情，是以文本消息的形式发送的，存储的也是文本消息</p><p data-sign="9f8c7b0be3910921950e73e6d5b80033" data-type="p" data-lines="3"><strong>Q:媒体消息下载也有时间限制吗？</strong><br>A：是的，类似会话记录，也只能拉取5天内的媒体消息内容</p><p data-sign="7bd4709c99c2dcfbd024589b3197e450" data-type="p" data-lines="3"><strong>Q：支持的消息类型是否覆盖了所有的消息类型？</strong><br>A：目前提供了常用的10+类消息类型的导出，后续如果有新消息类型的产生，也会及时的进行新消息类型的导出。对于目前不识别的消息类型，统一使用：【未知消息类型】的文本消息类型来表示。</p><p data-sign="d1708eb06e32a2aa84847152d2e83d97" data-type="p" data-lines="3"><strong>Q：是否可以重复拉取消息？</strong><br>A：目前是可以的，支持重入，相同的seq与limit可以多次拉取，但是有频率限制控制。如果过快的拉取，可能会返回失败。</p><p data-sign="35377e5971c7a598e31c15ad49b275ac" data-type="p" data-lines="3"><strong>Q：sdk是什么环境的？</strong><br>A：sdk支持linux跟windows环境。</p><p data-sign="70f4c72bd39e434d160bee9b1dab3f54" data-type="p" data-lines="3"><strong>Q：会话记录消息格式是什么？</strong><br>A：通过sdk接口拉取的会话记录为json格式，使用私钥解密后调用sdk接口获取到的消息明文也是json格式。</p><p data-sign="4f8af0e3f099501f3f34fc16c646a641" data-type="p" data-lines="3"><strong>Q：何时开始存储消息？</strong><br>A：管理端上传秘钥进行开通金融版功能后，企业成员的客户端会被强制要求同意使用金融版。同意使用的企业成员，发出的消息会开始被进行存储。</p><p data-sign="3ffd1d689ed67ef4d7f285dce82f5f1c" data-type="p" data-lines="3"><strong>Q：为什么拉取到的媒体数据不完整？</strong><br>A：请确认下同一个媒体文件，是否是追加写。如果每次覆盖，则得到的文件是最后一个分片的内容。</p><p data-sign="5f5e83403903c457ab9e14256fac89bf" data-type="p" data-lines="3"><strong>Q：返回非0错误码如何处理？</strong><br>A：无论对于拉取会话记录，还是拉取媒体消息。如果返回码是10001-10003的错误码，建议原参数重试。</p><p data-sign="8a6b19cb92b1ca2e46b6c2a368ba128d" data-type="p" data-lines="3"><strong>Q：错误码列表如何查看？</strong><br>A：在SDK的头文件内，有错误码列表以及错误码含义解释。</p><p data-sign="b6948d71332950ea8cbffca4a62257b5" data-type="p" data-lines="3"><strong>Q：为什么会返回10001错误？</strong><br>A：10001是网络错误，请校验下是否使用代理访问；是否放开了80 443端口。</p><p data-sign="3d5b66de702ba2590482b777e067e0e7" data-type="p" data-lines="3"><strong>Q：如何表明已经拉取完会话数据？</strong><br>A：通过GetChatData接口拉取的会话数据，若返回的json结构中，chatdata为空，则表明已拉取完成会话数据。</p><p data-sign="b7eaafa621f2d8879e0b9c914cc1a742" data-type="p" data-lines="3"><strong>Q：JAVA版本的sdk报错UnsatisfiedLinkError？</strong><br>A：请检查是否修改了sdk的包名。</p><p data-sign="87ce308b24a0b5702835786dbb82b851" data-type="p" data-lines="3"><strong>Q：SDK返回access_token missing？</strong><br>A：请检查初始化接口中corpid/secret是否填写正确；请检查是否每次都进行了sdk的初始化与销毁，不必每次进行sdk的初始化与销毁。</p></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>