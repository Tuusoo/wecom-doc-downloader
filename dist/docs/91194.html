<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>Android应用 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        Android应用
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2024/11/27</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="605889784952ea97a1537f09e8091217-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#android%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97" class="level-2">Android接入指南</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8" class="level-3">创建应用</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E6%8E%A5%E5%85%A5" class="level-3">授权登录接入</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E9%80%9A%E8%BF%87code%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF" class="level-3">通过code获取用户信息</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#android-11-%E7%B3%BB%E7%BB%9F%E7%AD%96%E7%95%A5%E6%9B%B4%E6%96%B0%EF%BC%8C%E8%AF%B7%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%8A%E6%97%B6%E9%80%82%E9%85%8D" class="level-3"><strong>Android 11 系统策略更新，请开发者及时适配</strong></a></li></dir><h2 id="android%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97" data-sign="4563a1c1cadea64f4833a4f459d108bb" data-lines="1"><a class="anchor" href="#android%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97"></a>Android接入指南</h2><blockquote data-sign="4efcf31403e283192812015c5fb2b53e_3" data-lines="3"><strong>接入说明：</strong><br>任何需要调用企业微信API的应用，都需要先在企业微信管理后台创建一个应用，设置完成后，即可使用对应的功能。<br>不允许跨企业使用，即仅支持企业自己的app使用。</blockquote><h3 id="%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8" data-sign="75a599e4313591ae25e60203d73939bf" data-lines="2"><a class="anchor" href="#%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"></a>创建应用</h3><ol data-sign="36db68e95c5864e86e06c3fa05b59f60list10" data-lines="10" class="cherry-list__default" start="1"><li>管理员登录企业微信管理后台，选择<strong>企业应用</strong><br></li><li>选择已有应用或添加应用，进入应用详情页面。<br></li><li>选择“企业微信授权登录”，在设置界面填写Android的 App的签名&amp;包名，设置完成后系统自动生成应用程序<strong>schema</strong>。<br><blockquote data-sign="7a4e69ac50eaecde8906a5faff7e62f4_1" data-lines="1">企业微信分享的设置，复用企业微信授权登录的设置，设置以后登录、分享任何一个都可以使用。</blockquote><br></li><li>下载企业微信终端开发工具包<br><a href="https://dldir1.qq.com/wework/wwopen/client_sdk/android/lib_wwapi-3.0.0.7.aar" rel="nofollow">lib_wwapi-3.0.0.7.aar</a><br><blockquote data-sign="3f96ffc792a42290e2a502f0db393e0b_5" data-lines="5">SDK名称：企业微信登录/分享SDK<br>版本号：3.0.0.7<br>主要功能：通过企业微信登录/分享SDK，企业可在自建的app引入sdk，从而可使用企业微信账号登录app，并且在app中分享消息到企业微信。<br>使用说明：详见本接入指南<br>开发者：深圳市腾讯计算机系统有限公司<br><strong>隐私政策：请接入企业微信登录/分享 SDK的开发者，认真阅读《<a href="https://work.weixin.qq.com/nl/act/p/47eb57a00e9f4ad5" rel="nofollow">企业微信登录/分享SDK个人信息保护规则</a>》，并确保对企业微信登录/分享SDK的接入使用情况符合上述规则的相关要求。</strong></blockquote></li></ol><p data-sign="a0415f14805a6cccd2d0f047bc0c2c1f" data-type="p" data-lines="1">每个第三方应用必须要导入该sdk库，用于实现与企业微信的通信。<a href="#android-11-%E7%B3%BB%E7%BB%9F%E7%AD%96%E7%95%A5%E6%9B%B4%E6%96%B0%EF%BC%8C%E8%AF%B7%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%8A%E6%97%B6%E9%80%82%E9%85%8D" rel="nofollow"><strong>Android 11 系统策略更新，请开发者及时适配</strong></a> </p><ol data-sign="3976d9624d3bebe96d445923b80be55alist22" data-lines="22" class="cherry-list__default" start="5"><li>搭建开发环境<br>在你需要使用企业微信终端API的文件中导入相应的类。<br>import com.tencent.wework.api.model.WWMediaText;</li><li>在代码中使用开发工具包<ul class="cherry-list__square"><li>注册到企业微信<br>要使你的程序启动后企业微信终端能响应你的程序，必须在代码中向企业微信终端注册你的id。可以在程序入口Activity的onCreate回调函数处，或其他合适的地方将你的应用schema注册到企业微信。<br><div data-sign="40aa7040dc71130dbefcdc4008664b6e" data-type="codeBlock" data-lines="14">
      <pre class="language-java"><code class="language-java wrap"><span class="code-line">	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> APPID <span class="token operator">=</span> <span class="token string">"WW1e933be11645237c"</span><span class="token punctuation">;</span></span>
<span class="code-line">	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> AGENTID <span class="token operator">=</span> <span class="token string">"1000012"</span><span class="token punctuation">;</span></span>
<span class="code-line">	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SCHEMA <span class="token operator">=</span> <span class="token string">"wwauth1e933be11645237c000012"</span><span class="token punctuation">;</span></span>
<span class="code-line"></span>
<span class="code-line">	<span class="token annotation punctuation">@Override</span></span>
<span class="code-line">	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">		<span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">		stringId <span class="token operator">=</span> <span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>labelRes<span class="token punctuation">;</span></span>
<span class="code-line">		iwwapi <span class="token operator">=</span> <span class="token class-name">WWAPIFactory</span><span class="token punctuation">.</span><span class="token function">createWWAPI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">		iwwapi<span class="token punctuation">.</span><span class="token function">registerApp</span><span class="token punctuation">(</span>SCHEMA<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">		<span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div></li><li>发送请求和接收返回值<br>现在，你的程序要发送请求到企业微信终端，可以通过IWWAPI的sendMessage方法来实现。<br>boolean sendMessage(BaseMessage msg);<br>sendMessage是第三方app主动发送消息给企业微信，发送完成之后会切回到第三方app界面。<br>boolean sendMessage(BaseMessage req, IWWAPIEventHandler callback)<br>带回调的sendMessage是第三方app向企业微信请求数据，企业微信回应数据之后会切回到第三方app界面。<br>sendMessage的实现示例，如下所示：<br><div data-sign="656d8697183a4553811bf1bf06922bc9" data-type="codeBlock" data-lines="8">
      <pre class="language-java"><code class="language-java wrap"><span class="code-line"><span class="token class-name">WWMediaText</span> txt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WWMediaText</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>et3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">txt<span class="token punctuation">.</span>appPkg <span class="token operator">=</span> <span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">txt<span class="token punctuation">.</span>appName <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span>stringId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">txt<span class="token punctuation">.</span>appId <span class="token operator">=</span> APPID<span class="token punctuation">;</span></span>
<span class="code-line">txt<span class="token punctuation">.</span>agentId <span class="token operator">=</span> AGENTID<span class="token punctuation">;</span></span>
<span class="code-line">iwwapi<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><br>带回调的sendMessage的实现，如下所示：<br><div data-sign="b8ca2cda13e54f4df18cd7fa47e2a931" data-type="codeBlock" data-lines="23">
      <pre class="language-java"><code class="language-java wrap"><span class="code-line"><span class="token keyword">final</span> <span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Req</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Req</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>sch <span class="token operator">=</span> SCHEMA<span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>appId <span class="token operator">=</span> APPID<span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>agentId <span class="token operator">=</span> AGENTID<span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">"dd"</span><span class="token punctuation">;</span></span>
<span class="code-line">iwwapi<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IWWAPIEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token annotation punctuation">@Override</span></span>
<span class="code-line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleResp</span><span class="token punctuation">(</span><span class="token class-name">BaseMessage</span> resp<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token keyword">if</span> <span class="token punctuation">(</span>resp <span class="token keyword">instanceof</span> <span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Resp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Resp</span> rsp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Resp</span><span class="token punctuation">)</span> resp<span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token keyword">if</span> <span class="token punctuation">(</span>rsp<span class="token punctuation">.</span>errCode <span class="token operator">==</span> <span class="token class-name">WWAuthMessage</span><span class="token punctuation">.</span>ERR_CANCEL<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"登录取消"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rsp<span class="token punctuation">.</span>errCode <span class="token operator">==</span> <span class="token class-name">WWAuthMessage</span><span class="token punctuation">.</span>ERR_FAIL<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"登录失败"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rsp<span class="token punctuation">.</span>errCode <span class="token operator">==</span> <span class="token class-name">WWAuthMessage</span><span class="token punctuation">.</span>ERR_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"登录成功："</span> <span class="token operator">+</span> rsp<span class="token punctuation">.</span>code<span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token punctuation">}</span></span>
<span class="code-line">		<span class="token punctuation">}</span></span>
<span class="code-line">	<span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><br>具体要发送的内容由第三方app开发者定义，具体可参考微信开发工具包中的SDK apitest源码。<br>注意<br>如果需要混淆代码，为了保证sdk的正常使用，需要在proguard.cfg加上下面两行配置：<br><div data-sign="a5fe822436d607e6b57e8c900b601282" data-type="codeBlock" data-lines="5">
      <pre class="language-java"><code class="language-java wrap"><span class="code-line"><span class="token operator">-</span>keep <span class="token keyword">class</span> com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>wework<span class="token punctuation">.</span>api<span class="token punctuation">.</span>*<span class="token operator">*</span> <span class="token punctuation">{</span></span>
<span class="code-line">   <span class="token operator">*</span><span class="token punctuation">;</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><br>至此，你已经能使用企业微信Android开发工具包的API内容了。如果想更详细了解每个API函数的用法，请查阅 Android 平台参考手册 或自行下载阅读企业微信apitest源码。</li></ul></li></ol><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h3 id="%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E6%8E%A5%E5%85%A5" data-sign="9a7a2bba213b7285261364d6cbcedef7" data-lines="1"><a class="anchor" href="#%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95%E6%8E%A5%E5%85%A5"></a>授权登录接入</h3><p data-sign="306e9f594f5b46b7bab9ef1255176198" data-type="p" data-lines="2">开发者需要配合使用企业微信提供的SDK进行授权登录请求接入。正确接入SDK后开发者移动应用会在终端本地拉起企业微信应用进行授权登录，企业微信用户确认后企业微信将回调授权临时票据（code），同时返回开发者移动应用。<br>Android平台应用授权登录接入代码示例（请参考Android接入指南）：</p><div data-sign="b8ca2cda13e54f4df18cd7fa47e2a931" data-type="codeBlock" data-lines="23">
      <pre class="language-java"><code class="language-java wrap"><span class="code-line"><span class="token keyword">final</span> <span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Req</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Req</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>sch <span class="token operator">=</span> SCHEMA<span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>appId <span class="token operator">=</span> APPID<span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>agentId <span class="token operator">=</span> AGENTID<span class="token punctuation">;</span></span>
<span class="code-line">req<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">"dd"</span><span class="token punctuation">;</span></span>
<span class="code-line">iwwapi<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IWWAPIEventHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token annotation punctuation">@Override</span></span>
<span class="code-line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleResp</span><span class="token punctuation">(</span><span class="token class-name">BaseMessage</span> resp<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token keyword">if</span> <span class="token punctuation">(</span>resp <span class="token keyword">instanceof</span> <span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Resp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Resp</span> rsp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WWAuthMessage<span class="token punctuation">.</span>Resp</span><span class="token punctuation">)</span> resp<span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token keyword">if</span> <span class="token punctuation">(</span>rsp<span class="token punctuation">.</span>errCode <span class="token operator">==</span> <span class="token class-name">WWAuthMessage</span><span class="token punctuation">.</span>ERR_CANCEL<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"登录取消"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rsp<span class="token punctuation">.</span>errCode <span class="token operator">==</span> <span class="token class-name">WWAuthMessage</span><span class="token punctuation">.</span>ERR_FAIL<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"登录失败"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rsp<span class="token punctuation">.</span>errCode <span class="token operator">==</span> <span class="token class-name">WWAuthMessage</span><span class="token punctuation">.</span>ERR_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"登录成功："</span> <span class="token operator">+</span> rsp<span class="token punctuation">.</span>code<span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="code-line">			<span class="token punctuation">}</span></span>
<span class="code-line">		<span class="token punctuation">}</span></span>
<span class="code-line">	<span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="21f2fa80eb8f025c07495bc38851fbab" data-type="p" data-lines="1">参数说明</p><div class="cherry-table-container" data-sign="88b24cabdc9b6200f82c3efc43062c77" data-lines="6">
        <table class="cherry-table"><thead><tr><th>参数</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>appid</td><td>是</td><td>企业唯一标识。创建企业后显示在，我的企业  CorpID字段</td></tr><tr><td>agentid</td><td>是</td><td>应用唯一标识。显示在具体应用下的 AgentId字段</td></tr><tr><td>sch</td><td>是</td><td>应用跳转标识，显示在具体应用下的 Schema字段</td></tr><tr><td>state</td><td>否</td><td>用于保持请求和回调的状态，授权请求后原样带回给第三方。该参数可用于防止csrf攻击（跨站请求伪造攻击），建议第三方带上该参数，可设置为简单的随机数加session进行校验</td></tr></tbody></table></div><blockquote data-sign="28c2c7a7418d38a7f095d86dff2a240c_4" data-lines="4">参数示例：<br>appid: WW1e933be11645237c<br>agentid: 1000012<br>sch：wwauth1e933be11645237c000012<br>state: wwapitest</blockquote><p data-sign="013853d0fc3ac2482271d9241ba025e6" data-type="p" data-lines="5">可拉起企业微信打开授权登录页：<br>返回说明<br>用户点击授权后，企业微信客户端会被拉起，跳转至授权界面，用户在该界面点击允许或取消，SDK通过回调返回数据给调用方。<br>返回值<br>说明</p><div data-sign="3bb7e76addc74784b7a65e56f3237fb5" data-type="codeBlock" data-lines="6">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">errCode</span>
<span class="code-line"><span class="token constant">ERR_OK</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">(</span>用户同意<span class="token punctuation">)</span></span>
<span class="code-line"><span class="token constant">ERR_FAIL</span> <span class="token operator">=</span> <span class="token number">1</span>（授权失败）</span>
<span class="code-line"><span class="token constant">ERR_CANCEL</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>（用户取消）</span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="008c51d329f945095dfd63b168c723ac" data-type="p" data-lines="4">code<br>用户换取access_token的code，仅在ErrCode为0时有效<br>state<br>第三方程序发送时用来标识其请求的唯一性的标志，由第三方程序调用sendMessage时传入，由企业微信终端回传，state字符串长度不能超过1K</p><h3 id="%E9%80%9A%E8%BF%87code%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF" data-sign="4a3e7ab4eef8ec374ba7ce9df74b9959" data-lines="2"><a class="anchor" href="#%E9%80%9A%E8%BF%87code%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"></a>通过code获取用户信息</h3><p data-sign="19a3f73386b17858dfcc4f7dedc4b08c" data-type="p" data-lines="3"><strong>请求方式：</strong>GET（<strong>HTTPS</strong>）<br><strong>请求地址：</strong>https://qyapi.weixin.qq.com/cgi-bin/user/getuserinfo?access_token=ACCESS_TOKEN&amp;code=CODE</p><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="bd22d34721849af089beeabb90eaf208" data-lines="4">
        <table class="cherry-table"><thead><tr><th>参数</th><th>必须</th><th>说明</th></tr></thead><tbody><tr><td>access_token</td><td>是</td><td>调用接口凭证</td></tr><tr><td>code</td><td>是</td><td>通过成员授权获取到的code，每次成员授权带上的code将不一样，code只能使用一次，5分钟未被使用自动过期</td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="dd13b239ebe0006120d14023adff7344" data-type="p" data-lines="2"><strong>权限说明：</strong><br>跳转的域名须完全匹配企业内任一应用的可信域名。</p><p data-sign="8c8bd07f58486862a201112e85376126" data-type="p" data-lines="2"><strong>返回结果：</strong></p><div data-sign="f3f0feca75afeec4f3e2329bcbc0b859" data-type="codeBlock" data-lines="7">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">   <span class="token string">"UserId"</span><span class="token operator">:</span><span class="token string">"USERID"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span>
<span class="code-line"></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><div class="cherry-table-container" data-sign="9eb369dd32f125ad2a33a7f560ff5376" data-lines="3">
        <table class="cherry-table"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>UserId</td><td>成员UserID</td></tr></tbody></table></div><p data-sign="8b50e9961d524706fefc024f034c742f" data-type="p" data-lines="2"><strong>出错返回示例：</strong></p><div data-sign="8754e64cac6db39aa43e460198debbed" data-type="codeBlock" data-lines="8">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">   <span class="token string">"errcode"</span><span class="token operator">:</span> <span class="token number">40029</span><span class="token punctuation">,</span></span>
<span class="code-line">   <span class="token string">"errmsg"</span><span class="token operator">:</span> <span class="token string">"invalid code"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span>
<span class="code-line"></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h3 id="android-11-%E7%B3%BB%E7%BB%9F%E7%AD%96%E7%95%A5%E6%9B%B4%E6%96%B0%EF%BC%8C%E8%AF%B7%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%8A%E6%97%B6%E9%80%82%E9%85%8D" data-sign="00fe3b2f1f820bbe66514b544cf113df" data-lines="2"><a class="anchor" href="#android-11-%E7%B3%BB%E7%BB%9F%E7%AD%96%E7%95%A5%E6%9B%B4%E6%96%B0%EF%BC%8C%E8%AF%B7%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%8A%E6%97%B6%E9%80%82%E9%85%8D"></a><strong>Android 11 系统策略更新，请开发者及时适配</strong></h3><p data-sign="566bbe4a02cd67f93b08091aa51b99f1" data-type="p" data-lines="4">Android 11 版本为加强用户隐私保护引入较多变更，第三方应用需要适配有变更：<br>软件包可见性变更，会导致第三方应用通过 sdk 接口拉起企业微信受限，从而影响分享消息到企业微信、登陆等功能的正常使用（该变更只对升级targetSdkVersion=30 的应用产生影响）<br><strong>软件可见性适配方案</strong><br>1、根据 Android 官方给出的适配方案，在主工程的AndroidManifest.xml 中增加 标签，即可解决以上影响，示例代码如下：</p><div data-sign="54b49ccaf77612607d5acfdec6d3e8c6" data-type="codeBlock" data-lines="10">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token operator">&lt;</span>manifest <span class="token keyword">package</span><span class="token operator">=</span><span class="token string">"com.example.app"</span><span class="token operator">&gt;</span></span>
<span class="code-line">      <span class="token operator">...</span></span>
<span class="code-line">      <span class="token comment">// 在应用的AndroidManifest.xml添加如下&lt;queries&gt;标签</span></span>
<span class="code-line">    <span class="token operator">&lt;</span>queries<span class="token operator">&gt;</span></span>
<span class="code-line">        <span class="token operator">&lt;</span><span class="token keyword">package</span> android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"com.tencent.wework"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>   <span class="token comment">// 指定企业微信包名</span></span>
<span class="code-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>queries<span class="token operator">&gt;</span></span>
<span class="code-line">      <span class="token operator">...</span></span>
<span class="code-line"><span class="token operator">&lt;</span><span class="token operator">/</span>manifest<span class="token operator">&gt;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="1910c4fd516d96c5038a95df1e6f9358" data-type="p" data-lines="1">2、添加以上标签之后，需要开发者升级编译工具，否则会出现编译错误。</p><ul data-sign="125186bbec5cedb2d4137678cd981c45list3" data-lines="3" class="cherry-list__default"><li>Android Studio 需要升级至 3.3 及以上，建议升级至 4.0 及以上版本；</li><li>Android SDK Build-Tools 需要升级至 30 及以上版本；</li><li>com.android.tools.build:gradle 需要升级至 3.6.0 版本，建议升级至最新的 3.6.4 版本。</li></ul></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>