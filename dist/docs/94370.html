<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>wx.qy.sendChatMessage - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        wx.qy.sendChatMessage
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2022/12/14</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><h3 id="wxqysendchatmessageobject-object" data-sign="1181cff9547a3ef769bd695f533756bb" data-lines="1"><a class="anchor" href="#wxqysendchatmessageobject-object"></a>wx.qy.sendChatMessage(Object object)</h3><p data-sign="08185003f56e29e718903a8441db6417" data-type="p" data-lines="1">在工具栏或者附件栏向当前会话发送消息，支持多种消息格式，包括文本("text")，图片("image")，视频("video")，文件("file")、H5("news"）和小程序("miniprogram")。</p><blockquote data-sign="080bf149449b7687bcc2ac8bbc5cb687_5" data-lines="5"><strong>调用前提：</strong><br>1. 必须先调用过wx.qy.login，且session_key未过期，开发者可调用checkSession 检查当前登录态<br>2. 当前成员必须在应用的可见范围，否则报错：user not in allow list<br>3. 需要从特定入口进入页面才可调用，否则会报错：without context of external contact，可先通过调用<a href="#21951" rel="nofollow">wx.qy.getContext</a>来判断进入小程序的入口，允许调用的入口说明参见<a href="#%E4%B8%8D%E5%90%8C%E5%85%A5%E5%8F%A3%E6%89%80%E9%9C%80%E7%9A%84%E6%9D%83%E9%99%90%E8%AF%B4%E6%98%8E" rel="nofollow">“不同入口所需的权限说明”</a>。<br>4. 从不同的入口进入的页面，应用需要满足相应用的权限，否则会报“no permission”错误，所需的权限参见<a href="#%E4%B8%8D%E5%90%8C%E5%85%A5%E5%8F%A3%E6%89%80%E9%9C%80%E7%9A%84%E6%9D%83%E9%99%90%E8%AF%B4%E6%98%8E" rel="nofollow">“不同入口所需的权限说明”</a>。</blockquote><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h4 id="%E5%8F%82%E6%95%B0" data-sign="8cb71f61557fabe1ccf527e1bd04a132" data-lines="1"><a class="anchor" href="#%E5%8F%82%E6%95%B0"></a>参数</h4><h5 id="object-object" data-sign="46276ba891600e417ac243f8fabb1b82" data-lines="2"><a class="anchor" href="#object-object"></a>Object object</h5><div class="cherry-table-container" data-sign="19290e84b514012c14dea61d22985234" data-lines="25">
        <table class="cherry-table"><thead><tr><th>参数名</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>msgtype</td><td>string</td><td>是</td><td>消息类型</td></tr><tr><td>enterChat</td><td>Boolean</td><td>否</td><td>为true时表示发送完成之后顺便进入会话，仅移动端3.1.10及以上版本支持该字段</td></tr><tr><td>text</td><td>Object</td><td>否</td><td>文本消息</td></tr><tr><td>text::content</td><td>string</td><td>否</td><td>文本消息内容</td></tr><tr><td>image</td><td>Object</td><td>否</td><td>图片消息</td></tr><tr><td>image::mediaid</td><td>string</td><td>否</td><td>图片的素材id，可通过<a href="#10112" rel="nofollow">素材管理</a>接口获得</td></tr><tr><td>video</td><td>Object</td><td>否</td><td>视频消息</td></tr><tr><td>video::mediaid</td><td>string</td><td>否</td><td>视频的素材id，可通过<a href="#10112" rel="nofollow">素材管理</a>接口获得</td></tr><tr><td>file</td><td>Object</td><td>否</td><td>文件消息</td></tr><tr><td>file::mediaid</td><td>string</td><td>否</td><td>文件的素材id，可通过<a href="#10112" rel="nofollow">素材管理</a>接口获得</td></tr><tr><td>news</td><td>Object</td><td>否</td><td>H5消息</td></tr><tr><td>news::link</td><td>string</td><td>否</td><td>H5消息页面url</td></tr><tr><td>news::title</td><td>string</td><td>否</td><td>H5消息标题</td></tr><tr><td>news::desc</td><td>string</td><td>否</td><td>H5消息摘要</td></tr><tr><td>news::imgUrl</td><td>string</td><td>否</td><td>H5消息封面图片URL</td></tr><tr><td>miniprogram</td><td>Object</td><td>否</td><td>小程序消息</td></tr><tr><td>miniprogram::appid</td><td>string</td><td>是</td><td>小程序appid，必须是企业工作台已关联的小程序</td></tr><tr><td>miniprogram::title</td><td>string</td><td>是</td><td>小程序消息标题</td></tr><tr><td>miniprogram::imgUrl</td><td>string</td><td>是</td><td>消息显示图片的链接（网络图片路径），对于安卓平台也支持本地图片文件路径或相对代码包根目录的图片文件路径。显示图片长宽比是 5:4。<br>若使用网络图片路径，必须带http或者https协议头，否则报错 <span data-type="mathBlock" data-lines="2" class="Cherry-InlineMath">$apiName$</span>:fail invalid imgUrl</td></tr><tr><td>miniprogram::page</td><td>string</td><td>是</td><td>小程序打开后的路径，注意要以.html作为后缀，否则在微信端打开会提示找不到页面</td></tr><tr><td>success</td><td>Function</td><td>否</td><td>群发成功的回调函数</td></tr><tr><td>fail</td><td>Function</td><td>否</td><td>群发失败的回调函数</td></tr><tr><td>complete</td><td>Function</td><td>否</td><td>调用结束的回调函数（群发成功、失败都会执行）</td></tr></tbody></table></div><p data-sign="br3" data-type="br" data-lines="3">&nbsp;</p><h4 id="%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%EF%BC%9A" data-sign="a3eb661066708b00561e1028019ee536" data-lines="1"><a class="anchor" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%EF%BC%9A"></a>示例代码：</h4><div data-sign="649c9fce801805990698ab4985d87f79" data-type="codeBlock" data-lines="38">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">wx<span class="token punctuation">.</span>qy<span class="token punctuation">.</span><span class="token function">sendChatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="code-line">    msgtype<span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token comment">//消息类型，必填</span></span>
<span class="code-line">	enterChat<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//为true时表示发送完成之后顺便进入会话，仅移动端3.1.10及以上版本支持该字段</span></span>
<span class="code-line">	text<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		content<span class="token operator">:</span><span class="token string">"你好"</span><span class="token punctuation">,</span> <span class="token comment">//文本内容</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	image<span class="token operator">:</span></span>
<span class="code-line">	<span class="token punctuation">{</span></span>
<span class="code-line">		mediaid<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//图片的素材id</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	video<span class="token operator">:</span></span>
<span class="code-line">	<span class="token punctuation">{</span></span>
<span class="code-line">		mediaid<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//视频的素材id</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	file<span class="token operator">:</span></span>
<span class="code-line">	<span class="token punctuation">{</span></span>
<span class="code-line">	   mediaid<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//文件的素材id</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	news<span class="token operator">:</span></span>
<span class="code-line">	<span class="token punctuation">{</span></span>
<span class="code-line">		link<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//H5消息页面url 必填</span></span>
<span class="code-line">		title<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//H5消息标题</span></span>
<span class="code-line">		desc<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//H5消息摘要</span></span>
<span class="code-line">		imgUrl<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//H5消息封面图片URL</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	miniprogram<span class="token operator">:</span></span>
<span class="code-line">	<span class="token punctuation">{</span></span>
<span class="code-line">		appid<span class="token operator">:</span> <span class="token string">"wx8bd80126147df384"</span><span class="token punctuation">,</span><span class="token comment">//小程序的appid</span></span>
<span class="code-line">		title<span class="token operator">:</span> <span class="token string">"this is title"</span><span class="token punctuation">,</span> <span class="token comment">//小程序消息的title</span></span>
<span class="code-line">		imgUrl<span class="token operator">:</span><span class="token string">"/appData/pic/pic1.jpg"</span><span class="token punctuation">,</span><span class="token comment">//小程序消息的封面图</span></span>
<span class="code-line">		page<span class="token operator">:</span><span class="token string">"/index/page.html"</span><span class="token punctuation">,</span> <span class="token comment">//小程序消息打开后的路径，注意要以.html作为后缀，否则在微信端打开会提示找不到页面</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">         <span class="token comment">//todo:</span></span>
<span class="code-line">    <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h4 id="%E4%B8%8D%E5%90%8C%E5%85%A5%E5%8F%A3%E6%89%80%E9%9C%80%E7%9A%84%E6%9D%83%E9%99%90%E8%AF%B4%E6%98%8E" data-sign="1bbe6c76f8a3e3be3737f07c9a3faf0d" data-lines="2"><a class="anchor" href="#%E4%B8%8D%E5%90%8C%E5%85%A5%E5%8F%A3%E6%89%80%E9%9C%80%E7%9A%84%E6%9D%83%E9%99%90%E8%AF%B4%E6%98%8E"></a>不同入口所需的权限说明</h4><div class="cherry-table-container" data-sign="ba1cb8d767aad9a00e8a881770b7cc34" data-lines="7">
        <table class="cherry-table"><thead><tr><th>入口</th><th>[getContext](#21951)的entry值</th><th>自建应用</th><th>第三方应用</th><th>用户</th><th>支持的最低版本</th></tr></thead><tbody><tr><td>外部单聊工具栏</td><td>single_chat_tools</td><td>需有<a href="#13473/%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E8%81%94%E7%B3%BB%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%BA%94%E7%94%A8" rel="nofollow">客户联系功能权限</a></td><td>需有“企业客户权限-&gt;客户基础信息”权限</td><td><a href="#13473/%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E8%81%94%E7%B3%BB%E5%8A%9F%E8%83%BD%E7%9A%84%E6%88%90%E5%91%98" rel="nofollow">配置了客户联系功能</a></td><td>3.0.16</td></tr><tr><td>外部群聊工具栏</td><td>group_chat_tools</td><td>需有<a href="#13473/%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E8%81%94%E7%B3%BB%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%BA%94%E7%94%A8" rel="nofollow">客户联系功能权限</a></td><td>需有“企业客户权限-&gt;客户基础信息”权限</td><td><a href="#13473/%E9%85%8D%E7%BD%AE%E5%8F%AF%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E8%81%94%E7%B3%BB%E5%8A%9F%E8%83%BD%E7%9A%84%E6%88%90%E5%91%98" rel="nofollow">配置了客户联系功能</a></td><td>3.0.16</td></tr><tr><td>班级群的聊天工具栏</td><td>group_chat_tools</td><td>所有</td><td>需有「家校沟通」使用权限</td><td>所有</td><td>3.0.36</td></tr><tr><td>学生群的聊天工具栏</td><td>group_chat_tools</td><td>所有</td><td>需有「家校沟通」使用权限</td><td>所有</td><td>4.0.8</td></tr><tr><td>聊天附件栏</td><td>chat_attachment</td><td>所有</td><td>所有</td><td>所有</td><td>3.1.6（mac端暂不支持）</td></tr></tbody></table></div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>