<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>专区程序示例 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        专区程序示例
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2025/02/08</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="2647e7429e189a251d0904df18d1a17a-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#%E6%B7%BB%E5%8A%A0%E7%A8%8B%E5%BA%8F" class="level-1">添加程序</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#python" class="level-2">Python</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE" class="level-3">启动配置</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE" class="level-3">程序能力配置</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B" class="level-4">添加获取会话记录能力</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B" class="level-4">获取回调数据能力</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#java" class="level-2">Java</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE-3" class="level-3">启动配置</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE-3" class="level-3">程序能力配置</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B-3" class="level-4">添加获取会话记录能力</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B-3" class="level-4">获取回调数据能力</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#specsdkinvoke%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E5%80%BC%E8%AF%B4%E6%98%8E" class="level-3">SpecSDK.invoke接口返回值说明</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c" class="level-2">C++</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE-4" class="level-3">启动配置</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE-4" class="level-3">程序能力配置</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B-4" class="level-4">添加获取会话记录能力</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B-4" class="level-4">获取回调数据能力</a></li><li class="toc-li"><a href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E7%A8%8B%E5%BA%8F" class="level-1">应用调用程序</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#python-3" class="level-2">Python</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A" class="level-3">应用调用获取会话记录能力示例：</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A" class="level-3">应用获取回调数据示例：</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#java-3" class="level-2">Java</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A-3" class="level-3">应用调用获取会话记录能力示例：</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A-3" class="level-3">应用获取回调数据示例：</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#c-3" class="level-2">C++</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A-4" class="level-3">应用调用获取会话记录能力示例：</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A-4" class="level-3">应用获取回调数据示例：</a></li><li class="toc-li"><a href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E7%9A%84%E6%B5%81%E7%A8%8B%E7%A4%BA%E4%BE%8B" class="level-1">应用获取会话记录的流程示例</a></li></dir><p data-sign="6c1045259e3bb577991464cca3f22418" data-type="p" data-lines="3">我们提供了一套专区程序的示例代码，开发者可以在示例源码的基础上进行开发，再根据<a href="#53065" rel="nofollow">镜像文件配置指引</a>制作镜像。开发者也可以先下载我们制作好的示例镜像，根据<a href="#53065" rel="nofollow">镜像文件配置指引</a>在管理端上传配置镜像。示例源码和示例镜像可通过<a href="#55652" rel="nofollow">这里下载</a>。<br>以下是该镜像的启动命令与程序配置说明。</p><h1 id="%E6%B7%BB%E5%8A%A0%E7%A8%8B%E5%BA%8F" data-sign="4ad7ae2182fcf12f66a557351782e22d" data-lines="2"><a class="anchor" href="#%E6%B7%BB%E5%8A%A0%E7%A8%8B%E5%BA%8F"></a>添加程序</h1><h2 id="python" data-sign="7ab7cc8eaa872e4b3a2edabf285d71a1" data-lines="2"><a class="anchor" href="#python"></a>Python</h2><h3 id="%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE" data-sign="e8727c81f69ec1268e3dc9bfe96a50a6" data-lines="2"><a class="anchor" href="#%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE"></a>启动配置</h3><div data-sign="b40ee72c3f829586ad26a01b902e434d" data-type="codeBlock" data-lines="6">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">启动命令</span>
<span class="code-line"><span class="token operator">/</span>bin<span class="token operator">/</span>sh</span>
<span class="code-line">启动参数</span>
<span class="code-line"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>wwspecdemo<span class="token operator">/</span>start<span class="token punctuation">.</span>sh</span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="38227067760c31411c06b3dd9497551d" data-type="p" data-lines="1"><img src="images/100052/a5d764ea.png" width="70%"></p><h3 id="%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE" data-sign="3f4d76f9c5c56da5a7742b576ad78080" data-lines="2"><a class="anchor" href="#%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE"></a>程序能力配置</h3><p data-sign="e45c6d503d20159d63a2fb0e1c0ebcd5" data-type="p" data-lines="2">示例程序支持应用同步发起调用sdk接口以及获取回调到专区的数据。<br>如果要调用某个sdk接口，需要给程序添加对应sdk接口的能力。</p><p data-sign="6967891dc500189ea6b58f58800b8099" data-type="p" data-lines="1">输入协议说明</p><div data-sign="51c8640bcdb236878a5eeef0e9c9f87f" data-type="codeBlock" data-lines="9">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"input"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"指定要处理的逻辑"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"func_req"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token punctuation">}</span></span>
<span class="code-line">    <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><blockquote data-sign="0ddb894b836d3c77529571a01e0dfcfb_2" data-lines="2">不依赖“能力ID”，而是通过<code>input.func</code>区分demo要处理的逻辑<br><code>input.func</code>提供的能力以及对应的值，可参考demo源码<code>demoloadsdk.py</code><br><code>input.func_req</code>为<code>json object</code>，作为 <code>input.func</code>处理逻辑对应的协议</blockquote><p data-sign="c420b2aca4a34dc95452a34ae517f89b" data-type="p" data-lines="2">下面以两个能力举例说明。</p><h4 id="%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B" data-sign="477d2075f3e6faedd0f4de07800d03d6" data-lines="2"><a class="anchor" href="#%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B"></a>添加获取会话记录能力</h4><p data-sign="f40e9c70246737627e5e537b64afa7d4" data-type="p" data-lines="1">输入协议</p><div data-sign="6238075b8ad0ef89166e6f2917d4743d" data-type="codeBlock" data-lines="12">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"input"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"sync_msg"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"func_req"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"cursor"</span><span class="token operator">:</span> <span class="token string">"RMTJID"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"NGEJKGOEGJKOEGNEOAGOEGOKEGHOEEEEE"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">200</span></span>
<span class="code-line">        <span class="token punctuation">}</span></span>
<span class="code-line">    <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><blockquote data-sign="987741fa2500eb23a925970d86cc5cab_1" data-lines="1"><code>func</code>固定为<code>sync_msg</code>，此时<code>func_req</code>为<a href="#53341" rel="nofollow">获取会话记录</a>对应的输入协议</blockquote><p data-sign="d31585287848c1a62ef108f09410fc20" data-type="p" data-lines="1">输出协议</p><div data-sign="79794f75c15cdae4fabdd71942197cb1" data-type="codeBlock" data-lines="34">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"has_more"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"next_cursor"</span><span class="token operator">:</span><span class="token string">"JGNLGEHJGIE"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"msg_list"</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"msgid"</span><span class="token operator">:</span><span class="token string">"xxxmsgid"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"sender"</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"woxxxxxmmgjiegjie"</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"receiver_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="code-line">                <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"woAAAAAAAAAAA"</span></span>
<span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"wmXXXXXXXXXXXXX"</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"chatid"</span><span class="token operator">:</span> <span class="token string">"wrXXXXXXXXXX"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"send_time"</span><span class="token operator">:</span><span class="token number">166666666</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"msgtype"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"service_encrypt_info"</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"encrypted_secret_key"</span><span class="token operator">:</span><span class="token string">"KEYAAAAAAABBBBBB"</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token property">"public_key_ver"</span><span class="token operator">:</span><span class="token number">1</span></span>
<span class="code-line">            <span class="token punctuation">}</span></span>
<span class="code-line">        <span class="token punctuation">}</span></span>
<span class="code-line">    <span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h4 id="%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B" data-sign="171b2a10b70f02cb940a9c76bc92481f" data-lines="1"><a class="anchor" href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B"></a>获取回调数据能力</h4><p data-sign="f40e9c70246737627e5e537b64afa7d4" data-type="p" data-lines="1">输入协议</p><div data-sign="1869c632a0de6560fee1f369dd129b95" data-type="codeBlock" data-lines="9">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"input"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"do_async_job"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"func_req"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token punctuation">}</span></span>
<span class="code-line">    <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><blockquote data-sign="e3c9f297d968380c7357434ff3d3c8b6_1" data-lines="1"><code>func</code>固定为<code>do_async_job</code>，此时<code>func_req</code>为空<br>调用<a href="#53295" rel="nofollow">应用同步调用专区程序</a>接口时，外层<code>notify_id</code>传入<a href="#53360" rel="nofollow">应用接收专区通知</a>回调的<code>NotifyId</code>字段</blockquote><p data-sign="d31585287848c1a62ef108f09410fc20" data-type="p" data-lines="1">输出协议</p><div data-sign="746f930547172500c081a8e955937038" data-type="codeBlock" data-lines="35">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"errcode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"errmsg"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"event_type"</span><span class="token operator">:</span> <span class="token string">"chat_archive_audit_approved_single"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">1408091189</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"chat_archive_audit_approved"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"userid"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"external_userid"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"chatid"</span><span class="token operator">:</span><span class="token string">"xxx"</span></span>
<span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"conversation_new_message"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"zzzzzzzzzzz"</span></span>
<span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"hit_keyword"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"xxx"</span></span>
<span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"auth_knowledge_base"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"knowledge_base_id"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"knowledge_base_name"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span></span>
<span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	</span>
<span class="code-line">    <span class="token property">"unauth_knowledge_base"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"knowledge_base_id"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"knowledge_base_name"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span></span>
<span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"delete_knowledge_base"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"knowledge_base_id"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token property">"knowledge_base_name"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span></span>
<span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"chat_archive_export_finished"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        <span class="token property">"jobid"</span><span class="token operator">:</span> <span class="token string">"xxx"</span></span>
<span class="code-line">    <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><blockquote data-sign="941598b961c9d750fd8fb86dfd8adc97_1" data-lines="1">程序没有出现内部错误时，不会返回errcode和errmsg<br>将所有需要回调的协议合并</blockquote><h2 id="java" data-sign="1241d4dfc441083e463c91752f4e4a8f" data-lines="2"><a class="anchor" href="#java"></a>Java</h2><h3 id="%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE-3" data-sign="c5cfcd3da5f28698416479b3f517cf49" data-lines="2"><a class="anchor" href="#%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE-3"></a>启动配置</h3><div data-sign="0cfd1f8badadb0c51ee26bdd9ed3aa92" data-type="codeBlock" data-lines="18">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">启动命令</span>
<span class="code-line"><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>java  <span class="token comment">// 绝对路径</span></span>
<span class="code-line">启动参数</span>
<span class="code-line"><span class="token number">1.</span> <span class="token operator">-</span>Dfile<span class="token punctuation">.</span>encoding<span class="token operator">=</span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span>  <span class="token comment">// 必须指定JVM默认字符编码为UTF-8</span></span>
<span class="code-line"><span class="token number">2.</span> <span class="token operator">-</span>jar</span>
<span class="code-line"><span class="token number">3.</span> <span class="token operator">/</span>app<span class="token operator">/</span>SpecDemo<span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>dependencies<span class="token punctuation">.</span>jar  <span class="token comment">// 绝对路径</span></span>
<span class="code-line"><span class="token number">4.</span> <span class="token operator">-</span>p  <span class="token comment">//非必填</span></span>
<span class="code-line"><span class="token number">5.</span> <span class="token number">0</span>  <span class="token comment">//-p参数的值。processInIoThread 业务逻辑是否在io线程执行。1:使用io线程执行业务逻辑 0:</span></span>
<span class="code-line">            使用自定义业务线程执行业务逻辑，默认为<span class="token number">1.</span>（建议设置为<span class="token number">0</span>，使用业务线程池执行业务逻辑）</span>
<span class="code-line"><span class="token number">6.</span> <span class="token operator">-</span>i <span class="token comment">//非必填</span></span>
<span class="code-line"><span class="token number">7.</span> <span class="token number">32</span> <span class="token comment">//-i参数的值。io worker thread count NioEventLoop worker线程池大小</span></span>
<span class="code-line"><span class="token number">8.</span> <span class="token operator">-</span>b <span class="token comment">//非必填</span></span>
<span class="code-line"><span class="token number">9.</span> <span class="token number">256</span> <span class="token comment">//-b参数的值。业务线程池大小</span></span>
<span class="code-line"><span class="token number">10.</span> <span class="token operator">-</span>m <span class="token comment">//非必填</span></span>
<span class="code-line"><span class="token number">11.</span> <span class="token number">60</span> <span class="token comment">//-m参数的值。monitor interval 监控线程打日志时间间隔，默认为60s</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="2ae0c2e6287c1b5bea28cebca43de66a" data-type="p" data-lines="1"><img src="images/100052/7966d9a3.png" width="70%"></p><h3 id="%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE-3" data-sign="769eeecfcafdd39f0e464f7a633ded5f" data-lines="2"><a class="anchor" href="#%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE-3"></a>程序能力配置</h3><p data-sign="e45c6d503d20159d63a2fb0e1c0ebcd5" data-type="p" data-lines="3">示例程序支持应用同步发起调用sdk接口以及获取回调到专区的数据。<br>如果要调用某个sdk接口，需要给程序添加对应sdk接口的能力。</p><blockquote data-sign="fe1860c1e378931b2fa3c74592ae4fec_2" data-lines="2">如果需要将Java程序示例直接部署到专区进行调试，程序能力的注册请参照如下内容，否则请求和响应可能无法通过专区通道的校验</blockquote><h4 id="%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B-3" data-sign="b80db3abac418e2840a994ba4e094b23" data-lines="2"><a class="anchor" href="#%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B-3"></a>添加获取会话记录能力</h4><p data-sign="beb2e4d9b78b957ebc2b7d6b2ee376ca" data-type="p" data-lines="2">ability_id: invoke_sync_msg</p><blockquote data-sign="23505c7473247f10da5539bc5d23b5db_2" data-lines="2">ability_id格式：invoke_<span class="Cherry-InlineMath" data-type="mathBlock" data-lines="2">$API_NAME$</span><br>注意：Java程序示例对透传请求的处理逻辑为：<strong>将传入的能力ID截断“invoke_”前缀后，直接用于调用sdk。</strong>开发者如果需要自定义透传请求的能力ID，请额外添加自定义能力ID与sdk接口名的映射，并保证接口名合法</blockquote><p data-sign="eb5564eee397723e363cf32a21325ff5" data-type="p" data-lines="2">输入协议：<br>注意：Java程序示例的默认输入协议中，request_data内无需包裹一层input对象</p><div data-sign="2c43b5bc967ae4e6c3b3f555c8d742aa" data-type="codeBlock" data-lines="7">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">  <span class="token property">"cursor"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> </span>
<span class="code-line">  <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">  <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">""</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="95c1e5212efea472d0fd070f4de7b756" data-type="p" data-lines="1">输出协议：</p><div data-sign="79794f75c15cdae4fabdd71942197cb1" data-type="codeBlock" data-lines="34">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"has_more"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"next_cursor"</span><span class="token operator">:</span><span class="token string">"JGNLGEHJGIE"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"msg_list"</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"msgid"</span><span class="token operator">:</span><span class="token string">"xxxmsgid"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"sender"</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"woxxxxxmmgjiegjie"</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"receiver_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="code-line">                <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"woAAAAAAAAAAA"</span></span>
<span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"wmXXXXXXXXXXXXX"</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"chatid"</span><span class="token operator">:</span> <span class="token string">"wrXXXXXXXXXX"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"send_time"</span><span class="token operator">:</span><span class="token number">166666666</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"msgtype"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"service_encrypt_info"</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"encrypted_secret_key"</span><span class="token operator">:</span><span class="token string">"KEYAAAAAAABBBBBB"</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token property">"public_key_ver"</span><span class="token operator">:</span><span class="token number">1</span></span>
<span class="code-line">            <span class="token punctuation">}</span></span>
<span class="code-line">        <span class="token punctuation">}</span></span>
<span class="code-line">    <span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h4 id="%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B-3" data-sign="a5fbafd6d2e09f5b94bc1c89965e387f" data-lines="2"><a class="anchor" href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B-3"></a>获取回调数据能力</h4><p data-sign="d677345f7e391a27792f50065d290f8c" data-type="p" data-lines="1">ability_id：get_callback_data</p><blockquote data-sign="c35ae1d9b4559b0dc5980c0fb9c0e0e3_3" data-lines="3">开发者如果需要自定义获取回调数据的能力ID，直接修改Java程序示例的函数AppActiveCall的对应判断逻辑即可，能力ID不涉及其他逻辑<br>请求必须捎带notify id，用于在专区程序内唯一标识待查询的数据<br>Java程序示例处理该能力的逻辑：将存储的回调事件数据原样返回，所有回调事件使用同一个能力，回调事件介绍见：<a href="https://developer.work.weixin.qq.com/document/path/99992" rel="nofollow">专区程序接收事件通知</a><br>这里所有回调事件都要通过该能力返回企业应用，因此输出协议内需要注册所有回调事件中可能出现的字段</blockquote><p data-sign="586722e817ebb03544e13751dc2099ad" data-type="p" data-lines="1">输入协议：</p><div data-sign="1234ec74aacc607feb325e99e02b0f9b" data-type="codeBlock" data-lines="3">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="95c1e5212efea472d0fd070f4de7b756" data-type="p" data-lines="1">输出协议：</p><div data-sign="14179b37fd94fa436ca0a7c1c6006b88" data-type="codeBlock" data-lines="26">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token property">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"event_type"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"chat_archive_audit_approved"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"userid"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"external_userid"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"chatid"</span><span class="token operator">:</span><span class="token string">"xxx"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"conversation_new_message"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"zzzzzzzzzzz"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"hit_keyword"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"xxx"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"auth_knowledge_base"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"knowledge_base_id"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"knowledge_base_name"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"chat_archive_export_finished"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"jobid"</span><span class="token operator">:</span> <span class="token string">"xxx"</span></span>
<span class="code-line">	<span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="d1f24b11e2146b3f6c4d990d4d7ae665" data-type="p" data-lines="1">输出协议字段解析如下：</p><div class="cherry-table-container" data-sign="6cb32f2d7924863bd73ff4e93a3590b8" data-lines="11">
        <table class="cherry-table"><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td>errcode</td><td>demo内部错误的错误码，默认710660，未出错时没有该字段。企业可根据需要在专区程序内自定义错误码</td></tr><tr><td>errmsg</td><td>demo内部错误的错误说明，未出错时没有该字段</td></tr><tr><td>event_type</td><td>事件类型，各回调事件的共有字段</td></tr><tr><td>timestamp</td><td>时间戳，各回调事件的共有字段</td></tr><tr><td>chat_archive_audit_approved</td><td><a href="https://developer.work.weixin.qq.com/document/path/99993" rel="nofollow">客户同意进行聊天内容存档事件回调</a></td></tr><tr><td>conversation_new_message</td><td><a href="https://developer.work.weixin.qq.com/document/path/99994" rel="nofollow">产生会话回调通知</a></td></tr><tr><td>hit_keyword</td><td><a href="https://developer.work.weixin.qq.com/document/path/99995" rel="nofollow">命中关键词规则通知</a></td></tr><tr><td>auth_knowledge_base</td><td><a href="https://developer.work.weixin.qq.com/document/path/99996" rel="nofollow">知识集管理回调</a></td></tr><tr><td>chat_archive_export_finished</td><td><a href="https://developer.work.weixin.qq.com/document/path/99997" rel="nofollow">会话内容导出完成通知</a></td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><h3 id="specsdkinvoke%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E5%80%BC%E8%AF%B4%E6%98%8E" data-sign="568e57906523d6febb7b9d8926678db5" data-lines="1"><a class="anchor" href="#specsdkinvoke%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E5%80%BC%E8%AF%B4%E6%98%8E"></a>SpecSDK.invoke接口返回值说明</h3><div class="cherry-table-container" data-sign="3b3f5f3418ba7262e6bca102faa6eaf3" data-lines="11">
        <table class="cherry-table"><thead><tr><th>错误码</th><th>错误码说明</th><th>备注</th></tr></thead><tbody><tr><td>0</td><td>接口调用成功</td><td>-</td></tr><tr><td>-10001</td><td>sdk内部错误</td><td>非网络失败</td></tr><tr><td>-10002</td><td>sdk内部网络失败</td><td>连接失败或者读写超时等失败</td></tr><tr><td>-10003</td><td>sdk内部错误</td><td>非法的http status</td></tr><tr><td>-10004</td><td>sdk内部错误</td><td>签名不匹配</td></tr><tr><td>-10005</td><td>sdk内部错误</td><td>解密失败</td></tr><tr><td>-10006</td><td>sdk内部错误</td><td>不支持的api接口名称。请检查使用的sdk版本是不是低版本的</td></tr><tr><td>-10008</td><td>sdk内部错误</td><td>密钥版本不匹配。如果是调试模式，可能是access_token过期导致未正确返回</td></tr><tr><td>-10009</td><td>sdk内部错误</td><td>非法的json数据</td></tr></tbody></table></div><p data-sign="br3" data-type="br" data-lines="3">&nbsp;</p><h2 id="c" data-sign="15bb63c26492e5e4e08fbeb99bd5503b" data-lines="1"><a class="anchor" href="#c"></a>C++</h2><h3 id="%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE-4" data-sign="4d28839f4481d6a69d0109d9b15604b2" data-lines="2"><a class="anchor" href="#%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE-4"></a>启动配置</h3><div data-sign="30fba506b8d9e340948a0cc8bfa73499" data-type="codeBlock" data-lines="7">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">启动命令</span>
<span class="code-line"><span class="token operator">/</span>bin<span class="token operator">/</span>bash  <span class="token comment">// 绝对路径</span></span>
<span class="code-line">启动参数</span>
<span class="code-line"><span class="token operator">/</span>app<span class="token operator">/</span>run<span class="token punctuation">.</span>sh</span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="2fd2aa34f349bbc3a5568be313491478" data-type="p" data-lines="1"><img src="images/100052/e4b9f264.png" alt="enter image description here"></p><h3 id="%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE-4" data-sign="6320f4f49989572e4669088314db9296" data-lines="2"><a class="anchor" href="#%E7%A8%8B%E5%BA%8F%E8%83%BD%E5%8A%9B%E9%85%8D%E7%BD%AE-4"></a>程序能力配置</h3><p data-sign="e45c6d503d20159d63a2fb0e1c0ebcd5" data-type="p" data-lines="3">示例程序支持应用同步发起调用sdk接口以及获取回调到专区的数据。<br>如果要调用某个sdk接口，需要给程序添加对应sdk接口的能力。</p><blockquote data-sign="df89d6eef2fa9ef2ca077b51f58aa46f_2" data-lines="2">如果需要将c++程序示例直接部署到专区进行调试，程序能力的注册请参照如下内容，否则请求和响应可能无法通过专区通道的校验</blockquote><h4 id="%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B-4" data-sign="9a0d5bde4f83a50d1b7aeac1dfdb576a" data-lines="2"><a class="anchor" href="#%E6%B7%BB%E5%8A%A0%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B-4"></a>添加获取会话记录能力</h4><p data-sign="beb2e4d9b78b957ebc2b7d6b2ee376ca" data-type="p" data-lines="2">ability_id: invoke_sync_msg</p><blockquote data-sign="f4c26338d09357ed15acd58ced5bc78e_2" data-lines="2">ability_id格式：invoke_<span class="Cherry-InlineMath" data-type="mathBlock" data-lines="2">$API_NAME$</span><br>注意：C++程序示例对透传请求的处理逻辑为：<strong>将传入的能力ID截断“invoke_”前缀后，直接用于调用sdk。</strong>开发者如果需要自定义透传请求的能力ID，请额外添加自定义能力ID与sdk接口名的映射，并保证接口名合法</blockquote><p data-sign="414808c4b6ddcc99c5dca1bcbf9ef7a8" data-type="p" data-lines="2">输入协议：<br>注意：C++程序示例的默认输入协议中，request_data内无需包裹一层input对象</p><div data-sign="2c43b5bc967ae4e6c3b3f555c8d742aa" data-type="codeBlock" data-lines="7">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">  <span class="token property">"cursor"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> </span>
<span class="code-line">  <span class="token property">"limit"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">  <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">""</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="95c1e5212efea472d0fd070f4de7b756" data-type="p" data-lines="1">输出协议：</p><div data-sign="79794f75c15cdae4fabdd71942197cb1" data-type="codeBlock" data-lines="34">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"has_more"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"next_cursor"</span><span class="token operator">:</span><span class="token string">"JGNLGEHJGIE"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"msg_list"</span><span class="token operator">:</span><span class="token punctuation">[</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"msgid"</span><span class="token operator">:</span><span class="token string">"xxxmsgid"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"sender"</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"type"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"woxxxxxmmgjiegjie"</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"receiver_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="code-line">                <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"woAAAAAAAAAAA"</span></span>
<span class="code-line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token punctuation">{</span></span>
<span class="code-line">                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"wmXXXXXXXXXXXXX"</span></span>
<span class="code-line">                <span class="token punctuation">}</span></span>
<span class="code-line">            <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"chatid"</span><span class="token operator">:</span> <span class="token string">"wrXXXXXXXXXX"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"send_time"</span><span class="token operator">:</span><span class="token number">166666666</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"msgtype"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"service_encrypt_info"</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="code-line">                <span class="token property">"encrypted_secret_key"</span><span class="token operator">:</span><span class="token string">"KEYAAAAAAABBBBBB"</span><span class="token punctuation">,</span></span>
<span class="code-line">                <span class="token property">"public_key_ver"</span><span class="token operator">:</span><span class="token number">1</span></span>
<span class="code-line">            <span class="token punctuation">}</span></span>
<span class="code-line">        <span class="token punctuation">}</span></span>
<span class="code-line">    <span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h4 id="%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B-4" data-sign="41415bde987f8c0d2e8f25f094e82cc8" data-lines="2"><a class="anchor" href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E8%83%BD%E5%8A%9B-4"></a>获取回调数据能力</h4><p data-sign="d677345f7e391a27792f50065d290f8c" data-type="p" data-lines="1">ability_id：get_callback_data</p><blockquote data-sign="dee5cebd54270ec451bb76d072b79771_2" data-lines="2">请求必须捎带notify id，用于在专区程序内唯一标识待查询的数据<br>C++程序示例处理该能力的逻辑：将存储的回调事件数据原样返回，所有回调事件使用同一个能力，回调事件介绍见：<a href="https://developer.work.weixin.qq.com/document/path/99992" rel="nofollow">专区程序接收事件通知</a><br>这里所有回调事件都要通过该能力返回企业应用，因此输出协议内需要注册所有回调事件中可能出现的字段</blockquote><p data-sign="586722e817ebb03544e13751dc2099ad" data-type="p" data-lines="1">输入协议：</p><div data-sign="1234ec74aacc607feb325e99e02b0f9b" data-type="codeBlock" data-lines="3">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="95c1e5212efea472d0fd070f4de7b756" data-type="p" data-lines="1">输出协议：</p><div data-sign="14179b37fd94fa436ca0a7c1c6006b88" data-type="codeBlock" data-lines="26">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token property">"errcode"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"errmsg"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"event_type"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"chat_archive_audit_approved"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"userid"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"external_userid"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"chatid"</span><span class="token operator">:</span><span class="token string">"xxx"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"conversation_new_message"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"zzzzzzzzzzz"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"hit_keyword"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"xxx"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"auth_knowledge_base"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"knowledge_base_id"</span><span class="token operator">:</span> <span class="token string">"xxxxxxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"knowledge_base_name"</span><span class="token operator">:</span> <span class="token string">"zzzzz"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"chat_archive_export_finished"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"jobid"</span><span class="token operator">:</span> <span class="token string">"xxx"</span></span>
<span class="code-line">	<span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="d1f24b11e2146b3f6c4d990d4d7ae665" data-type="p" data-lines="1">输出协议字段解析如下：</p><div class="cherry-table-container" data-sign="6cb32f2d7924863bd73ff4e93a3590b8" data-lines="11">
        <table class="cherry-table"><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td>errcode</td><td>demo内部错误的错误码，默认710660，未出错时没有该字段。企业可根据需要在专区程序内自定义错误码</td></tr><tr><td>errmsg</td><td>demo内部错误的错误说明，未出错时没有该字段</td></tr><tr><td>event_type</td><td>事件类型，各回调事件的共有字段</td></tr><tr><td>timestamp</td><td>时间戳，各回调事件的共有字段</td></tr><tr><td>chat_archive_audit_approved</td><td><a href="https://developer.work.weixin.qq.com/document/path/99993" rel="nofollow">客户同意进行聊天内容存档事件回调</a></td></tr><tr><td>conversation_new_message</td><td><a href="https://developer.work.weixin.qq.com/document/path/99994" rel="nofollow">产生会话回调通知</a></td></tr><tr><td>hit_keyword</td><td><a href="https://developer.work.weixin.qq.com/document/path/99995" rel="nofollow">命中关键词规则通知</a></td></tr><tr><td>auth_knowledge_base</td><td><a href="https://developer.work.weixin.qq.com/document/path/99996" rel="nofollow">知识集管理回调</a></td></tr><tr><td>chat_archive_export_finished</td><td><a href="https://developer.work.weixin.qq.com/document/path/99997" rel="nofollow">会话内容导出完成通知</a></td></tr></tbody></table></div><h1 id="%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E7%A8%8B%E5%BA%8F" data-sign="9d7c17d025c0e6e852dc73885e0488a9" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E7%A8%8B%E5%BA%8F"></a>应用调用程序</h1><p data-sign="da88dc45c55132d4ef5975831ad3c1f4" data-type="p" data-lines="1">程序审核通过并且部署成功后，可使用授权了数据与智能专区权限的应用使用接口<a href="#53295" rel="nofollow">应用同步调用程序</a>。</p><h2 id="python-3" data-sign="ab8e4211226d73aca3e583bc1e09e22e" data-lines="2"><a class="anchor" href="#python-3"></a>Python</h2><h3 id="%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A" data-sign="197062ac65b77ff15d9e7718bee79bea" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A"></a>应用调用获取会话记录能力示例：</h3><div data-sign="d9ef1c89beb9670389051a96cebf4288" data-type="codeBlock" data-lines="8">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token string">"program_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"ability_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"request_data"</span><span class="token operator">:</span> <span class="token string">"{\"</span>input\<span class="token string">":{\"</span>func\<span class="token string">":\"</span>sync_msg\<span class="token string">",\"</span>func_req\<span class="token string">":{\"</span>cursor\<span class="token string">":\"</span><span class="token constant">RMTJID</span>\<span class="token string">",\"</span>token\<span class="token string">":\"</span><span class="token constant">NGEJKGOEGJKOEGNEOAGOEGOKEGHOEEEEE</span>\<span class="token string">",\"</span>limit\<span class="token string">":200}}}"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h3 id="%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A" data-sign="c18677be1508d889a35915ddac30b57c" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A"></a>应用获取回调数据示例：</h3><div data-sign="2890b482fa1c4ee39543069ad009d4cc" data-type="codeBlock" data-lines="8">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token string">"program_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"ability_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">	  <span class="token string">"notify_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"request_data"</span><span class="token operator">:</span> <span class="token string">"{\"</span>input\<span class="token string">":{\"</span>func\<span class="token string">":\"</span>do_async_job\<span class="token string">",\"</span>func_req\<span class="token string">":{\"</span>notify_id\<span class="token string">":\"</span><span class="token constant">NOTIFYID</span>\<span class="token string">"}}}"</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h2 id="java-3" data-sign="2efedaba77adb44a76de768900083bc3" data-lines="2"><a class="anchor" href="#java-3"></a>Java</h2><h3 id="%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A-3" data-sign="2af014d747a3d2cd52fb4169b8763517" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A-3"></a>应用调用获取会话记录能力示例：</h3><div data-sign="8d156de805a143571e28335b6b2137a0" data-type="codeBlock" data-lines="6">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">    <span class="token string">"program_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"ability_id"</span><span class="token operator">:</span> <span class="token string">"invoke_sync_msg"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"request_data"</span><span class="token operator">:</span> <span class="token string">"{\"</span>cursor\<span class="token string">":\"</span>xxx\<span class="token string">",\"</span>token\<span class="token string">":\"</span>xxx\<span class="token string">",\"</span>limit\<span class="token string">":200}"</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h3 id="%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A-3" data-sign="e50d8c79d85f87bd5fa81a5dc9572f2d" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A-3"></a>应用获取回调数据示例：</h3><div data-sign="7771551e39b958e5a2e01a8b43b0ca0e" data-type="codeBlock" data-lines="7">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">    <span class="token string">"program_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"ability_id"</span><span class="token operator">:</span> <span class="token string">"get_callback_data"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"notify_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"request_data"</span><span class="token operator">:</span> <span class="token string">"{}"</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h2 id="c-3" data-sign="edfbf41adce41d5699aef50ff68a3d36" data-lines="2"><a class="anchor" href="#c-3"></a>C++</h2><h3 id="%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A-4" data-sign="97198e17634db288daa5f898af42866e" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E8%83%BD%E5%8A%9B%E7%A4%BA%E4%BE%8B%EF%BC%9A-4"></a>应用调用获取会话记录能力示例：</h3><div data-sign="8d156de805a143571e28335b6b2137a0" data-type="codeBlock" data-lines="6">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">    <span class="token string">"program_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"ability_id"</span><span class="token operator">:</span> <span class="token string">"invoke_sync_msg"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"request_data"</span><span class="token operator">:</span> <span class="token string">"{\"</span>cursor\<span class="token string">":\"</span>xxx\<span class="token string">",\"</span>token\<span class="token string">":\"</span>xxx\<span class="token string">",\"</span>limit\<span class="token string">":200}"</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h3 id="%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A-4" data-sign="d4d55cb3d14575ecbb733992cec5d75f" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E5%9B%9E%E8%B0%83%E6%95%B0%E6%8D%AE%E7%A4%BA%E4%BE%8B%EF%BC%9A-4"></a>应用获取回调数据示例：</h3><div data-sign="7771551e39b958e5a2e01a8b43b0ca0e" data-type="codeBlock" data-lines="7">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">    <span class="token string">"program_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"ability_id"</span><span class="token operator">:</span> <span class="token string">"get_callback_data"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"notify_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token string">"request_data"</span><span class="token operator">:</span> <span class="token string">"{}"</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><h1 id="%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E7%9A%84%E6%B5%81%E7%A8%8B%E7%A4%BA%E4%BE%8B" data-sign="4b356a19ea580dbd91869cba872f6d0e" data-lines="2"><a class="anchor" href="#%E5%BA%94%E7%94%A8%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E8%AE%B0%E5%BD%95%E7%9A%84%E6%B5%81%E7%A8%8B%E7%A4%BA%E4%BE%8B"></a>应用获取会话记录的流程示例</h1><blockquote data-sign="cc7e0c754b76a3c3c486dc956e5b9f84_2" data-lines="2">背景：企业已产生新的会话事件，应用需要获取会话记录，并且请求需要捎带token以避免频率限制</blockquote><ol data-sign="ee2426c56b61f6544c18a68b0a99eed0list15" data-lines="15" class="cherry-list__default" start="1"><li>企业产生新的会话事件后（下图1.1），企微专区后台会产生会话回调通知专区程序（下图1.2），回调中包含用于获取会话记录的token<ul class="cherry-list__default"><li>详见：<a href="https://developer.work.weixin.qq.com/document/53357" rel="nofollow">产生会话回调通知</a><br></li></ul></li><li>专区程序接收回调后，需要企业应用来拉取数据时，调用spec_notify_app通知企业应用（下图2.1），这里会给专区程序返回一份notify id，并向企业应用的回调地址发送一份包含<strong>相同的notify id</strong>的回调（下图2.2），专区程序需要将该notify id和待应用查询的数据作关联<ul class="cherry-list__default"><li>详见：<a href="https://developer.work.weixin.qq.com/document/53408" rel="nofollow">专区通知应用</a><br></li></ul></li><li>应用收到企微专区通道的回调后（下图2.2），请求专区程序（下图3.1），获取专区程序暂存的token<ul class="cherry-list__default"><li>请求的ability id为get_callback_data</li><li>请求需要捎带notify id</li><li>请求为同步调用<br></li></ul></li><li>应用拿到token后，可调用专区程序获取会话记录<ul class="cherry-list__default"><li>请求的ability id为invoke_sync_msg</li><li>请求的request_data中捎带token</li><li>详见：<a href="https://developer.work.weixin.qq.com/document/53341" rel="nofollow">获取会话记录</a></li></ul></li></ol><p data-sign="3024f3f0cfe67550676cc2963d191aea" data-type="p" data-lines="2">上述流程可参照下图理解：<br><img src="images/100052/5accfad8.png" alt="企业应用获取会话记录流程图"></p></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>