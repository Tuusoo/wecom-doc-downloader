<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>客服工具栏接口 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        客服工具栏接口
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2023/07/14</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><dir class="toc" data-sign="ce01473131f1205f93ff51b1b9d51fe8-1" data-lines="1"><p class="toc-title">目录</p><li class="toc-li"><a href="#%E6%A6%82%E8%BF%B0" class="level-2">概述</a></li><li class="toc-li"><a href="#%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E" class="level-2">接口说明</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getcontext" class="level-3">getContext</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%AE%A2%E6%88%B7userid" class="level-3">获取当前客户userid</a></li><li class="toc-li">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#%E5%88%86%E4%BA%AB%E6%B6%88%E6%81%AF%E5%88%B0%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D" class="level-3">分享消息到当前会话</a></li></dir><h2 id="%E6%A6%82%E8%BF%B0" data-sign="9a8437ccee43ad66c084b8dfd3d259d3" data-lines="2"><a class="anchor" href="#%E6%A6%82%E8%BF%B0"></a>概述</h2><p data-sign="683542717b82e3d683ccdb0b24b0ed26" data-type="p" data-lines="2">企业可将应用页面配置到客服工具栏，方便接待人员在与微信用户的客服聊天中查看和使用，提高服务效率。从客服工具栏打开的页面，除了一般的小程序接口之外，可以使用有会话属性的接口，例如：获取当前客户userid、分享消息到当前会话。当然，开发者首先需要调用getContext接口获取当前入口entry值，以此判断是否从客服工具栏进入页面。</p><h2 id="%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E" data-sign="3ee63dd18c817dfdbd95d92975b82eab" data-lines="2"><a class="anchor" href="#%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E"></a>接口说明</h2><h3 id="getcontext" data-sign="3d28d5e69c85aba8b79697c8c0683830" data-lines="2"><a class="anchor" href="#getcontext"></a>getContext</h3><p data-sign="8724acc3b5b88ee66d224a52743d66f9" data-type="p" data-lines="2">接口使用说明详见“<a href="#21951" rel="nofollow">wx.qy.getContext</a>”，在客服工具栏里返回的entry值是single_kf_tools，具体如下：</p><p data-sign="cc4a2fd4bedea2795ecb872a9d95dd67" data-type="p" data-lines="2">返回结果 <strong>entry</strong> 说明</p><div class="cherry-table-container" data-sign="26ea9a2f63c7a05008ec93c13d883055" data-lines="8">
        <table class="cherry-table"><thead><tr><th>值</th><th>说明</th><th>支持的最低版本</th></tr></thead><tbody><tr><td>contact_profile</td><td>从联系人详情进入</td><td>3.0.24</td></tr><tr><td>single_chat_tools</td><td>从单聊会话的工具栏进入</td><td>3.0.24</td></tr><tr><td>group_chat_tools</td><td>从群聊会话的工具栏进入</td><td>3.0.24</td></tr><tr><td>chat_attachment</td><td>从会话的聊天附件栏进入</td><td>3.1.6</td></tr><tr><td><strong>single_kf_tools</strong></td><td><strong>从微信客服的工具栏进入</strong></td><td>3.1.10</td></tr><tr><td>normal</td><td>除以上场景之外进入，例如工作台，聊天会话等</td><td>3.0.24</td></tr></tbody></table></div><h3 id="%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%AE%A2%E6%88%B7userid" data-sign="a061310107ab766416aa79a131984ea8" data-lines="2"><a class="anchor" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%AE%A2%E6%88%B7userid"></a>获取当前客户userid</h3><p data-sign="bd9b21fc6623b29fc886b1b79f6c9e20" data-type="p" data-lines="2">接口使用说明详见“<a href="#16065" rel="nofollow">wx.qy.getCurExternalContact</a>”，在客服工具栏里调用该接口，自建应用与第三方应用所需的权限有所不同，具体如下：</p><div class="cherry-table-container" data-sign="23a0ede606bc22a3f7023766e422107a" data-lines="3">
        <table class="cherry-table"><thead><tr><th>入口</th><th>[getContext](#getContext)的entry值</th><th>自建应用</th><th>第三方应用</th><th>用户</th><th>支持的最低版本</th></tr></thead><tbody><tr><td>微信客服工具栏</td><td>single_kf_tools</td><td>所有</td><td>需有“微信客服权限-&gt;获取基础信息”权限</td><td>所有</td><td>3.1.10</td></tr></tbody></table></div><h3 id="%E5%88%86%E4%BA%AB%E6%B6%88%E6%81%AF%E5%88%B0%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D" data-sign="8c0ec29aa4e7c5e97275939c92c299f3" data-lines="2"><a class="anchor" href="#%E5%88%86%E4%BA%AB%E6%B6%88%E6%81%AF%E5%88%B0%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D"></a>分享消息到当前会话</h3><p data-sign="c319bf6e3e6ff90421533b933f5397a5" data-type="p" data-lines="2">接口使用说明详见“<a href="#21264" rel="nofollow">wx.qy.sendChatMessage</a>”，在客服工具栏里调用该接口，自建应用与第三方应用所需的权限有所不同，具体如下：</p><div class="cherry-table-container" data-sign="23a0ede606bc22a3f7023766e422107a" data-lines="3">
        <table class="cherry-table"><thead><tr><th>入口</th><th>[getContext](#getContext)的entry值</th><th>自建应用</th><th>第三方应用</th><th>用户</th><th>支持的最低版本</th></tr></thead><tbody><tr><td>微信客服工具栏</td><td>single_kf_tools</td><td>所有</td><td>需有“微信客服权限-&gt;获取基础信息”权限</td><td>所有</td><td>3.1.10</td></tr></tbody></table></div><p data-sign="a77cdd590595d283d2e6fb53b5e19ee4" data-type="p" data-lines="1">微信客服工具栏额外支持<code>msgmenu</code>和<code>channels_shop_product</code>的消息类型，具体如下：</p><blockquote data-sign="2cd0599d221d1cbb069dd89070a3d206_2" data-lines="2"><code>msgmenu</code>移动端ios/android从 3.1.12 版本开始支持；桌面端win从  3.1.20 版本开始支持，mac暂不支持<br><code>channels_shop_product</code>从 4.1.6 版本开始支持，四端均支持，参数可通过<a href="https://developers.weixin.qq.com/doc/channels/API/product/get" rel="nofollow">获取商品接口</a>和<a href="https://developers.weixin.qq.com/doc/channels/API/basics/getbasicinfo" rel="nofollow">获取店铺基本信息接口</a>获取<br>需要从客服工具栏进入页面才可调用，否则会报错：unsupported msgtype，可先通过调用“<a href="#21951" rel="nofollow">wx.qy.getContext</a>”来判断进入小程序的入口。</blockquote><p data-sign="21f2fa80eb8f025c07495bc38851fbab" data-type="p" data-lines="2">参数说明</p><div class="cherry-table-container" data-sign="100e4141a52490816925a3ace058e980" data-lines="30">
        <table class="cherry-table"><thead><tr><th>参数名</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>msgtype</td><td>string</td><td>是</td><td>消息类型</td></tr><tr><td>enterChat</td><td>Boolean</td><td>否</td><td>为true时表示发送完成之后顺便进入会话，默认为false，仅移动端3.1.10及以上版本支持该字段</td></tr><tr><td>msgmenu</td><td>Object</td><td>否</td><td>菜单消息</td></tr><tr><td>msgmenu::head_content</td><td>string</td><td>否</td><td>起始文本<br>不多于1024字节</td></tr><tr><td>msgmenu::list</td><td>Object</td><td>否</td><td>菜单项配置列表</td></tr><tr><td>msgmenu::list::type</td><td>string</td><td>是</td><td>菜单类型。<br><code>click</code>-回复菜单 <code>view</code>-超链接菜单 <code>miniprogram</code>-小程序菜单</td></tr><tr><td>msgmenu::list::click</td><td>Object</td><td>否</td><td>type为<code>click</code>的菜单项</td></tr><tr><td>msgmenu::list::click::id</td><td>string</td><td>否</td><td>菜单ID<br>不少于1字节<br>不多于64字节</td></tr><tr><td>msgmenu::list::click::content</td><td>string</td><td>是</td><td>菜单显示内容<br>不少于1字节<br>不多于128字节</td></tr><tr><td>msgmenu::list::view</td><td>Object</td><td>否</td><td>type为<code>view</code>的菜单项</td></tr><tr><td>msgmenu::list::view::url</td><td>string</td><td>是</td><td>点击后跳转的链接<br>不少于1字节<br>不多于2048字节</td></tr><tr><td>msgmenu::list::view::content</td><td>string</td><td>是</td><td>菜单显示内容<br>不少于1字节<br>不多于1024字节</td></tr><tr><td>msgmenu::list.miniprogram</td><td>Object</td><td>否</td><td>type为<code>miniprogram</code>的菜单项</td></tr><tr><td>msgmenu::list.miniprogram::appid</td><td>string</td><td>是</td><td>小程序appid，必须是当前聊天工具栏打开的小程序<br>不少于1字节<br>不多于32字节</td></tr><tr><td>msgmenu::list.miniprogram::page</td><td>string</td><td>是</td><td>小程序打开后的路径，注意要以.html作为后缀，否则在微信端打开会提示找不到页面<br>不少于1字节<br>不多于1024字节</td></tr><tr><td>msgmenu::list.miniprogram::content</td><td>string</td><td>是</td><td>菜单显示内容<br>不少于1字节<br>不多于1024字节</td></tr><tr><td>msgmenu::tail_content</td><td>string</td><td>否</td><td>结束文本<br>不多于1024字节</td></tr><tr><td>channelsShopProduct</td><td>Object</td><td>否</td><td>视频号商品消息</td></tr><tr><td>channelsShopProduct::productId</td><td>string</td><td>是</td><td>商品ID</td></tr><tr><td>channelsShopProduct::shopAppId</td><td>string</td><td>是</td><td>小店ID</td></tr><tr><td>channelsShopProduct::imgUrl</td><td>string</td><td>是</td><td>商品图像，<a href="https://developers.weixin.qq.com/doc/channels/API/product/get" rel="nofollow">获取商品接口</a>中<code>head_imgs</code>数组中的第一张图片</td></tr><tr><td>channelsShopProduct::title</td><td>string</td><td>是</td><td>商品名，可通过<a href="https://developers.weixin.qq.com/doc/channels/API/product/get" rel="nofollow">获取商品接口</a>获取</td></tr><tr><td>channelsShopProduct::sellingPrice</td><td>string</td><td>是</td><td>价格区间最小值(单位分)，<a href="https://developers.weixin.qq.com/doc/channels/API/product/get" rel="nofollow">获取商品接口</a>中的商品 SKU 最小价格</td></tr><tr><td>channelsShopProduct::shopImgUrl</td><td>string</td><td>是</td><td>视频号店铺头像URL，可通过<a href="https://developers.weixin.qq.com/doc/channels/API/basics/getbasicinfo" rel="nofollow">获取店铺基本信息接口</a>获取</td></tr><tr><td>channelsShopProduct::shopNickname</td><td>string</td><td>是</td><td>视频号店铺名称，可通过<a href="https://developers.weixin.qq.com/doc/channels/API/basics/getbasicinfo" rel="nofollow">获取店铺基本信息接口</a>获取</td></tr><tr><td>success</td><td>Function</td><td>否</td><td>群发成功的回调函数</td></tr><tr><td>fail</td><td>Function</td><td>否</td><td>群发失败的回调函数</td></tr><tr><td>complete</td><td>Function</td><td>否</td><td>调用结束的回调函数（群发成功、失败都会执行）</td></tr></tbody></table></div><p data-sign="34577a279eb756c0aadfac2f519f5adc" data-type="p" data-lines="1">示例代码</p><div data-sign="ef140734e594c1f6d46c3aa1ed730a3c" data-type="codeBlock" data-lines="51">
      <pre class="language-javascript"><code class="language-javascript wrap"><span class="code-line">wx<span class="token punctuation">.</span>qy<span class="token punctuation">.</span><span class="token function">sendChatMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="code-line">    msgtype<span class="token operator">:</span><span class="token string">"msgmenu"</span><span class="token punctuation">,</span> <span class="token comment">//消息类型，必填</span></span>
<span class="code-line">	enterChat<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//为true时表示发送完成之后顺便进入会话，默认为false，仅移动端3.1.10及以上版本支持该字段</span></span>
<span class="code-line">	msgmenu<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        head_content<span class="token operator">:</span> <span class="token string">"您对本次服务是否满意呢? "</span><span class="token punctuation">,</span> <span class="token comment">// 起始文本</span></span>
<span class="code-line">        list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token comment">// 菜单项配置列表</span></span>
<span class="code-line">            type<span class="token operator">:</span> <span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token comment">// type 为 click 的菜单项</span></span>
<span class="code-line">            click<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                id<span class="token operator">:</span> <span class="token string">"101"</span><span class="token punctuation">,</span> <span class="token comment">// 菜单ID</span></span>
<span class="code-line">                content<span class="token operator">:</span> <span class="token string">"满意"</span><span class="token punctuation">,</span> <span class="token comment">// 菜单显示内容</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            type<span class="token operator">:</span> <span class="token string">"click"</span><span class="token punctuation">,</span></span>
<span class="code-line">            click<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                id<span class="token operator">:</span> <span class="token string">"102"</span><span class="token punctuation">,</span></span>
<span class="code-line">                content<span class="token operator">:</span> <span class="token string">"不满意"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            type<span class="token operator">:</span> <span class="token string">"view"</span><span class="token punctuation">,</span> <span class="token comment">// type 为 view 的菜单项</span></span>
<span class="code-line">            view<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                url<span class="token operator">:</span> <span class="token string">"https://work.weixin.qq.com"</span><span class="token punctuation">,</span> <span class="token comment">// 点击后跳转的链接</span></span>
<span class="code-line">                content<span class="token operator">:</span> <span class="token string">"点击跳转到自助查询页面"</span><span class="token punctuation">,</span> <span class="token comment">// 菜单显示内容</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            type<span class="token operator">:</span> <span class="token string">"miniprogram"</span><span class="token punctuation">,</span> <span class="token comment">// type 为 miniprogram 的菜单项</span></span>
<span class="code-line">            miniprogram<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">                appid<span class="token operator">:</span> <span class="token string">"wx123123123123123"</span><span class="token punctuation">,</span> <span class="token comment">//小程序的appid</span></span>
<span class="code-line">                page<span class="token operator">:</span> <span class="token string">"pages/index?userid=zhangsan&amp;orderid=123123123"</span><span class="token punctuation">,</span> <span class="token comment">//小程序消息打开后的路径</span></span>
<span class="code-line">                content<span class="token operator">:</span> <span class="token string">"点击打开小程序查询更多"</span><span class="token punctuation">,</span> <span class="token comment">// 小程序消息的title</span></span>
<span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">        tail_content<span class="token operator">:</span> <span class="token string">"欢迎再次光临"</span><span class="token punctuation">,</span> <span class="token comment">// 结束文本</span></span>
<span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	channelsShopProduct<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">        productId<span class="token operator">:</span> <span class="token string">"10000000000000"</span><span class="token punctuation">,</span> <span class="token comment">// 商品ID</span></span>
<span class="code-line">        shopAppId<span class="token operator">:</span> <span class="token string">"wx123123123123123"</span><span class="token punctuation">,</span> <span class="token comment">// 小店ID</span></span>
<span class="code-line">        imgUrl<span class="token operator">:</span> <span class="token string">"https://mmecimage.cn/p/xxxxxx"</span><span class="token comment">// 商品图像</span></span>
<span class="code-line">        title<span class="token operator">:</span> <span class="token string">"aaaaa"</span> <span class="token comment">// 商品名</span></span>
<span class="code-line">        sellingPrice<span class="token operator">:</span> <span class="token string">"800"</span> <span class="token comment">// 价格区间最小值(单位分) (销售价)</span></span>
<span class="code-line">        shopImgUrl<span class="token operator">:</span> <span class="token string">"http://mmbiz.qpic.cn/mmbiz_jpg/xxxx"</span> <span class="token comment">// 视频号店铺头像URL</span></span>
<span class="code-line">        shopNickname<span class="token operator">:</span> <span class="token string">"名称"</span> <span class="token comment">// 视频号店铺名称</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="code-line">         <span class="token comment">//todo:</span></span>
<span class="code-line">    <span class="token punctuation">}</span></span>
<span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>