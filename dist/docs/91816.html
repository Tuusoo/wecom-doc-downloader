<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>批量获取审批单号 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        批量获取审批单号
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2024/07/05</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><p data-sign="fcefa914efcdf0e3395b7d653ebdf41d" data-type="p" data-lines="2">通过本接口可以获取企业一段时间内企业微信“审批应用”单据的审批编号，支持按模板类型、申请人、部门、申请单审批状态等条件筛选。<br>自建应用调用此接口，需在“管理后台-应用管理-审批-API-审批数据权限”中，授权应用允许提交审批单据。</p><p data-sign="f2fc1469540afc40439c73dead0ff748" data-type="p" data-lines="2">一次拉取调用最多拉取100个审批记录，可以通过多次拉取的方式来满足需求，但调用频率不可超过600次/分。</p><blockquote data-sign="0a1b32e92ecd79de06979959ab04c712_2" data-lines="2">推荐使用此接口获取审批数据，旧接口后续将不再维护。</blockquote><p data-sign="833f3c49c4ea45c46e97577abf56b37f" data-type="p" data-lines="3"><strong>请求方式：</strong>POST（<strong>HTTPS</strong>）<br><strong>请求地址：</strong>https://qyapi.weixin.qq.com/cgi-bin/oa/getapprovalinfo?access_token=ACCESS_TOKEN</p><p data-sign="0eaf88df03cd3784619d00af1ca68a35" data-type="p" data-lines="2"><strong>请求示例：</strong></p><div data-sign="23fcbd60dabef89033f96c6cbec01082" data-type="codeBlock" data-lines="27">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"starttime"</span> <span class="token operator">:</span> <span class="token string">"1569546000"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"endtime"</span> <span class="token operator">:</span> <span class="token string">"1569718800"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"new_cursor"</span> <span class="token operator">:</span> <span class="token string">""</span> <span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"size"</span> <span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"filters"</span> <span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"template_id"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"ZLqk8pcsAoaXZ1eY56vpAgfX28MPdYU3ayMaSPHaaa"</span></span>
<span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token string">"creator"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token string">"WuJunJie"</span></span>
<span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token string">"department"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token string">"1"</span></span>
<span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span>       </span>
<span class="code-line">        <span class="token punctuation">{</span></span>
<span class="code-line">            <span class="token property">"key"</span> <span class="token operator">:</span> <span class="token string">"sp_status"</span><span class="token punctuation">,</span></span>
<span class="code-line">            <span class="token property">"value"</span> <span class="token operator">:</span> <span class="token string">"1"</span></span>
<span class="code-line">        <span class="token punctuation">}</span>     </span>
<span class="code-line">    <span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="5f00dba9c2894001d62ef8a29a80b07a" data-lines="10">
        <table class="cherry-table"><thead><tr><th>参数</th><th>必须</th><th>说明</th></tr></thead><tbody><tr><td>access_token</td><td>是</td><td>调用接口凭证。必须使用审批应用或企业内自建应用的secret获取，获取方式参考：<a href="https://work.weixin.qq.com/api/doc#90000/90135/91039" rel="nofollow" title="文档">文档-获取access_token</a></td></tr><tr><td>starttime</td><td>是</td><td>审批单提交的时间范围，开始时间，UNix时间戳</td></tr><tr><td>endtime</td><td>是</td><td>审批单提交的时间范围，结束时间，Unix时间戳</td></tr><tr><td>new_cursor</td><td>是</td><td>分页查询游标，默认为空串，后续使用返回的new_next_cursor进行分页拉取</td></tr><tr><td>size</td><td>是</td><td>一次请求拉取审批单数量，默认值为100，上限值为100。若accesstoken为自建应用，仅允许获取在应用可见范围内申请人提交的表单，返回的sp_no_list个数可能和size不一致，开发者需用next_cursor判断表单记录是否拉取完</td></tr><tr><td>filters</td><td>否</td><td>筛选条件，可对批量拉取的审批申请设置约束条件，支持设置多个条件</td></tr><tr><td>└ key</td><td>否</td><td>筛选类型，包括：<br>template_id - 模板类型/模板id；<br>creator - 申请人；<br>department - 审批单提单者所在部门；<br>sp_status - 审批状态;<br>record_type - 审批单类型属性，1-请假；2-打卡补卡；3-出差；4-外出；5-加班； 6- 调班；7-会议室预定；8-退款审批；9-红包报销审批<br><br>注意:<br>1、仅“部门”支持同时配置多个筛选条件。<br>2、不同类型的筛选条件之间为“与”的关系，同类型筛选条件之间为“或”的关系 <br> 3、record_type筛选类型仅支持2021/05/31以后新提交的审批单，历史单不支持表单类型属性过滤</td></tr><tr><td>└ value</td><td>否</td><td>筛选值，对应为：template_id-模板id；creator-申请人userid ；department-所在部门id；sp_status-审批单状态（1-审批中；2-已通过；3-已驳回；4-已撤销；6-通过后撤销；7-已删除；10-已支付）</td></tr></tbody></table></div><blockquote data-sign="be154ea1d94bf381fe2268fec5950774_2" data-lines="2">1 接口频率限制 600次/分钟<br>2 请求的参数endtime需要大于startime， 起始时间跨度不能超过31天；<br>3 老的分页游标字段cursor和next_cursor待废弃，请开发者使用新字段new_cursor和new_next_cursor。</blockquote><p data-sign="be69a8d80807fc12104a6f71258f88a9" data-type="p" data-lines="1"><strong>权限说明：</strong></p><div class="cherry-table-container" data-sign="9ea60c837b32040556e2114d37955696" data-lines="5">
        <table class="cherry-table"><thead><tr><th>应用类型</th><th>权限要求</th></tr></thead><tbody><tr><td>自建应用</td><td>配置到「<a href="#17893/%E9%85%8D%E7%BD%AE%E5%8F%AF%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%BA%94%E7%94%A8" rel="nofollow">审批 - 可调用接口的应用</a>」中</td></tr><tr><td>代开发应用</td><td>具有「审批」权限</td></tr><tr><td>第三方应用</td><td>具有「审批」权限</td></tr></tbody></table></div><p data-sign="4500ae644890b2a3e6568b5481167358" data-type="p" data-lines="2"><em>注：</em> 从2023年12月1日0点起，不再支持通过系统应用secret调用接口，存量企业暂不受影响 <a href="https://developer.work.weixin.qq.com/document/51165" rel="nofollow">查看详情</a></p><hr data-sign="hr2" data-lines="2"><p data-sign="0b789d7580f376b3feaff0d57431f7b7" data-type="p" data-lines="2"><strong>返回结果 ：</strong></p><div data-sign="cad7478ab94aa24d51bb63b7650f53c7" data-type="codeBlock" data-lines="12">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">    <span class="token property">"errcode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"errmsg"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">    <span class="token property">"sp_no_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="code-line">        <span class="token string">"201909270001"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token string">"201909270002"</span><span class="token punctuation">,</span></span>
<span class="code-line">        <span class="token string">"201909270003"</span></span>
<span class="code-line">    <span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="f2e21495051cadd2d5b0f8a3eedbae8d" data-type="p" data-lines="2"><strong>参数说明：</strong></p><div class="cherry-table-container" data-sign="178a4c77749ebf941fb86dd88d6fc454" data-lines="4">
        <table class="cherry-table"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>sp_no_list</td><td>审批单号列表，包含满足条件的审批申请</td></tr><tr><td>new_next_cursor</td><td>后续请求查询的游标，当返回结果没有该字段时表示审批单已经拉取完</td></tr></tbody></table></div><hr data-sign="hr2" data-lines="2"><p data-sign="0be5475ec20788fd60322d08598315a7" data-type="p" data-lines="2"><strong>错误说明：</strong></p><div data-sign="1a29229609070672ab2605f30de48bc9" data-lines="6" class="cherry-table-container">
        <table class="cherry-table"><thead><tr><th>错误码</th><th>说明</th></tr></thead><tbody><tr><td>301055</td><td>无审批应用数据拉取权限</td></tr><tr><td>301025</td><td>请求参数错误</td></tr><tr><td>301026</td><td>批量拉取审批单内部接口失败</td></tr><tr><td>301112</td><td>请缩小查询时间范围重试</td></tr></tbody></table></div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>