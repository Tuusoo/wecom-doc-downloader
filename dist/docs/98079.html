<!DOCTYPE html><html lang="zh-CN"><head>
                <meta charset="UTF-8">
                <title>文件防泄漏 - 文档 - 企业微信开发者中心</title>
                <link rel="stylesheet" href="../doc-style.css">
                </head>
                <body>
                <div id="js-ep-doc-cnt" class="ep-doc-area-cnt">
    <div class="ep-doc-area-top" id="js-ep-doc-cnt-title">
      <div class="ep-doc-area-title">
        文件防泄漏
      </div>
      <div class="ep-doc-area-subtitle">最后更新：2025/07/03</div>
    </div>
    <div class="ep-doc-area-cherry cherry-markdown cherry-wecom" id="js-ep-doc-cnt-md"><div data-inline-code-theme="red" data-code-block-theme="coy"><p data-sign="84038c2bca247f4c4ecd1e35005d0924" data-type="p" data-lines="1">启用了 “文件防泄漏”的企业可以通过本接口查询文件上传、下载、转发等操作记录。</p><p data-sign="fede650e14b520aafaa3775c50c4d957" data-type="p" data-lines="3"><strong>请求方式</strong>：POST（<strong>HTTPS</strong>）<br><strong>请求地址</strong>:  https://qyapi.weixin.qq.com/cgi-bin/security/get_file_oper_record?access_token=ACCESS_TOKEN  </p><p data-sign="8a9affe8c49f861be4739ea1170e480a" data-type="p" data-lines="1"><strong>请求包体</strong></p><div data-sign="46b75d3a908e9567ccc6464ef490ce9b" data-type="codeBlock" data-lines="13">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token property">"start_time"</span><span class="token operator">:</span> <span class="token number">166666666</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"end_time"</span><span class="token operator">:</span> <span class="token number">166666667</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"userid_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token string">"lisi"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"operation"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">103</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"source"</span><span class="token operator">:</span><span class="token number">401</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"cursor"</span><span class="token operator">:</span><span class="token string">"ngLgjieajgieo"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"limit"</span><span class="token operator">:</span><span class="token number">100</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="54d2f7abd4f226094d9bdd35b3129b56" data-type="p" data-lines="2"><strong>参数说明</strong></p><div class="cherry-table-container" data-sign="5774bae4830c7e8e402a871456a09409" data-lines="9">
        <table class="cherry-table"><thead><tr><th>参数</th><th>类型</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>access_token</td><td>string</td><td>是</td><td>应用调用凭证</td></tr><tr><td>start_time</td><td>int</td><td>是</td><td>开始时间</td></tr><tr><td>end_time</td><td>int</td><td>是</td><td>结束时间，开始时间到结束时间的范围不能超过14天</td></tr><tr><td>userid_list</td><td>array</td><td>否</td><td>需要查询的文件操作者的userid，单次最多可以传<code>100</code>个用户</td></tr><tr><td>operation</td><td>object</td><td>否</td><td>参考<a href="#Operation%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E" rel="nofollow">Operation结构说明</a></td></tr><tr><td>cursor</td><td>string</td><td>否</td><td>由企业微信后台返回，第一次调用可不填</td></tr><tr><td>limit</td><td>int</td><td>否</td><td>限制返回的条数，最多设置为<code>1000</code></td></tr></tbody></table></div><p data-sign="br2" data-type="br" data-lines="2">&nbsp;</p><p data-sign="fe4e545aa2587fc077ce6344ae2953af" data-type="p" data-lines="1"><strong>调用说明</strong></p><ul data-sign="4060de70281bc2d245df040e4cfcc5e3list1" data-lines="1" class="cherry-list__default"><li>调用的应用需要满足如下的权限：</li></ul><div class="cherry-table-container" data-sign="62f105bb1432df2f5f568cc41b8daa73" data-lines="5">
        <table class="cherry-table"><thead><tr><th>应用类型</th><th>权限要求</th></tr></thead><tbody><tr><td>自建应用</td><td>配置到「<span style="color:#ff0000">文件防泄漏 - 可调用接口的应用</span>」中</td></tr><tr><td>代开发应用</td><td>暂不支持</td></tr><tr><td>第三方应用</td><td>暂不支持</td></tr></tbody></table></div><p data-sign="0d9e8df569fd1af08e5af1a04c3f7f01" data-type="p" data-lines="1"> <em>注：</em> 从2023年12月1日0点起，不再支持通过系统应用secret调用接口，存量企业暂不受影响 <a href="https://developer.work.weixin.qq.com/document/51165" rel="nofollow">查看详情</a></p><ul data-sign="1ec736c2882585204b4d6adcaab2a56clist2" data-lines="2" class="cherry-list__default"><li>已产生的操作记录将永久保存</li><li><code>应用可见范围外用户相关的数据会被过滤掉，不会返回</code></li></ul><p data-sign="6394de01a40b78c07ec7af6eaecac7f9" data-type="p" data-lines="1"><strong>返回示例</strong></p><div data-sign="71c74cab307f98c925ef8396bc807b2f" data-type="codeBlock" data-lines="42">
      <pre class="language-json"><code class="language-json wrap"><span class="code-line"><span class="token punctuation">{</span></span>
<span class="code-line">	<span class="token property">"errcode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"errmsg"</span><span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"has_more"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"next_cursor"</span><span class="token operator">:</span> <span class="token string">"gejMjgLjgeigoejg"</span><span class="token punctuation">,</span></span>
<span class="code-line">	<span class="token property">"record_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"time"</span><span class="token operator">:</span> <span class="token number">16666666666</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"userid"</span><span class="token operator">:</span> <span class="token string">"zhangsan"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"operation"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">101</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token property">"source"</span><span class="token operator">:</span> <span class="token number">401</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"file_info"</span><span class="token operator">:</span> <span class="token string">"1234567890.jpg"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"file_size"</span><span class="token operator">:</span><span class="token number">405842</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"file_md5"</span><span class="token operator">:</span><span class="token string">"gmgi32jginniboamgoge"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"time"</span><span class="token operator">:</span> <span class="token number">16666666666</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"external_user"</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token property">"type"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"xxx"</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token property">"corp_name"</span><span class="token operator">:</span><span class="token string">"十分科技"</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"operation"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">10001</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"file_info"</span><span class="token operator">:</span> <span class="token string">"通过zhangsan的链接下载了1234567890.jpg"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"applicant_name"</span><span class="token operator">:</span><span class="token string">"张三"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="code-line">		<span class="token property">"time"</span><span class="token operator">:</span> <span class="token number">16666666666</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"userid"</span><span class="token operator">:</span><span class="token string">"lisi"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"operation"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="code-line">			<span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">103</span><span class="token punctuation">,</span></span>
<span class="code-line">			<span class="token property">"source"</span><span class="token operator">:</span><span class="token number">401</span></span>
<span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"file_info"</span><span class="token operator">:</span> <span class="token string">"通过zhangsan的链接下载了1234567890.jpg"</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"device_type"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="code-line">		<span class="token property">"device_code"</span><span class="token operator">:</span><span class="token string">"owM2ovo"</span></span>
<span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="code-line"><span class="token punctuation">}</span></span></code><div class="codeCopyBtn"></div><div class="codeCopyBtn_tips">点击复制</div></pre>
    </div><p data-sign="54d2f7abd4f226094d9bdd35b3129b56" data-type="p" data-lines="1"><strong>参数说明</strong></p><div class="cherry-table-container" data-sign="e87e86935d857a890be29acb0d04eaf3" data-lines="16">
        <table class="cherry-table"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>errcode</td><td>int32</td><td>错误码</td></tr><tr><td>errmsg</td><td>string</td><td>错误码说明</td></tr><tr><td>has_more</td><td>bool</td><td>是否还有更多数据</td></tr><tr><td>next_cursor</td><td>string</td><td>仅has_more值为true时返回该字段，下一次调用将该值填到cursor字段，以实现分页查询</td></tr><tr><td>record_list.time</td><td>int</td><td>操作时间</td></tr><tr><td>record_list.userid</td><td>string</td><td>企业用户账号id，当操作者为企业内部用户时返回该字段</td></tr><tr><td>record_list.external_user</td><td>object</td><td>企业外部人员账号信息，参考<a href="#ExternalUser%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E" rel="nofollow">ExternalUser结构说明</a>，当操作者为企业外部用户时返回该结构</td></tr><tr><td>record_list.operation</td><td>object</td><td>参考<a href="#Operation%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E" rel="nofollow">Operation结构说明</a></td></tr><tr><td>record_list.file_info</td><td>string</td><td>文件操作说明</td></tr><tr><td>file_md5</td><td>string</td><td>文件的MD5</td></tr><tr><td>file_size</td><td>int32</td><td>文件大小。单位：字节</td></tr><tr><td>record_list.applicant_name</td><td>string</td><td>当记录操作类型为『通过下载申请』或者『拒绝下载申请』时，该字段表示申请人的名字</td></tr><tr><td>record_list.device_type</td><td>int</td><td>设备类型<br>1-企业可信设备<br>2-个人可信设备<br><code>仅当操作类型为『下载』时会返回</code></td></tr><tr><td>record_list.device_code</td><td>string</td><td>设备编码。<code>仅当操作类型为『下载』且操作者为企业内成员时才会返回</code></td></tr></tbody></table></div><h3 id="operation%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E" data-sign="1324ad455898a393c9431d827f045225" data-lines="2"><a class="anchor" href="#operation%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E"></a><strong>Operation结构说明</strong></h3><div class="cherry-table-container" data-sign="02882f06bfec43c2d0de3806ceecdb6f" data-lines="4">
        <table class="cherry-table"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>type</td><td>int</td><td>操作类型，101：上传；102：新建文件夹；103：下载；104：更新；105：星标；106：移动；107：复制；108：重命名；109：删除；110：恢复；111：彻底删除；112：转发到企业微信；113：通过链接下载；114：获取分享链接；115：修改分享链接；116：关闭分享链接；117：收藏；118：新建文档；119：新建表格；121：打开；124：导出文件；127：添加文件成员；128：修改文件成员权限；129：移除文件成员；130：设置文档水印；131：修改企业内权限；132：修改企业外权限；133：添加快捷入口；134：转发到微信；135：预览；136：权限管理；139：安全设置；140：通过邮件分享；142：离职成员文件转交；10001：通过下载申请；10002：拒绝下载申请；</td></tr><tr><td>source</td><td>int</td><td>操作来源，在操作类型为“上传”或者“下载”时，可以通过该字段细分操作来源。401：聊天；402：邮件；403：文档；404：微盘；405：日程；406：会议；407：审批；408：汇报；409：收集表；410：客户联系；411：上下游；450：收藏；451：文件列表；452：其他</td></tr></tbody></table></div><h3 id="externaluser%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E" data-sign="c659d6d5f62c3bc7f9ab2498aacf44e5" data-lines="2"><a class="anchor" href="#externaluser%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E"></a><strong>ExternalUser结构说明</strong></h3><div class="cherry-table-container" data-sign="548492ad7b2ec4d8205b9d28d57d440d" data-lines="5">
        <table class="cherry-table"><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>type</td><td>int</td><td>用户类型，1：微信用户；2：企业微信用户</td></tr><tr><td>name</td><td>string</td><td>用户名</td></tr><tr><td>corp_name</td><td>string</td><td>当用户为企业微信用户时，返回该字段</td></tr></tbody></table></div></div></div>
    </div>
                <script src="../doc-script.js"></script>
                
                
                </body></html>